/*! For license information please see worker.0aee25e38dbeed6ba486.js.LICENSE.txt */
(()=>{var e={9669:(e,t,n)=>{e.exports=n(1609)},5448:(e,t,n)=>{"use strict";var r=n(4867),o=n(6026),i=n(4372),u=n(5327),a=n(4097),s=n(4109),c=n(7985),l=n(5061),f=n(7874),h=n(5263);e.exports=function(e){return new Promise((function(t,n){var p,d=e.data,y=e.headers,m=e.responseType;function v(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}r.isFormData(d)&&delete y["Content-Type"];var g=new XMLHttpRequest;if(e.auth){var b=e.auth.username||"",D=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";y.Authorization="Basic "+btoa(b+":"+D)}var w=a(e.baseURL,e.url);function E(){if(g){var r="getAllResponseHeaders"in g?s(g.getAllResponseHeaders()):null,i={data:m&&"text"!==m&&"json"!==m?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:r,config:e,request:g};o((function(e){t(e),v()}),(function(e){n(e),v()}),i),g=null}}if(g.open(e.method.toUpperCase(),u(w,e.params,e.paramsSerializer),!0),g.timeout=e.timeout,"onloadend"in g?g.onloadend=E:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(E)},g.onabort=function(){g&&(n(l("Request aborted",e,"ECONNABORTED",g)),g=null)},g.onerror=function(){n(l("Network Error",e,null,g)),g=null},g.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||f;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,r.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",g)),g=null},r.isStandardBrowserEnv()){var A=(e.withCredentials||c(w))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;A&&(y[e.xsrfHeaderName]=A)}"setRequestHeader"in g&&r.forEach(y,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete y[t]:g.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(g.withCredentials=!!e.withCredentials),m&&"json"!==m&&(g.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&g.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&g.upload&&g.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(p=function(e){g&&(n(!e||e&&e.type?new h("canceled"):e),g.abort(),g=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p))),d||(d=null),g.send(d)}))}},1609:(e,t,n)=>{"use strict";var r=n(4867),o=n(1849),i=n(321),u=n(7185),a=function e(t){var n=new i(t),a=o(i.prototype.request,n);return r.extend(a,i.prototype,n),r.extend(a,n),a.create=function(n){return e(u(t,n))},a}(n(5546));a.Axios=i,a.Cancel=n(5263),a.CancelToken=n(4972),a.isCancel=n(6502),a.VERSION=n(7288).version,a.all=function(e){return Promise.all(e)},a.spread=n(8713),a.isAxiosError=n(6268),e.exports=a,e.exports.default=a},5263:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4972:(e,t,n)=>{"use strict";var r=n(5263);function o(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},o.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},o.source=function(){var e;return{token:new o((function(t){e=t})),cancel:e}},e.exports=o},6502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},321:(e,t,n)=>{"use strict";var r=n(4867),o=n(5327),i=n(782),u=n(3572),a=n(7185),s=n(4875),c=s.validators;function l(e){this.defaults=e,this.interceptors={request:new i,response:new i}}l.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&s.assertOptions(n,{silentJSONParsing:c.transitional(c.boolean),forcedJSONParsing:c.transitional(c.boolean),clarifyTimeoutError:c.transitional(c.boolean)},!1);var r=[],o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var i,l=[];if(this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)})),!o){var f=[u,void 0];for(Array.prototype.unshift.apply(f,r),f=f.concat(l),i=Promise.resolve(t);f.length;)i=i.then(f.shift(),f.shift());return i}for(var h=t;r.length;){var p=r.shift(),d=r.shift();try{h=p(h)}catch(e){d(e);break}}try{i=u(h)}catch(e){return Promise.reject(e)}for(;l.length;)i=i.then(l.shift(),l.shift());return i},l.prototype.getUri=function(e){return e=a(this.defaults,e),o(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(a(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,r){return this.request(a(r||{},{method:e,url:t,data:n}))}})),e.exports=l},782:(e,t,n)=>{"use strict";var r=n(4867);function o(){this.handlers=[]}o.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},o.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},o.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=o},4097:(e,t,n)=>{"use strict";var r=n(1793),o=n(7303);e.exports=function(e,t){return e&&!r(t)?o(e,t):t}},5061:(e,t,n)=>{"use strict";var r=n(481);e.exports=function(e,t,n,o,i){var u=new Error(e);return r(u,t,n,o,i)}},3572:(e,t,n)=>{"use strict";var r=n(4867),o=n(8527),i=n(6502),u=n(5546),a=n(5263);function s(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=o.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||u.adapter)(e).then((function(t){return s(e),t.data=o.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(s(e),t&&t.response&&(t.response.data=o.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},481:e=>{"use strict";e.exports=function(e,t,n,r,o){return e.config=t,n&&(e.code=n),e.request=r,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},7185:(e,t,n)=>{"use strict";var r=n(4867);e.exports=function(e,t){t=t||{};var n={};function o(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function i(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:o(void 0,e[n]):o(e[n],t[n])}function u(e){if(!r.isUndefined(t[e]))return o(void 0,t[e])}function a(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:o(void 0,e[n]):o(void 0,t[n])}function s(n){return n in t?o(e[n],t[n]):n in e?o(void 0,e[n]):void 0}var c={url:u,method:u,data:u,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return r.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,o=t(e);r.isUndefined(o)&&t!==s||(n[e]=o)})),n}},6026:(e,t,n)=>{"use strict";var r=n(5061);e.exports=function(e,t,n){var o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},8527:(e,t,n)=>{"use strict";var r=n(4867),o=n(5546);e.exports=function(e,t,n){var i=this||o;return r.forEach(n,(function(n){e=n.call(i,e,t)})),e}},5546:(e,t,n)=>{"use strict";var r=n(4867),o=n(6016),i=n(481),u=n(7874),a={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,l={transitional:u,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=n(5448)),c),transformRequest:[function(e,t){return o(t,"Accept"),o(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(0,JSON.parse)(e),r.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||l.transitional,n=t&&t.silentJSONParsing,o=t&&t.forcedJSONParsing,u=!n&&"json"===this.responseType;if(u||o&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(u){if("SyntaxError"===e.name)throw i(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){l.headers[e]=r.merge(a)})),e.exports=l},7874:e=>{"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7288:e=>{e.exports={version:"0.26.1"}},1849:e=>{"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},5327:(e,t,n)=>{"use strict";var r=n(4867);function o(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(r.isURLSearchParams(t))i=t.toString();else{var u=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),u.push(o(t)+"="+o(e))})))})),i=u.join("&")}if(i){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,n)=>{"use strict";var r=n(4867);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,o,i,u){var a=[];a.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),r.isString(o)&&a.push("path="+o),r.isString(i)&&a.push("domain="+i),!0===u&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},6268:(e,t,n)=>{"use strict";var r=n(4867);e.exports=function(e){return r.isObject(e)&&!0===e.isAxiosError}},7985:(e,t,n)=>{"use strict";var r=n(4867);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function o(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=o(window.location.href),function(t){var n=r.isString(t)?o(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},6016:(e,t,n)=>{"use strict";var r=n(4867);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},4109:(e,t,n)=>{"use strict";var r=n(4867),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,i,u={};return e?(r.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=r.trim(e.substr(0,i)).toLowerCase(),n=r.trim(e.substr(i+1)),t){if(u[t]&&o.indexOf(t)>=0)return;u[t]="set-cookie"===t?(u[t]?u[t]:[]).concat([n]):u[t]?u[t]+", "+n:n}})),u):u}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4875:(e,t,n)=>{"use strict";var r=n(7288).version,o={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){o[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var i={};o.transitional=function(e,t,n){function o(e,t){return"[Axios v"+r+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,u){if(!1===e)throw new Error(o(r," has been removed"+(t?" in "+t:"")));return t&&!i[r]&&(i[r]=!0,console.warn(o(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,u)}},e.exports={assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),o=r.length;o-- >0;){var i=r[o],u=t[i];if(u){var a=e[i],s=void 0===a||u(a,i,e);if(!0!==s)throw new TypeError("option "+i+" must be "+s)}else if(!0!==n)throw Error("Unknown option "+i)}},validators:o}},4867:(e,t,n)=>{"use strict";var r=n(1849),o=Object.prototype.toString;function i(e){return Array.isArray(e)}function u(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===o.call(e)}function s(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==o.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===o.call(e)}function f(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}e.exports={isArray:i,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!u(e)&&null!==e.constructor&&!u(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===o.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:c,isUndefined:u,isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:l,isStream:function(e){return s(e)&&l(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===o.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:f,merge:function e(){var t={};function n(n,r){c(t[r])&&c(n)?t[r]=e(t[r],n):c(n)?t[r]=e({},n):i(n)?t[r]=n.slice():t[r]=n}for(var r=0,o=arguments.length;r<o;r++)f(arguments[r],n);return t},extend:function(e,t,n){return f(t,(function(t,o){e[o]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},1039:function(e,t,n){!function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=r(n);function i(e,t,n){var r,i;"function"==typeof e?(r=t||[],i=n):(r=[],i=t);var u=o.default.useRef({hasResult:!1,result:i,error:null}),a=o.default.useReducer((function(e){return e+1}),0);a[0];var s=a[1],c=o.default.useMemo((function(){var t="function"==typeof e?e():e;if(!t||"function"!=typeof t.subscribe)throw e===t?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!u.current.hasResult&&"undefined"!=typeof window&&("function"!=typeof t.hasValue||t.hasValue()))if("function"==typeof t.getValue)u.current.result=t.getValue(),u.current.hasResult=!0;else{var n=t.subscribe((function(e){u.current.result=e,u.current.hasResult=!0}));"function"==typeof n?n():n.unsubscribe()}return t}),r);if(o.default.useDebugValue(u.current.result),o.default.useEffect((function(){var e=c.subscribe((function(e){var t=u.current;null===t.error&&t.result===e||(t.error=null,t.result=e,t.hasResult=!0,s())}),(function(e){var t=u.current;t.error!==e&&(t.error=e,s())}));return"function"==typeof e?e:e.unsubscribe.bind(e)}),r),u.current.error)throw u.current.error;return u.current.result}e.useLiveQuery=function(e,n,r){return i((function(){return t.liveQuery(e)}),n||[],r)},e.useObservable=i,e.usePermissions=function(e,n,r){if(!e)throw new TypeError("Invalid arguments to usePermissions(): undefined or null");var o;if(arguments.length>=3){if(!("transaction"in e))throw new TypeError("Invalid arguments to usePermission(db, table, obj): 1st arg must be a Dexie instance");if("string"!=typeof n)throw new TypeError("Invalid arguments to usePermission(db, table, obj): 2nd arg must be string");if(!r||"object"!=typeof r)throw new TypeError("Invalid arguments to usePermission(db, table, obj): 3rd arg must be an object");o=e}else{if(e instanceof t.Dexie)throw new TypeError("Invalid arguments to usePermission(db, table, obj): Missing table and obj arguments.");if("function"!=typeof e.table||"object"!=typeof e.db)throw new TypeError("Invalid arguments to usePermissions(). Expected usePermissions(entity: DexieCloudEntity) or usePermissions(db: Dexie, table: string, obj: DexieCloudObject)");o=e.db,r=e,n=e.table()}if(!("cloud"in o))throw new Error("usePermissions() is only for Dexie Cloud but there's no dexie-cloud-addon active in given db.");if(!("permissions"in o.cloud))throw new Error("usePermissions() requires a newer version of dexie-cloud-addon. Please upgrade it.");return i((function(){return o.cloud.permissions(r,n)}),[r.realmId,r.owner,n])},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(9520),n(7294))},6230:e=>{e.exports="object"==typeof self?self.FormData:window.FormData},1142:function(e){e.exports=function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}var t=e((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),n=e((function(e){var t=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=t)})),r=(n.version,function(e){return"object"==typeof e?null!==e:"function"==typeof e}),o=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e},i=function(e){try{return!!e()}catch(e){return!0}},u=!i((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),a=t.document,s=r(a)&&r(a.createElement),c=!u&&!i((function(){return 7!=Object.defineProperty((e="div",s?a.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),l=Object.defineProperty,f={f:u?Object.defineProperty:function(e,t,n){if(o(e),t=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}(t,!0),o(n),c)try{return l(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},h=u?function(e,t,n){return f.f(e,t,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}(1,n))}:function(e,t,n){return e[t]=n,e},p={}.hasOwnProperty,d=function(e,t){return p.call(e,t)},y=0,m=Math.random(),v=e((function(e){var r="__core-js_shared__",o=t[r]||(t[r]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),g=v("native-function-to-string",Function.toString),b=e((function(e){var r=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++y+m).toString(36))}("src"),o="toString",i=(""+g).split(o);n.inspectSource=function(e){return g.call(e)},(e.exports=function(e,n,o,u){var a="function"==typeof o;a&&(d(o,"name")||h(o,"name",n)),e[n]!==o&&(a&&(d(o,r)||h(o,r,e[n]?""+e[n]:i.join(String(n)))),e===t?e[n]=o:u?e[n]?e[n]=o:h(e,n,o):(delete e[n],h(e,n,o)))})(Function.prototype,o,(function(){return"function"==typeof this&&this[r]||g.call(this)}))})),D=function(e,t,n){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},w="prototype",E=function(e,r,o){var i,u,a,s,c=e&E.F,l=e&E.G,f=e&E.S,p=e&E.P,d=e&E.B,y=l?t:f?t[r]||(t[r]={}):(t[r]||{})[w],m=l?n:n[r]||(n[r]={}),v=m[w]||(m[w]={});for(i in l&&(o=r),o)a=((u=!c&&y&&void 0!==y[i])?y:o)[i],s=d&&u?D(a,t):p&&"function"==typeof a?D(Function.call,a):a,y&&b(y,i,a,e&E.U),m[i]!=a&&h(m,i,s),p&&v[i]!=a&&(v[i]=a)};t.core=n,E.F=1,E.G=2,E.S=4,E.P=8,E.B=16,E.W=32,E.U=64,E.R=128;var A=E,F=Math.ceil,C=Math.floor,x=function(e){return isNaN(e=+e)?0:(e>0?C:F)(e)},_=(!1,function(e,t){var n,r,o=String(function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}(e)),i=x(t),u=o.length;return i<0||i>=u?void 0:(n=o.charCodeAt(i))<55296||n>56319||i+1===u||(r=o.charCodeAt(i+1))<56320||r>57343?n:r-56320+(n-55296<<10)+65536});A(A.P,"String",{codePointAt:function(e){return _(this,e)}}),n.String.codePointAt;var O=Math.max,S=Math.min,B=String.fromCharCode,j=String.fromCodePoint;A(A.S+A.F*(!!j&&1!=j.length),"String",{fromCodePoint:function(e){for(var t,n=arguments,r=[],o=arguments.length,i=0;o>i;){if(t=+n[i++],a=1114111,((u=x(u=t))<0?O(u+a,0):S(u,a))!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?B(t):B(55296+((t-=65536)>>10),t%1024+56320))}var u,a;return r.join("")}}),n.String.fromCodePoint;var P,k,T,L,I,R,M,N,U,q,K,H,G,$,V={Space_Separator:/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ID_Start:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ID_Continue:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},z={isSpaceSeparator:function(e){return"string"==typeof e&&V.Space_Separator.test(e)},isIdStartChar:function(e){return"string"==typeof e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||"$"===e||"_"===e||V.ID_Start.test(e))},isIdContinueChar:function(e){return"string"==typeof e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"$"===e||"_"===e||"‌"===e||"‍"===e||V.ID_Continue.test(e))},isDigit:function(e){return"string"==typeof e&&/[0-9]/.test(e)},isHexDigit:function(e){return"string"==typeof e&&/[0-9A-Fa-f]/.test(e)}};function Y(e,t,n){var r=e[t];if(null!=r&&"object"==typeof r)if(Array.isArray(r))for(var o=0;o<r.length;o++){var i=String(o),u=Y(r,i,n);void 0===u?delete r[i]:Object.defineProperty(r,i,{value:u,writable:!0,enumerable:!0,configurable:!0})}else for(var a in r){var s=Y(r,a,n);void 0===s?delete r[a]:Object.defineProperty(r,a,{value:s,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,r)}function J(){for(q="default",K="",H=!1,G=1;;){$=W();var e=Q[q]();if(e)return e}}function W(){if(P[L])return String.fromCodePoint(P.codePointAt(L))}function X(){var e=W();return"\n"===e?(I++,R=0):e?R+=e.length:R++,e&&(L+=e.length),e}var Q={default:function(){switch($){case"\t":case"\v":case"\f":case" ":case" ":case"\ufeff":case"\n":case"\r":case"\u2028":case"\u2029":return void X();case"/":return X(),void(q="comment");case void 0:return X(),Z("eof")}if(!z.isSpaceSeparator($))return Q[k]();X()},comment:function(){switch($){case"*":return X(),void(q="multiLineComment");case"/":return X(),void(q="singleLineComment")}throw ie(X())},multiLineComment:function(){switch($){case"*":return X(),void(q="multiLineCommentAsterisk");case void 0:throw ie(X())}X()},multiLineCommentAsterisk:function(){switch($){case"*":return void X();case"/":return X(),void(q="default");case void 0:throw ie(X())}X(),q="multiLineComment"},singleLineComment:function(){switch($){case"\n":case"\r":case"\u2028":case"\u2029":return X(),void(q="default");case void 0:return X(),Z("eof")}X()},value:function(){switch($){case"{":case"[":return Z("punctuator",X());case"n":return X(),ee("ull"),Z("null",null);case"t":return X(),ee("rue"),Z("boolean",!0);case"f":return X(),ee("alse"),Z("boolean",!1);case"-":case"+":return"-"===X()&&(G=-1),void(q="sign");case".":return K=X(),void(q="decimalPointLeading");case"0":return K=X(),void(q="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return K=X(),void(q="decimalInteger");case"I":return X(),ee("nfinity"),Z("numeric",1/0);case"N":return X(),ee("aN"),Z("numeric",NaN);case'"':case"'":return H='"'===X(),K="",void(q="string")}throw ie(X())},identifierNameStartEscape:function(){if("u"!==$)throw ie(X());X();var e=te();switch(e){case"$":case"_":break;default:if(!z.isIdStartChar(e))throw ae()}K+=e,q="identifierName"},identifierName:function(){switch($){case"$":case"_":case"‌":case"‍":return void(K+=X());case"\\":return X(),void(q="identifierNameEscape")}if(!z.isIdContinueChar($))return Z("identifier",K);K+=X()},identifierNameEscape:function(){if("u"!==$)throw ie(X());X();var e=te();switch(e){case"$":case"_":case"‌":case"‍":break;default:if(!z.isIdContinueChar(e))throw ae()}K+=e,q="identifierName"},sign:function(){switch($){case".":return K=X(),void(q="decimalPointLeading");case"0":return K=X(),void(q="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return K=X(),void(q="decimalInteger");case"I":return X(),ee("nfinity"),Z("numeric",G*(1/0));case"N":return X(),ee("aN"),Z("numeric",NaN)}throw ie(X())},zero:function(){switch($){case".":return K+=X(),void(q="decimalPoint");case"e":case"E":return K+=X(),void(q="decimalExponent");case"x":case"X":return K+=X(),void(q="hexadecimal")}return Z("numeric",0*G)},decimalInteger:function(){switch($){case".":return K+=X(),void(q="decimalPoint");case"e":case"E":return K+=X(),void(q="decimalExponent")}if(!z.isDigit($))return Z("numeric",G*Number(K));K+=X()},decimalPointLeading:function(){if(z.isDigit($))return K+=X(),void(q="decimalFraction");throw ie(X())},decimalPoint:function(){switch($){case"e":case"E":return K+=X(),void(q="decimalExponent")}return z.isDigit($)?(K+=X(),void(q="decimalFraction")):Z("numeric",G*Number(K))},decimalFraction:function(){switch($){case"e":case"E":return K+=X(),void(q="decimalExponent")}if(!z.isDigit($))return Z("numeric",G*Number(K));K+=X()},decimalExponent:function(){switch($){case"+":case"-":return K+=X(),void(q="decimalExponentSign")}if(z.isDigit($))return K+=X(),void(q="decimalExponentInteger");throw ie(X())},decimalExponentSign:function(){if(z.isDigit($))return K+=X(),void(q="decimalExponentInteger");throw ie(X())},decimalExponentInteger:function(){if(!z.isDigit($))return Z("numeric",G*Number(K));K+=X()},hexadecimal:function(){if(z.isHexDigit($))return K+=X(),void(q="hexadecimalInteger");throw ie(X())},hexadecimalInteger:function(){if(!z.isHexDigit($))return Z("numeric",G*Number(K));K+=X()},string:function(){switch($){case"\\":return X(),void(K+=function(){switch(W()){case"b":return X(),"\b";case"f":return X(),"\f";case"n":return X(),"\n";case"r":return X(),"\r";case"t":return X(),"\t";case"v":return X(),"\v";case"0":if(X(),z.isDigit(W()))throw ie(X());return"\0";case"x":return X(),function(){var e="",t=W();if(!z.isHexDigit(t))throw ie(X());if(e+=X(),t=W(),!z.isHexDigit(t))throw ie(X());return e+=X(),String.fromCodePoint(parseInt(e,16))}();case"u":return X(),te();case"\n":case"\u2028":case"\u2029":return X(),"";case"\r":return X(),"\n"===W()&&X(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case void 0:throw ie(X())}return X()}());case'"':return H?(X(),Z("string",K)):void(K+=X());case"'":return H?void(K+=X()):(X(),Z("string",K));case"\n":case"\r":throw ie(X());case"\u2028":case"\u2029":!function(e){console.warn("JSON5: '"+se(e)+"' in strings is not valid ECMAScript; consider escaping")}($);break;case void 0:throw ie(X())}K+=X()},start:function(){switch($){case"{":case"[":return Z("punctuator",X())}q="value"},beforePropertyName:function(){switch($){case"$":case"_":return K=X(),void(q="identifierName");case"\\":return X(),void(q="identifierNameStartEscape");case"}":return Z("punctuator",X());case'"':case"'":return H='"'===X(),void(q="string")}if(z.isIdStartChar($))return K+=X(),void(q="identifierName");throw ie(X())},afterPropertyName:function(){if(":"===$)return Z("punctuator",X());throw ie(X())},beforePropertyValue:function(){q="value"},afterPropertyValue:function(){switch($){case",":case"}":return Z("punctuator",X())}throw ie(X())},beforeArrayValue:function(){if("]"===$)return Z("punctuator",X());q="value"},afterArrayValue:function(){switch($){case",":case"]":return Z("punctuator",X())}throw ie(X())},end:function(){throw ie(X())}};function Z(e,t){return{type:e,value:t,line:I,column:R}}function ee(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if(W()!==r)throw ie(X());X()}}function te(){for(var e="",t=4;t-- >0;){var n=W();if(!z.isHexDigit(n))throw ie(X());e+=X()}return String.fromCodePoint(parseInt(e,16))}var ne={start:function(){if("eof"===M.type)throw ue();re()},beforePropertyName:function(){switch(M.type){case"identifier":case"string":return N=M.value,void(k="afterPropertyName");case"punctuator":return void oe();case"eof":throw ue()}},afterPropertyName:function(){if("eof"===M.type)throw ue();k="beforePropertyValue"},beforePropertyValue:function(){if("eof"===M.type)throw ue();re()},beforeArrayValue:function(){if("eof"===M.type)throw ue();"punctuator"!==M.type||"]"!==M.value?re():oe()},afterPropertyValue:function(){if("eof"===M.type)throw ue();switch(M.value){case",":return void(k="beforePropertyName");case"}":oe()}},afterArrayValue:function(){if("eof"===M.type)throw ue();switch(M.value){case",":return void(k="beforeArrayValue");case"]":oe()}},end:function(){}};function re(){var e;switch(M.type){case"punctuator":switch(M.value){case"{":e={};break;case"[":e=[]}break;case"null":case"boolean":case"numeric":case"string":e=M.value}if(void 0===U)U=e;else{var t=T[T.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,N,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(null!==e&&"object"==typeof e)T.push(e),k=Array.isArray(e)?"beforeArrayValue":"beforePropertyName";else{var n=T[T.length-1];k=null==n?"end":Array.isArray(n)?"afterArrayValue":"afterPropertyValue"}}function oe(){T.pop();var e=T[T.length-1];k=null==e?"end":Array.isArray(e)?"afterArrayValue":"afterPropertyValue"}function ie(e){return ce(void 0===e?"JSON5: invalid end of input at "+I+":"+R:"JSON5: invalid character '"+se(e)+"' at "+I+":"+R)}function ue(){return ce("JSON5: invalid end of input at "+I+":"+R)}function ae(){return ce("JSON5: invalid identifier character at "+I+":"+(R-=5))}function se(e){var t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){var n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function ce(e){var t=new SyntaxError(e);return t.lineNumber=I,t.columnNumber=R,t}return{parse:function(e,t){P=String(e),k="start",T=[],L=0,I=1,R=0,M=void 0,N=void 0,U=void 0;do{M=J(),ne[k]()}while("eof"!==M.type);return"function"==typeof t?Y({"":U},"",t):U},stringify:function(e,t,n){var r,o,i,u=[],a="",s="";if(null==t||"object"!=typeof t||Array.isArray(t)||(n=t.space,i=t.quote,t=t.replacer),"function"==typeof t)o=t;else if(Array.isArray(t)){r=[];for(var c=0,l=t;c<l.length;c+=1){var f=l[c],h=void 0;"string"==typeof f?h=f:("number"==typeof f||f instanceof String||f instanceof Number)&&(h=String(f)),void 0!==h&&r.indexOf(h)<0&&r.push(h)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),"number"==typeof n?n>0&&(n=Math.min(10,Math.floor(n)),s="          ".substr(0,n)):"string"==typeof n&&(s=n.substr(0,10)),p("",{"":e});function p(e,t){var n=t[e];switch(null!=n&&("function"==typeof n.toJSON5?n=n.toJSON5(e):"function"==typeof n.toJSON&&(n=n.toJSON(e))),o&&(n=o.call(t,e,n)),n instanceof Number?n=Number(n):n instanceof String?n=String(n):n instanceof Boolean&&(n=n.valueOf()),n){case null:return"null";case!0:return"true";case!1:return"false"}return"string"==typeof n?d(n):"number"==typeof n?String(n):"object"==typeof n?Array.isArray(n)?function(e){if(u.indexOf(e)>=0)throw TypeError("Converting circular structure to JSON5");u.push(e);var t=a;a+=s;for(var n,r=[],o=0;o<e.length;o++){var i=p(String(o),e);r.push(void 0!==i?i:"null")}if(0===r.length)n="[]";else if(""===s)n="["+r.join(",")+"]";else{var c=",\n"+a,l=r.join(c);n="[\n"+a+l+",\n"+t+"]"}return u.pop(),a=t,n}(n):function(e){if(u.indexOf(e)>=0)throw TypeError("Converting circular structure to JSON5");u.push(e);var t=a;a+=s;for(var n,o,i=[],c=0,l=r||Object.keys(e);c<l.length;c+=1){var f=l[c],h=p(f,e);if(void 0!==h){var d=y(f)+":";""!==s&&(d+=" "),d+=h,i.push(d)}}if(0===i.length)n="{}";else if(""===s)n="{"+(o=i.join(","))+"}";else{var m=",\n"+a;o=i.join(m),n="{\n"+a+o+",\n"+t+"}"}return u.pop(),a=t,n}(n):void 0}function d(e){for(var t={"'":.1,'"':.2},n={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},r="",o=0;o<e.length;o++){var u=e[o];switch(u){case"'":case'"':t[u]++,r+=u;continue;case"\0":if(z.isDigit(e[o+1])){r+="\\x00";continue}}if(n[u])r+=n[u];else if(u<" "){var a=u.charCodeAt(0).toString(16);r+="\\x"+("00"+a).substring(a.length)}else r+=u}var s=i||Object.keys(t).reduce((function(e,n){return t[e]<t[n]?e:n}));return s+(r=r.replace(new RegExp(s,"g"),n[s]))+s}function y(e){if(0===e.length)return d(e);var t=String.fromCodePoint(e.codePointAt(0));if(!z.isIdStartChar(t))return d(e);for(var n=t.length;n<e.length;n++)if(!z.isIdContinueChar(String.fromCodePoint(e.codePointAt(n))))return d(e);return e}}}}()},4793:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIApi=t.OpenAIApiFactory=t.OpenAIApiFp=t.OpenAIApiAxiosParamCreator=t.CreateImageRequestResponseFormatEnum=t.CreateImageRequestSizeEnum=t.ChatCompletionResponseMessageRoleEnum=t.ChatCompletionRequestMessageRoleEnum=void 0;const o=n(9669),i=n(3597),u=n(5198);t.ChatCompletionRequestMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},t.ChatCompletionResponseMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},t.CreateImageRequestSizeEnum={_256x256:"256x256",_512x512:"512x512",_1024x1024:"1024x1024"},t.CreateImageRequestResponseFormatEnum={Url:"url",B64Json:"b64_json"},t.OpenAIApiAxiosParamCreator=function(e){return{cancelFineTune:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("cancelFineTune","fineTuneId",t);const r="/fine-tunes/{fine_tune_id}/cancel".replace("{fine_tune_id}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"POST"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),createAnswer:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createAnswer","createAnswerRequest",t);const r=new URL("/answers",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createChatCompletion:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createChatCompletion","createChatCompletionRequest",t);const r=new URL("/chat/completions",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createClassification:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createClassification","createClassificationRequest",t);const r=new URL("/classifications",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createCompletion:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createCompletion","createCompletionRequest",t);const r=new URL("/completions",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createEdit:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createEdit","createEditRequest",t);const r=new URL("/edits",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createEmbedding:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createEmbedding","createEmbeddingRequest",t);const r=new URL("/embeddings",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createFile:(t,n,o={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createFile","file",t),i.assertParamExists("createFile","purpose",n);const r=new URL("/files",i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"POST"},u),o),s={},c=new(e&&e.formDataCtor||FormData);void 0!==t&&c.append("file",t),void 0!==n&&c.append("purpose",n),s["Content-Type"]="multipart/form-data",i.setSearchParams(r,{});let l=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign(Object.assign({},s),c.getHeaders()),l),o.headers),a.data=c,{url:i.toPathString(r),options:a}})),createFineTune:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createFineTune","createFineTuneRequest",t);const r=new URL("/fine-tunes",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createImage:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createImage","createImageRequest",t);const r=new URL("/images/generations",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createImageEdit:(t,n,o,u,a,s,c,l={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createImageEdit","image",t),i.assertParamExists("createImageEdit","prompt",n);const r=new URL("/images/edits",i.DUMMY_BASE_URL);let f;e&&(f=e.baseOptions);const h=Object.assign(Object.assign({method:"POST"},f),l),p={},d=new(e&&e.formDataCtor||FormData);void 0!==t&&d.append("image",t),void 0!==o&&d.append("mask",o),void 0!==n&&d.append("prompt",n),void 0!==u&&d.append("n",u),void 0!==a&&d.append("size",a),void 0!==s&&d.append("response_format",s),void 0!==c&&d.append("user",c),p["Content-Type"]="multipart/form-data",i.setSearchParams(r,{});let y=f&&f.headers?f.headers:{};return h.headers=Object.assign(Object.assign(Object.assign(Object.assign({},p),d.getHeaders()),y),l.headers),h.data=d,{url:i.toPathString(r),options:h}})),createImageVariation:(t,n,o,u,a,s={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createImageVariation","image",t);const r=new URL("/images/variations",i.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const l=Object.assign(Object.assign({method:"POST"},c),s),f={},h=new(e&&e.formDataCtor||FormData);void 0!==t&&h.append("image",t),void 0!==n&&h.append("n",n),void 0!==o&&h.append("size",o),void 0!==u&&h.append("response_format",u),void 0!==a&&h.append("user",a),f["Content-Type"]="multipart/form-data",i.setSearchParams(r,{});let p=c&&c.headers?c.headers:{};return l.headers=Object.assign(Object.assign(Object.assign(Object.assign({},f),h.getHeaders()),p),s.headers),l.data=h,{url:i.toPathString(r),options:l}})),createModeration:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createModeration","createModerationRequest",t);const r=new URL("/moderations",i.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},o),n),a={"Content-Type":"application/json"};i.setSearchParams(r,{});let s=o&&o.headers?o.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},a),s),n.headers),u.data=i.serializeDataIfNeeded(t,u,e),{url:i.toPathString(r),options:u}})),createSearch:(t,n,o={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createSearch","engineId",t),i.assertParamExists("createSearch","createSearchRequest",n);const r="/engines/{engine_id}/search".replace("{engine_id}",encodeURIComponent(String(t))),u=new URL(r,i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},a),o),c={"Content-Type":"application/json"};i.setSearchParams(u,{});let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},c),l),o.headers),s.data=i.serializeDataIfNeeded(n,s,e),{url:i.toPathString(u),options:s}})),createTranscription:(t,n,o,u,a,s,c={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createTranscription","file",t),i.assertParamExists("createTranscription","model",n);const r=new URL("/audio/transcriptions",i.DUMMY_BASE_URL);let l;e&&(l=e.baseOptions);const f=Object.assign(Object.assign({method:"POST"},l),c),h={},p=new(e&&e.formDataCtor||FormData);void 0!==t&&p.append("file",t),void 0!==n&&p.append("model",n),void 0!==o&&p.append("prompt",o),void 0!==u&&p.append("response_format",u),void 0!==a&&p.append("temperature",a),void 0!==s&&p.append("language",s),h["Content-Type"]="multipart/form-data",i.setSearchParams(r,{});let d=l&&l.headers?l.headers:{};return f.headers=Object.assign(Object.assign(Object.assign(Object.assign({},h),p.getHeaders()),d),c.headers),f.data=p,{url:i.toPathString(r),options:f}})),createTranslation:(t,n,o,u,a,s={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("createTranslation","file",t),i.assertParamExists("createTranslation","model",n);const r=new URL("/audio/translations",i.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const l=Object.assign(Object.assign({method:"POST"},c),s),f={},h=new(e&&e.formDataCtor||FormData);void 0!==t&&h.append("file",t),void 0!==n&&h.append("model",n),void 0!==o&&h.append("prompt",o),void 0!==u&&h.append("response_format",u),void 0!==a&&h.append("temperature",a),f["Content-Type"]="multipart/form-data",i.setSearchParams(r,{});let p=c&&c.headers?c.headers:{};return l.headers=Object.assign(Object.assign(Object.assign(Object.assign({},f),h.getHeaders()),p),s.headers),l.data=h,{url:i.toPathString(r),options:l}})),deleteFile:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("deleteFile","fileId",t);const r="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"DELETE"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),deleteModel:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("deleteModel","model",t);const r="/models/{model}".replace("{model}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"DELETE"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),downloadFile:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("downloadFile","fileId",t);const r="/files/{file_id}/content".replace("{file_id}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),listEngines:(t={})=>r(this,void 0,void 0,(function*(){const n=new URL("/engines",i.DUMMY_BASE_URL);let r;e&&(r=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},r),t);i.setSearchParams(n,{});let u=r&&r.headers?r.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),u),t.headers),{url:i.toPathString(n),options:o}})),listFiles:(t={})=>r(this,void 0,void 0,(function*(){const n=new URL("/files",i.DUMMY_BASE_URL);let r;e&&(r=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},r),t);i.setSearchParams(n,{});let u=r&&r.headers?r.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),u),t.headers),{url:i.toPathString(n),options:o}})),listFineTuneEvents:(t,n,o={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("listFineTuneEvents","fineTuneId",t);const r="/fine-tunes/{fine_tune_id}/events".replace("{fine_tune_id}",encodeURIComponent(String(t))),u=new URL(r,i.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const s=Object.assign(Object.assign({method:"GET"},a),o),c={};void 0!==n&&(c.stream=n),i.setSearchParams(u,c);let l=a&&a.headers?a.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},{}),l),o.headers),{url:i.toPathString(u),options:s}})),listFineTunes:(t={})=>r(this,void 0,void 0,(function*(){const n=new URL("/fine-tunes",i.DUMMY_BASE_URL);let r;e&&(r=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},r),t);i.setSearchParams(n,{});let u=r&&r.headers?r.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),u),t.headers),{url:i.toPathString(n),options:o}})),listModels:(t={})=>r(this,void 0,void 0,(function*(){const n=new URL("/models",i.DUMMY_BASE_URL);let r;e&&(r=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},r),t);i.setSearchParams(n,{});let u=r&&r.headers?r.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},{}),u),t.headers),{url:i.toPathString(n),options:o}})),retrieveEngine:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("retrieveEngine","engineId",t);const r="/engines/{engine_id}".replace("{engine_id}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),retrieveFile:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("retrieveFile","fileId",t);const r="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),retrieveFineTune:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("retrieveFineTune","fineTuneId",t);const r="/fine-tunes/{fine_tune_id}".replace("{fine_tune_id}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}})),retrieveModel:(t,n={})=>r(this,void 0,void 0,(function*(){i.assertParamExists("retrieveModel","model",t);const r="/models/{model}".replace("{model}",encodeURIComponent(String(t))),o=new URL(r,i.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},u),n);i.setSearchParams(o,{});let s=u&&u.headers?u.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},{}),s),n.headers),{url:i.toPathString(o),options:a}}))}},t.OpenAIApiFp=function(e){const n=t.OpenAIApiAxiosParamCreator(e);return{cancelFineTune(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.cancelFineTune(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createAnswer(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createAnswer(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createChatCompletion(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createChatCompletion(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createClassification(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createClassification(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createCompletion(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createCompletion(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createEdit(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createEdit(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createEmbedding(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createEmbedding(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createFile(t,a,s){return r(this,void 0,void 0,(function*(){const r=yield n.createFile(t,a,s);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createFineTune(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createFineTune(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createImage(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createImage(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createImageEdit(t,a,s,c,l,f,h,p){return r(this,void 0,void 0,(function*(){const r=yield n.createImageEdit(t,a,s,c,l,f,h,p);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createImageVariation(t,a,s,c,l,f){return r(this,void 0,void 0,(function*(){const r=yield n.createImageVariation(t,a,s,c,l,f);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createModeration(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.createModeration(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createSearch(t,a,s){return r(this,void 0,void 0,(function*(){const r=yield n.createSearch(t,a,s);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createTranscription(t,a,s,c,l,f,h){return r(this,void 0,void 0,(function*(){const r=yield n.createTranscription(t,a,s,c,l,f,h);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},createTranslation(t,a,s,c,l,f){return r(this,void 0,void 0,(function*(){const r=yield n.createTranslation(t,a,s,c,l,f);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},deleteFile(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.deleteFile(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},deleteModel(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.deleteModel(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},downloadFile(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.downloadFile(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},listEngines(t){return r(this,void 0,void 0,(function*(){const r=yield n.listEngines(t);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},listFiles(t){return r(this,void 0,void 0,(function*(){const r=yield n.listFiles(t);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},listFineTuneEvents(t,a,s){return r(this,void 0,void 0,(function*(){const r=yield n.listFineTuneEvents(t,a,s);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},listFineTunes(t){return r(this,void 0,void 0,(function*(){const r=yield n.listFineTunes(t);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},listModels(t){return r(this,void 0,void 0,(function*(){const r=yield n.listModels(t);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},retrieveEngine(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.retrieveEngine(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},retrieveFile(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.retrieveFile(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},retrieveFineTune(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.retrieveFineTune(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))},retrieveModel(t,a){return r(this,void 0,void 0,(function*(){const r=yield n.retrieveModel(t,a);return i.createRequestFunction(r,o.default,u.BASE_PATH,e)}))}}},t.OpenAIApiFactory=function(e,n,r){const o=t.OpenAIApiFp(e);return{cancelFineTune:(e,t)=>o.cancelFineTune(e,t).then((e=>e(r,n))),createAnswer:(e,t)=>o.createAnswer(e,t).then((e=>e(r,n))),createChatCompletion:(e,t)=>o.createChatCompletion(e,t).then((e=>e(r,n))),createClassification:(e,t)=>o.createClassification(e,t).then((e=>e(r,n))),createCompletion:(e,t)=>o.createCompletion(e,t).then((e=>e(r,n))),createEdit:(e,t)=>o.createEdit(e,t).then((e=>e(r,n))),createEmbedding:(e,t)=>o.createEmbedding(e,t).then((e=>e(r,n))),createFile:(e,t,i)=>o.createFile(e,t,i).then((e=>e(r,n))),createFineTune:(e,t)=>o.createFineTune(e,t).then((e=>e(r,n))),createImage:(e,t)=>o.createImage(e,t).then((e=>e(r,n))),createImageEdit:(e,t,i,u,a,s,c,l)=>o.createImageEdit(e,t,i,u,a,s,c,l).then((e=>e(r,n))),createImageVariation:(e,t,i,u,a,s)=>o.createImageVariation(e,t,i,u,a,s).then((e=>e(r,n))),createModeration:(e,t)=>o.createModeration(e,t).then((e=>e(r,n))),createSearch:(e,t,i)=>o.createSearch(e,t,i).then((e=>e(r,n))),createTranscription:(e,t,i,u,a,s,c)=>o.createTranscription(e,t,i,u,a,s,c).then((e=>e(r,n))),createTranslation:(e,t,i,u,a,s)=>o.createTranslation(e,t,i,u,a,s).then((e=>e(r,n))),deleteFile:(e,t)=>o.deleteFile(e,t).then((e=>e(r,n))),deleteModel:(e,t)=>o.deleteModel(e,t).then((e=>e(r,n))),downloadFile:(e,t)=>o.downloadFile(e,t).then((e=>e(r,n))),listEngines:e=>o.listEngines(e).then((e=>e(r,n))),listFiles:e=>o.listFiles(e).then((e=>e(r,n))),listFineTuneEvents:(e,t,i)=>o.listFineTuneEvents(e,t,i).then((e=>e(r,n))),listFineTunes:e=>o.listFineTunes(e).then((e=>e(r,n))),listModels:e=>o.listModels(e).then((e=>e(r,n))),retrieveEngine:(e,t)=>o.retrieveEngine(e,t).then((e=>e(r,n))),retrieveFile:(e,t)=>o.retrieveFile(e,t).then((e=>e(r,n))),retrieveFineTune:(e,t)=>o.retrieveFineTune(e,t).then((e=>e(r,n))),retrieveModel:(e,t)=>o.retrieveModel(e,t).then((e=>e(r,n)))}};class a extends u.BaseAPI{cancelFineTune(e,n){return t.OpenAIApiFp(this.configuration).cancelFineTune(e,n).then((e=>e(this.axios,this.basePath)))}createAnswer(e,n){return t.OpenAIApiFp(this.configuration).createAnswer(e,n).then((e=>e(this.axios,this.basePath)))}createChatCompletion(e,n){return t.OpenAIApiFp(this.configuration).createChatCompletion(e,n).then((e=>e(this.axios,this.basePath)))}createClassification(e,n){return t.OpenAIApiFp(this.configuration).createClassification(e,n).then((e=>e(this.axios,this.basePath)))}createCompletion(e,n){return t.OpenAIApiFp(this.configuration).createCompletion(e,n).then((e=>e(this.axios,this.basePath)))}createEdit(e,n){return t.OpenAIApiFp(this.configuration).createEdit(e,n).then((e=>e(this.axios,this.basePath)))}createEmbedding(e,n){return t.OpenAIApiFp(this.configuration).createEmbedding(e,n).then((e=>e(this.axios,this.basePath)))}createFile(e,n,r){return t.OpenAIApiFp(this.configuration).createFile(e,n,r).then((e=>e(this.axios,this.basePath)))}createFineTune(e,n){return t.OpenAIApiFp(this.configuration).createFineTune(e,n).then((e=>e(this.axios,this.basePath)))}createImage(e,n){return t.OpenAIApiFp(this.configuration).createImage(e,n).then((e=>e(this.axios,this.basePath)))}createImageEdit(e,n,r,o,i,u,a,s){return t.OpenAIApiFp(this.configuration).createImageEdit(e,n,r,o,i,u,a,s).then((e=>e(this.axios,this.basePath)))}createImageVariation(e,n,r,o,i,u){return t.OpenAIApiFp(this.configuration).createImageVariation(e,n,r,o,i,u).then((e=>e(this.axios,this.basePath)))}createModeration(e,n){return t.OpenAIApiFp(this.configuration).createModeration(e,n).then((e=>e(this.axios,this.basePath)))}createSearch(e,n,r){return t.OpenAIApiFp(this.configuration).createSearch(e,n,r).then((e=>e(this.axios,this.basePath)))}createTranscription(e,n,r,o,i,u,a){return t.OpenAIApiFp(this.configuration).createTranscription(e,n,r,o,i,u,a).then((e=>e(this.axios,this.basePath)))}createTranslation(e,n,r,o,i,u){return t.OpenAIApiFp(this.configuration).createTranslation(e,n,r,o,i,u).then((e=>e(this.axios,this.basePath)))}deleteFile(e,n){return t.OpenAIApiFp(this.configuration).deleteFile(e,n).then((e=>e(this.axios,this.basePath)))}deleteModel(e,n){return t.OpenAIApiFp(this.configuration).deleteModel(e,n).then((e=>e(this.axios,this.basePath)))}downloadFile(e,n){return t.OpenAIApiFp(this.configuration).downloadFile(e,n).then((e=>e(this.axios,this.basePath)))}listEngines(e){return t.OpenAIApiFp(this.configuration).listEngines(e).then((e=>e(this.axios,this.basePath)))}listFiles(e){return t.OpenAIApiFp(this.configuration).listFiles(e).then((e=>e(this.axios,this.basePath)))}listFineTuneEvents(e,n,r){return t.OpenAIApiFp(this.configuration).listFineTuneEvents(e,n,r).then((e=>e(this.axios,this.basePath)))}listFineTunes(e){return t.OpenAIApiFp(this.configuration).listFineTunes(e).then((e=>e(this.axios,this.basePath)))}listModels(e){return t.OpenAIApiFp(this.configuration).listModels(e).then((e=>e(this.axios,this.basePath)))}retrieveEngine(e,n){return t.OpenAIApiFp(this.configuration).retrieveEngine(e,n).then((e=>e(this.axios,this.basePath)))}retrieveFile(e,n){return t.OpenAIApiFp(this.configuration).retrieveFile(e,n).then((e=>e(this.axios,this.basePath)))}retrieveFineTune(e,n){return t.OpenAIApiFp(this.configuration).retrieveFineTune(e,n).then((e=>e(this.axios,this.basePath)))}retrieveModel(e,n){return t.OpenAIApiFp(this.configuration).retrieveModel(e,n).then((e=>e(this.axios,this.basePath)))}}t.OpenAIApi=a},5198:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequiredError=t.BaseAPI=t.COLLECTION_FORMATS=t.BASE_PATH=void 0;const r=n(9669);t.BASE_PATH="https://api.openai.com/v1".replace(/\/+$/,""),t.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"\t",pipes:"|"},t.BaseAPI=class{constructor(e,n=t.BASE_PATH,o=r.default){this.basePath=n,this.axios=o,e&&(this.configuration=e,this.basePath=e.basePath||this.basePath)}};class o extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}t.RequiredError=o},3597:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestFunction=t.toPathString=t.serializeDataIfNeeded=t.setSearchParams=t.setOAuthToObject=t.setBearerAuthToObject=t.setBasicAuthToObject=t.setApiKeyToObject=t.assertParamExists=t.DUMMY_BASE_URL=void 0;const o=n(5198);function i(e,t,n=""){null!=t&&("object"==typeof t?Array.isArray(t)?t.forEach((t=>i(e,t,n))):Object.keys(t).forEach((r=>i(e,t[r],`${n}${""!==n?".":""}${r}`))):e.has(n)?e.append(n,t):e.set(n,t))}t.DUMMY_BASE_URL="https://example.com",t.assertParamExists=function(e,t,n){if(null==n)throw new o.RequiredError(t,`Required parameter ${t} was null or undefined when calling ${e}.`)},t.setApiKeyToObject=function(e,t,n){return r(this,void 0,void 0,(function*(){if(n&&n.apiKey){const r="function"==typeof n.apiKey?yield n.apiKey(t):yield n.apiKey;e[t]=r}}))},t.setBasicAuthToObject=function(e,t){t&&(t.username||t.password)&&(e.auth={username:t.username,password:t.password})},t.setBearerAuthToObject=function(e,t){return r(this,void 0,void 0,(function*(){if(t&&t.accessToken){const n="function"==typeof t.accessToken?yield t.accessToken():yield t.accessToken;e.Authorization="Bearer "+n}}))},t.setOAuthToObject=function(e,t,n,o){return r(this,void 0,void 0,(function*(){if(o&&o.accessToken){const r="function"==typeof o.accessToken?yield o.accessToken(t,n):yield o.accessToken;e.Authorization="Bearer "+r}}))},t.setSearchParams=function(e,...t){const n=new URLSearchParams(e.search);i(n,t),e.search=n.toString()},t.serializeDataIfNeeded=function(e,t,n){const r="string"!=typeof e;return(r&&n&&n.isJsonMime?n.isJsonMime(t.headers["Content-Type"]):r)?JSON.stringify(void 0!==e?e:{}):e||""},t.toPathString=function(e){return e.pathname+e.search+e.hash},t.createRequestFunction=function(e,t,n,r){return(o=t,i=n)=>{const u=Object.assign(Object.assign({},e.options),{url:((null==r?void 0:r.basePath)||i)+e.url});return o.request(u)}}},6577:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;const r=n(2811);t.Configuration=class{constructor(e={}){this.apiKey=e.apiKey,this.organization=e.organization,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor,this.baseOptions||(this.baseOptions={}),this.baseOptions.headers=Object.assign({"User-Agent":`OpenAI/NodeJS/${r.version}`,Authorization:`Bearer ${this.apiKey}`},this.baseOptions.headers),this.organization&&(this.baseOptions.headers["OpenAI-Organization"]=this.organization),this.formDataCtor||(this.formDataCtor=n(6230))}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==e&&(t.test(e)||"application/json-patch+json"===e.toLowerCase())}}},6485:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(4793),t),o(n(6577),t)},2408:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),s=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator,d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||d}function g(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||d}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},g.prototype=v.prototype;var D=b.prototype=new g;D.constructor=b,y(D,v.prototype),D.isPureReactComponent=!0;var w=Array.isArray,E=Object.prototype.hasOwnProperty,A={current:null},F={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var o,i={},u=null,a=null;if(null!=t)for(o in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(u=""+t.key),t)E.call(t,o)&&!F.hasOwnProperty(o)&&(i[o]=t[o]);var s=arguments.length-2;if(1===s)i.children=r;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(o in s=e.defaultProps)void 0===i[o]&&(i[o]=s[o]);return{$$typeof:n,type:e,key:u,ref:a,props:i,_owner:A.current}}function x(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var _=/\/+/g;function O(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function S(e,t,o,i,u){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var s=!1;if(null===e)s=!0;else switch(a){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case n:case r:s=!0}}if(s)return u=u(s=e),e=""===i?"."+O(s,0):i,w(u)?(o="",null!=e&&(o=e.replace(_,"$&/")+"/"),S(u,t,o,"",(function(e){return e}))):null!=u&&(x(u)&&(u=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(u,o+(!u.key||s&&s.key===u.key?"":(""+u.key).replace(_,"$&/")+"/")+e)),t.push(u)),1;if(s=0,i=""===i?".":i+":",w(e))for(var c=0;c<e.length;c++){var l=i+O(a=e[c],c);s+=S(a,t,o,l,u)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),c=0;!(a=e.next()).done;)s+=S(a=a.value,t,o,l=i+O(a,c++),u);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function B(e,t,n){if(null==e)return e;var r=[],o=0;return S(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function j(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},k={transition:null},T={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:k,ReactCurrentOwner:A};t.Children={map:B,forEach:function(e,t,n){B(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return B(e,(function(){t++})),t},toArray:function(e){return B(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=o,t.Profiler=u,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=y({},e.props),i=e.key,u=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(u=t.ref,a=A.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in t)E.call(t,c)&&!F.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==s?s[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];o.children=s}return{$$typeof:n,type:e.type,key:i,ref:u,props:o,_owner:a}},t.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:j}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},7294:(e,t,n)=>{"use strict";e.exports=n(2408)},9520:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Dexie:()=>Zn,RangeSet:()=>$n,default:()=>Zn,liveQuery:()=>rr,mergeRanges:()=>zn,rangesOverlap:()=>Yn});const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=Object.keys,i=Array.isArray;function u(e,t){return"object"!=typeof t||o(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||r.Promise||(r.Promise=Promise);const a=Object.getPrototypeOf,s={}.hasOwnProperty;function c(e,t){return s.call(e,t)}function l(e,t){"function"==typeof t&&(t=t(a(e))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(t).forEach((n=>{h(e,n,t[n])}))}const f=Object.defineProperty;function h(e,t,n,r){f(e,t,u(n&&c(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),h(e.prototype,"constructor",e),{extend:l.bind(null,e.prototype)}}}}const d=Object.getOwnPropertyDescriptor;function y(e,t){let n;return d(e,t)||(n=a(e))&&y(n,t)}const m=[].slice;function v(e,t,n){return m.call(e,t,n)}function g(e,t){return t(e)}function b(e){if(!e)throw new Error("Assertion Failed")}function D(e){r.setImmediate?setImmediate(e):setTimeout(e,0)}function w(e,t){return e.reduce(((e,n,r)=>{var o=t(n,r);return o&&(e[o[0]]=o[1]),e}),{})}function E(e,t){if(c(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,o=t.length;r<o;++r){var i=E(e,t[r]);n.push(i)}return n}var u=t.indexOf(".");if(-1!==u){var a=e[t.substr(0,u)];return void 0===a?void 0:E(a,t.substr(u+1))}}function A(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){b("string"!=typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)A(e,t[r],n[r])}else{var u=t.indexOf(".");if(-1!==u){var a=t.substr(0,u),s=t.substr(u+1);if(""===s)void 0===n?i(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var l=e[a];l&&c(e,a)||(l=e[a]={}),A(l,s,n)}}else void 0===n?i(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function F(e){var t={};for(var n in e)c(e,n)&&(t[n]=e[n]);return t}const C=[].concat;function x(e){return C.apply([],e)}const _="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(x([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>r[e])),O=_.map((e=>r[e]));w(_,(e=>[e,!0]));let S=null;function B(e){S="undefined"!=typeof WeakMap&&new WeakMap;const t=j(e);return S=null,t}function j(e){if(!e||"object"!=typeof e)return e;let t=S&&S.get(e);if(t)return t;if(i(e)){t=[],S&&S.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(j(e[n]))}else if(O.indexOf(e.constructor)>=0)t=e;else{const n=a(e);for(var o in t=n===Object.prototype?{}:Object.create(n),S&&S.set(e,t),e)c(e,o)&&(t[o]=j(e[o]))}return t}const{toString:P}={};function k(e){return P.call(e).slice(8,-1)}const T="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",L="symbol"==typeof T?function(e){var t;return null!=e&&(t=e[T])&&t.apply(e)}:function(){return null},I={};function R(e){var t,n,r,o;if(1===arguments.length){if(i(e))return e.slice();if(this===I&&"string"==typeof e)return[e];if(o=L(e)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const M="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var N="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function U(e,t){N=e,q=t}var q=()=>!0;const K=!new Error("").stack;function H(){if(K)try{throw H.arguments,new Error}catch(e){return e}return new Error}function G(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(q).map((e=>"\n"+e)).join("")):""}var $=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],V=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat($),z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Y(e,t){this._e=H(),this.name=e,this.message=t}function J(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function W(e,t,n,r){this._e=H(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=J(e,t)}function X(e,t){this._e=H(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=J(e,t)}p(Y).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+G(this._e,2))}},toString:function(){return this.name+": "+this.message}}),p(W).from(Y),p(X).from(Y);var Q=V.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const Z=Y;var ee=V.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=H(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=z[t]||n,this.inner=null)}return p(r).from(Z),e[t]=r,e}),{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=$.reduce(((e,t)=>(e[t+"Error"]=ee[t],e)),{}),ne=V.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e)),{});function re(){}function oe(e){return e}function ie(e,t){return null==e||e===oe?t:function(n){return t(e(n))}}function ue(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ae(e,t){return e===re?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ue(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ue(o,this.onerror):o),void 0!==i?i:n}}function se(e,t){return e===re?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ue(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ue(r,this.onerror):r)}}function ce(e,t){return e===re?t:function(n){var r=e.apply(this,arguments);u(n,r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?ue(o,this.onsuccess):o),i&&(this.onerror=this.onerror?ue(i,this.onerror):i),void 0===r?void 0===a?void 0:a:u(r,a)}}function le(e,t){return e===re?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===re?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return n.then((function(){return t.apply(r,i)}))}return t.apply(this,arguments)}}ne.ModifyError=W,ne.DexieError=Y,ne.BulkError=X;var he={};const pe=100,[de,ye,me]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,a(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,a(t),e]})(),ve=ye&&ye.then,ge=de&&de.constructor,be=!!me;var De=!1,we=me?()=>{me.then(Ge)}:r.setImmediate?setImmediate.bind(null,Ge):r.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Ge(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Ge,0)},Ee=function(e,t){je.push([e,t]),Fe&&(we(),Fe=!1)},Ae=!0,Fe=!0,Ce=[],xe=[],_e=null,Oe=oe,Se={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:yt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{yt(e[0],e[1])}catch(e){}}))}},Be=Se,je=[],Pe=0,ke=[];function Te(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=re,this._lib=!1;var t=this._PSD=Be;if(N&&(this._stackHolder=H(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==he)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Me(this,this._value))}this._state=null,this._value=null,++t.ref,Re(this,e)}const Le={get:function(){var e=Be,t=et;function n(n,r){var o=!e.global&&(e!==Be||t!==et);const i=o&&!ot();var u=new Te(((t,u)=>{Ue(this,new Ie(ht(n,e,o,i),ht(r,e,o,i),t,u,e))}));return N&&He(u,this),u}return n.prototype=he,n},set:function(e){h(this,"then",e&&e.prototype===he?Le:{get:function(){return e},set:Le.set})}};function Ie(e,t,n,r,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=o}function Re(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&$e();t&&"function"==typeof t.then?Re(e,((e,n)=>{t instanceof Te?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Ne(e)),n&&Ve()}}),Me.bind(null,e))}catch(t){Me(e,t)}}function Me(e,t){if(xe.push(t),null===e._state){var n=e._lib&&$e();t=Oe(t),e._state=!1,e._value=t,N&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=y(t,"stack");t._promise=e,h(t,"stack",{get:()=>De?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Ce.some((t=>t._value===e._value))||Ce.push(e)}(e),Ne(e),n&&Ve()}}function Ne(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Ue(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),0===Pe&&(++Pe,Ee((()=>{0==--Pe&&ze()}),[]))}function Ue(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Pe,Ee(qe,[n,e,t])}else e._listeners.push(t)}function qe(e,t,n){try{_e=t;var r,o=t._value;t._state?r=e(o):(xe.length&&(xe=[]),r=e(o),-1===xe.indexOf(o)&&function(e){for(var t=Ce.length;t;)if(Ce[--t]._value===e._value)return void Ce.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{_e=null,0==--Pe&&ze(),--n.psd.ref||n.psd.finalize()}}function Ke(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var o,i,u=e._value;null!=u?(o=u.name||"Error",i=u.message||u,r=G(u,0)):(o=u,i=""),t.push(o+(i?": "+i:"")+r)}return N&&((r=G(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ke(e._prev,t,n)),t}function He(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ge(){$e()&&Ve()}function $e(){var e=Ae;return Ae=!1,Fe=!1,e}function Ve(){var e,t,n;do{for(;je.length>0;)for(e=je,je=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(je.length>0);Ae=!0,Fe=!0}function ze(){var e=Ce;Ce=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=ke.slice(0),n=t.length;n;)t[--n]()}function Ye(e){return new Te(he,!1,e)}function Je(e,t){var n=Be;return function(){var r=$e(),o=Be;try{return st(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{st(o,!1),r&&Ve()}}}l(Te.prototype,{then:Le,_then:function(e,t){Ue(this,new Ie(null,null,e,t,Be))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):Ye(e))):this.then(null,(e=>e&&e.name===t?n(e):Ye(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Ye(t))))},stack:{get:function(){if(this._stack)return this._stack;try{De=!0;var e=Ke(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{De=!1}}},timeout:function(e,t){return e<1/0?new Te(((n,r)=>{var o=setTimeout((()=>r(new ee.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&h(Te.prototype,Symbol.toStringTag,"Dexie.Promise"),Se.env=ct(),l(Te,{all:function(){var e=R.apply(null,arguments).map(it);return new Te((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((o,i)=>Te.resolve(o).then((n=>{e[i]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Te)return e;if(e&&"function"==typeof e.then)return new Te(((t,n)=>{e.then(t,n)}));var t=new Te(he,!0,e);return He(t,_e),t},reject:Ye,race:function(){var e=R.apply(null,arguments).map(it);return new Te(((t,n)=>{e.map((e=>Te.resolve(e).then(t,n)))}))},PSD:{get:()=>Be,set:e=>Be=e},totalEchoes:{get:()=>et},newPSD:nt,usePSD:lt,scheduler:{get:()=>Ee,set:e=>{Ee=e}},rejectionMapper:{get:()=>Oe,set:e=>{Oe=e}},follow:(e,t)=>new Te(((n,r)=>nt(((t,n)=>{var r=Be;r.unhandleds=[],r.onunhandled=n,r.finalize=ue((function(){!function(e){ke.push((function t(){e(),ke.splice(ke.indexOf(t),1)})),++Pe,Ee((()=>{0==--Pe&&ze()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),ge&&(ge.allSettled&&h(Te,"allSettled",(function(){const e=R.apply(null,arguments).map(it);return new Te((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,o)=>Te.resolve(e).then((e=>r[o]={status:"fulfilled",value:e}),(e=>r[o]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),ge.any&&"undefined"!=typeof AggregateError&&h(Te,"any",(function(){const e=R.apply(null,arguments).map(it);return new Te(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const o=new Array(r);e.forEach(((e,i)=>Te.resolve(e).then((e=>t(e)),(e=>{o[i]=e,--r||n(new AggregateError(o))}))))}))})));const We={awaits:0,echoes:0,id:0};var Xe=0,Qe=[],Ze=0,et=0,tt=0;function nt(e,t,n,r){var o=Be,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,i.id=++tt;var a=Se.env;i.env=be?{Promise:Te,PromiseProp:{value:Te,configurable:!0,writable:!0},all:Te.all,race:Te.race,allSettled:Te.allSettled,any:Te.any,resolve:Te.resolve,reject:Te.reject,nthen:pt(a.nthen,i),gthen:pt(a.gthen,i)}:{},t&&u(i,t),++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=lt(i,e,n,r);return 0===i.ref&&i.finalize(),s}function rt(){return We.id||(We.id=++Xe),++We.awaits,We.echoes+=pe,We.id}function ot(){return!!We.awaits&&(0==--We.awaits&&(We.id=0),We.echoes=We.awaits*pe,!0)}function it(e){return We.echoes&&e&&e.constructor===ge?(rt(),e.then((e=>(ot(),e)),(e=>(ot(),mt(e))))):e}function ut(e){++et,We.echoes&&0!=--We.echoes||(We.echoes=We.id=0),Qe.push(Be),st(e,!0)}function at(){var e=Qe[Qe.length-1];Qe.pop(),st(e,!1)}function st(e,t){var n=Be;if((t?!We.echoes||Ze++&&e===Be:!Ze||--Ze&&e===Be)||ft(t?ut.bind(null,e):at),e!==Be&&(Be=e,n===Se&&(Se.env=ct()),be)){var o=Se.env.Promise,i=e.env;ye.then=i.nthen,o.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(r,"Promise",i.PromiseProp),o.all=i.all,o.race=i.race,o.resolve=i.resolve,o.reject=i.reject,i.allSettled&&(o.allSettled=i.allSettled),i.any&&(o.any=i.any))}}function ct(){var e=r.Promise;return be?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ye.then,gthen:e.prototype.then}:{}}function lt(e,t,n,r,o){var i=Be;try{return st(e,!0),t(n,r,o)}finally{st(i,!1)}}function ft(e){ve.call(de,e)}function ht(e,t,n,r){return"function"!=typeof e?e:function(){var o=Be;n&&rt(),st(t,!0);try{return e.apply(this,arguments)}finally{st(o,!1),r&&ft(ot)}}}function pt(e,t){return function(n,r){return e.call(this,ht(n,t),ht(r,t))}}-1===(""+ve).indexOf("[native code]")&&(rt=ot=re);const dt="unhandledrejection";function yt(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var o,i={promise:t,reason:e};if(r.document&&document.createEvent?((o=document.createEvent("Event")).initEvent(dt,!0,!0),u(o,i)):r.CustomEvent&&u(o=new CustomEvent(dt,{detail:i}),i),o&&r.dispatchEvent&&(dispatchEvent(o),!r.PromiseRejectionEvent&&r.onunhandledrejection))try{r.onunhandledrejection(o)}catch(e){}N&&o&&!o.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}var mt=Te.reject;function vt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Be.letThrough||e._vip)){var o=e._createTransaction(t,n,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===Q.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>vt(e,t,n,r)))):mt(o)}return o._promise(t,((e,t)=>nt((()=>(Be.trans=o,r(e,t,o)))))).then((e=>o._completion.then((()=>e))))}if(e._state.openComplete)return mt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return mt(new ee.DatabaseClosed);e.open().catch(re)}return e._state.dbReadyPromise.then((()=>vt(e,t,n,r)))}const gt="3.2.4",bt=String.fromCharCode(65535),Dt=-1/0,wt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Et="String expected.",At=[],Ft="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ct=Ft,xt=Ft,_t=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),Ot="__dbnames",St="readonly",Bt="readwrite";function jt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Pt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function kt(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=B(t))[e],t)}class Tt{_trans(e,t,n){const r=this._tx||Be.trans,o=this.name;function i(e,n,r){if(!r.schema[o])throw new ee.NotFound("Table "+o+" not part of transaction");return t(r.idbtrans,r)}const u=$e();try{return r&&r.db===this.db?r===Be.trans?r._promise(e,i,n):nt((()=>r._promise(e,i,n)),{trans:r,transless:Be.transless||Be}):vt(this.db,e,[this.name],i)}finally{u&&Ve()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(i(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=o(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==bt)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&N&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,u=this.db._deps.indexedDB;function a(e,t){try{return 0===u.cmp(e,t)}catch(e){return!1}}const[s,c]=t.reduce((([t,n],o)=>{const u=r[o],s=e[o];return[t||u,t||!u?jt(n,u&&u.multi?e=>{const t=E(e,o);return i(t)&&t.some((e=>a(s,e)))}:e=>a(s,E(e,o))):n]}),[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(c):n?this.filter(c):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,i(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if(c(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){u(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=kt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[o]}))).then((e=>e.numFailures?Te.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{A(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||i(e))return this.where(":id").equals(e).modify(t);{const n=E(e,this.schema.primKey.keyPath);if(void 0===n)return mt(new ee.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?o(t).forEach((n=>{A(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=kt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[o],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Te.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{A(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Te.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Pt}))).then((e=>e.numFailures?Te.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,o=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let a=i&&n?e.map(kt(i)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:o}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return o?t:n;throw new X(`${this.name}.bulkAdd(): ${e} of ${u} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,o=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let a=i&&n?e.map(kt(i)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:o}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return o?t:n;throw new X(`${this.name}.bulkPut(): ${e} of ${u} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new X(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Lt(e){var t={},n=function(n,r){if(r){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return t[n].subscribe.apply(null,i),e}if("string"==typeof n)return t[n]};n.addEventType=a;for(var r=1,u=arguments.length;r<u;++r)a(arguments[r]);return n;function a(e,r,u){if("object"!=typeof e){var s;r||(r=le),u||(u=re);var c={subscribers:[],fire:u,subscribe:function(e){-1===c.subscribers.indexOf(e)&&(c.subscribers.push(e),c.fire=r(c.fire,e))},unsubscribe:function(e){c.subscribers=c.subscribers.filter((function(t){return t!==e})),c.fire=c.subscribers.reduce(r,u)}};return t[e]=n[e]=c,c}o(s=e).forEach((function(e){var t=s[e];if(i(t))a(e,s[e][0],s[e][1]);else{if("asap"!==t)throw new ee.InvalidArgument("Invalid event config");var n=a(e,oe,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){D((function(){e.apply(null,t)}))}))}))}}))}}function It(e,t){return p(t).from({prototype:e}),t}function Rt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Mt(e,t){e.filter=jt(e.filter,t)}function Nt(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>jt(r(),t()):t,e.justLimit=n&&!r}function Ut(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function qt(e,t,n){const r=Ut(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Kt(e,t,n,r){const o=e.replayFilter?jt(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},u=(e,n,r)=>{if(!o||o(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var u=n.primaryKey,a=""+u;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(u)),c(i,a)||(i[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(u,n),Ht(qt(e,r,n),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}return Ht(qt(e,r,n),jt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function Ht(e,t,n,r){var o=Je(r?(e,t,o)=>n(r(e),t,o):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=re}),(t=>{e.fail(t),n=re}))||o(e.value,e,(e=>n=e)),n()}))}))}function Gt(e,t){try{const n=$t(e),r=$t(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,o=n<r?n:r;for(let n=0;n<o;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(Vt(e),Vt(t));case"Array":return function(e,t){const n=e.length,r=t.length,o=n<r?n:r;for(let n=0;n<o;++n){const r=Gt(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function $t(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=k(e);return"ArrayBuffer"===n?"binary":n}function Vt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class zt{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,mt.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,mt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=jt(t.algorithm,e)}_iterate(e,t){return Kt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&u(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Kt(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Rt(t,!0))return n.count({trans:e,query:{index:Ut(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return Kt(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],o=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var u="next"===this._ctx.dir?1:-1;function a(e,t){var n=i(e,o),r=i(t,o);return n<r?-u:n>r?u:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Rt(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=Ut(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Kt(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Rt(t)?Nt(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Nt(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Nt(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Mt(this._ctx,(function(n,r,o){return!e(n.value)||(r(o),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Mt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=jt(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Rt(t,!0)&&t.limit>0)return this._read((e=>{var n=Ut(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Mt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=c(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var i=o(e),u=i.length;r=function(t){for(var n=!1,r=0;r<u;++r){var o=i[r],a=e[o];E(t,o)!==a&&(A(t,o,a),n=!0)}return n}}const a=t.table.core,{outbound:s,extractKey:c}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,f=[];let h=0;const p=[],d=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of o(n))f.push(n[e])};return this.clone().primaryKeys().then((o=>{const i=u=>{const f=Math.min(l,o.length-u);return a.getMany({trans:n,keys:o.slice(u,u+f),cache:"immutable"}).then((h=>{const p=[],y=[],m=s?[]:null,v=[];for(let e=0;e<f;++e){const t=h[e],n={value:B(t),primKey:o[u+e]};!1!==r.call(n,n.value,n)&&(null==n.value?v.push(o[u+e]):s||0===Gt(c(t),c(n.value))?(y.push(n.value),s&&m.push(o[u+e])):(v.push(o[u+e]),p.push(n.value)))}const g=Rt(t)&&t.limit===1/0&&("function"!=typeof e||e===Yt)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&a.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)v.splice(parseInt(t),1);d(p.length,e)}))).then((()=>(y.length>0||g&&"object"==typeof e)&&a.mutate({trans:n,type:"put",keys:m,values:y,criteria:g,changeSpec:"function"!=typeof e&&e}).then((e=>d(y.length,e))))).then((()=>(v.length>0||g&&e===Yt)&&a.mutate({trans:n,type:"delete",keys:v,criteria:g}).then((e=>d(v.length,e))))).then((()=>o.length>u+f&&i(u+l)))}))};return i(0).then((()=>{if(f.length>0)throw new W("Error modifying one or more objects",f,h,p);return o.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Rt(e)&&(e.isPrimKey&&!xt||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then((({failures:e,lastResult:n,results:r,numFailures:o})=>{if(o)throw new W("Could not delete some values",Object.keys(e).map((t=>e[t])),t-o);return t-o}))))})):this.modify(Yt)}}const Yt=(e,t)=>t.value=null;function Jt(e,t){return e<t?-1:e===t?0:1}function Wt(e,t){return e>t?-1:e===t?0:1}function Xt(e,t,n){var r=e instanceof rn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Qt(e){return new e.Collection(e,(()=>nn(""))).limit(0)}function Zt(e,t,n,r,o,i){for(var u=Math.min(e.length,r.length),a=-1,s=0;s<u;++s){var c=t[s];if(c!==r[s])return o(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):o(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;o(e[s],c)<0&&(a=s)}return u<r.length&&"next"===i?e+n.substr(e.length):u<e.length&&"prev"===i?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function en(e,t,n,r){var o,i,u,a,s,c,l,f=n.length;if(!n.every((e=>"string"==typeof e)))return Xt(e,Et);function h(e){o=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),i=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),u="next"===e?Jt:Wt;var t=n.map((function(e){return{lower:i(e),upper:o(e)}})).sort((function(e,t){return u(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),s=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}h("next");var p=new e.Collection(e,(()=>tn(a[0],s[f-1]+r)));p._ondirectionchange=function(e){h(e)};var d=0;return p._addAlgorithm((function(e,n,r){var o=e.key;if("string"!=typeof o)return!1;var h=i(o);if(t(h,s,d))return!0;for(var p=null,y=d;y<f;++y){var m=Zt(o,h,a[y],s[y],u,c);null===m&&null===p?d=y+1:(null===p||u(p,m)>0)&&(p=m)}return n(null!==p?function(){e.continue(p+l)}:r),!1})),p}function tn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function nn(e){return{type:1,lower:e,upper:e}}class rn{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Qt(this):new this.Collection(this,(()=>tn(e,t,!n,!r)))}catch(e){return Xt(this,wt)}}equals(e){return null==e?Xt(this,wt):new this.Collection(this,(()=>nn(e)))}above(e){return null==e?Xt(this,wt):new this.Collection(this,(()=>tn(e,void 0,!0)))}aboveOrEqual(e){return null==e?Xt(this,wt):new this.Collection(this,(()=>tn(e,void 0,!1)))}below(e){return null==e?Xt(this,wt):new this.Collection(this,(()=>tn(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Xt(this,wt):new this.Collection(this,(()=>tn(void 0,e)))}startsWith(e){return"string"!=typeof e?Xt(this,Et):this.between(e,e+bt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):en(this,((e,t)=>0===e.indexOf(t[0])),[e],bt)}equalsIgnoreCase(e){return en(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=R.apply(I,arguments);return 0===e.length?Qt(this):en(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=R.apply(I,arguments);return 0===e.length?Qt(this):en(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,bt)}anyOf(){const e=R.apply(I,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Xt(this,wt)}if(0===e.length)return Qt(this);const n=new this.Collection(this,(()=>tn(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,o,i)=>{const u=n.key;for(;t(u,e[r])>0;)if(++r,r===e.length)return o(i),!1;return 0===t(u,e[r])||(o((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[Dt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=R.apply(I,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Xt(this,wt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[Dt,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,o=this._descending,i=this._min,u=this._max;if(0===e.length)return Qt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Xt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);const a=!t||!1!==t.includeLowers,s=t&&!0===t.includeUppers;let c,l=r;function f(e,t){return l(e[0],t[0])}try{c=e.reduce((function(e,t){let r=0,o=e.length;for(;r<o;++r){const o=e[r];if(n(t[0],o[1])<0&&n(t[1],o[0])>0){o[0]=i(o[0],t[0]),o[1]=u(o[1],t[1]);break}}return r===o&&e.push(t),e}),[]),c.sort(f)}catch(e){return Xt(this,wt)}let h=0;const p=s?e=>r(e,c[h][1])>0:e=>r(e,c[h][1])>=0,d=a?e=>o(e,c[h][0])>0:e=>o(e,c[h][0])>=0;let y=p;const m=new this.Collection(this,(()=>tn(c[0][0],c[c.length-1][1],!a,!s)));return m._ondirectionchange=e=>{"next"===e?(y=p,l=r):(y=d,l=o),c.sort(f)},m._addAlgorithm(((e,t,n)=>{for(var o=e.key;y(o);)if(++h,h===c.length)return t(n),!1;return!!function(e){return!p(e)&&!d(e)}(o)||(0===this._cmp(o,c[h][1])||0===this._cmp(o,c[h][0])||t((()=>{l===r?e.continue(c[h][0]):e.continue(c[h][1])})),!1)})),m}startsWithAnyOf(){const e=R.apply(I,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Qt(this):this.inAnyRange(e.map((e=>[e,e+bt]))):Xt(this,"startsWithAnyOf() only works with strings")}}function on(e){return Je((function(t){return un(t),e(t.target.error),!1}))}function un(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const an="storagemutated",sn="x-storagemutated-1",cn=Lt(null,an);class ln{_lock(){return b(!Be.global),++this._reculock,1!==this._reculock||Be.global||(Be.lockOwnerFor=this),this}_unlock(){if(b(!Be.global),0==--this._reculock)for(Be.global||(Be.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{lt(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Be.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(b(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(n);case"MissingAPIError":throw new ee.MissingAPI(n.message,n);default:throw new ee.OpenFailed(n)}if(!this.active)throw new ee.TransactionInactive;return b(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Je((t=>{un(t),this._reject(e.error)})),e.onabort=Je((t=>{un(t),this.active&&this._reject(new ee.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Je((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&cn.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return mt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return mt(new ee.TransactionInactive);if(this._locked())return new Te(((r,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,o)},Be])}));if(n)return nt((()=>{var e=new Te(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Te(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Te.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var o=t._waitingFor;return new Te(((e,r)=>{n.then((n=>t._waitingQueue.push(Je(e.bind(null,n)))),(e=>t._waitingQueue.push(Je(r.bind(null,e))))).finally((()=>{t._waitingFor===o&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(c(t,e))return t[e];const n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function fn(e,t,n,r,o,i,u){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:i,src:(n&&!u?"&":"")+(r?"*":"")+(o?"++":"")+hn(t)}}function hn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function pn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:w(n,(e=>[e.name,e]))}}let dn=e=>{try{return e.only([[]]),dn=()=>[[]],[[]]}catch(e){return dn=()=>bt,bt}};function yn(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>E(t,e)}(e):t=>E(t,e)}function mn(e){return[].slice.call(e)}let vn=0;function gn(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function bn(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:o,upperOpen:i}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!i):void 0===r?t.lowerBound(n,!!o):t.bound(n,r,!!o,!!i)}const{schema:o,hasGetAll:u}=function(e,t){const n=mn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=i(t),o=null==t,u={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:yn(t)},indexes:mn(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:o}=e,a={name:t,compound:i(o),keyPath:o,unique:n,multiEntry:r,extractKey:yn(o)};return u[gn(o)]=a,a})),getIndexByKeyPath:e=>u[gn(e)]};return u[":id"]=a.primaryKey,null!=t&&(u[gn(t)]=a.primaryKey),a}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),a=o.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:o,values:i,range:u}){return new Promise(((a,s)=>{a=Je(a);const c=e.objectStore(t),l=null==c.keyPath,f="put"===n||"add"===n;if(!f&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:h}=o||i||{length:1};if(o&&i&&o.length!==i.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const d=[],y=[];let m=0;const v=e=>{++m,un(e)};if("deleteRange"===n){if(4===u.type)return a({numFailures:m,failures:y,results:[],lastResult:void 0});3===u.type?d.push(p=c.clear()):d.push(p=c.delete(r(u)))}else{const[e,t]=f?l?[i,o]:[i,null]:[o,null];if(f)for(let r=0;r<h;++r)d.push(p=t&&void 0!==t[r]?c[n](e[r],t[r]):c[n](e[r])),p.onerror=v;else for(let t=0;t<h;++t)d.push(p=c[n](e[t])),p.onerror=v}const g=e=>{const t=e.target.result;d.forEach(((e,t)=>null!=e.error&&(y[t]=e.error))),a({numFailures:m,failures:y,results:"delete"===n?o:d.map((e=>e.result)),lastResult:t})};p.onerror=e=>{v(e),g(e)},p.onsuccess=g}))},getMany:({trans:e,keys:n})=>new Promise(((r,o)=>{r=Je(r);const i=e.objectStore(t),u=n.length,a=new Array(u);let s,c=0,l=0;const f=e=>{const t=e.target;a[t._pos]=t.result,++l===c&&r(a)},h=on(o);for(let e=0;e<u;++e)null!=n[e]&&(s=i.get(n[e]),s._pos=e,s.onsuccess=f,s.onerror=h,++c);0===c&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,o)=>{r=Je(r);const i=e.objectStore(t).get(n);i.onsuccess=e=>r(e.target.result),i.onerror=on(o)})),query:function(e){return n=>new Promise(((o,i)=>{o=Je(o);const{trans:u,values:a,limit:s,query:c}=n,l=s===1/0?void 0:s,{index:f,range:h}=c,p=u.objectStore(t),d=f.isPrimaryKey?p:p.index(f.name),y=r(h);if(0===s)return o({result:[]});if(e){const e=a?d.getAll(y,l):d.getAllKeys(y,l);e.onsuccess=e=>o({result:e.target.result}),e.onerror=on(i)}else{let e=0;const t=a||!("openKeyCursor"in d)?d.openCursor(y):d.openKeyCursor(y),n=[];t.onsuccess=r=>{const i=t.result;return i?(n.push(a?i.value:i.primaryKey),++e===s?o({result:n}):void i.continue()):o({result:n})},t.onerror=on(i)}}))}(u),openCursor:function({trans:e,values:n,query:o,reverse:i,unique:u}){return new Promise(((a,s)=>{a=Je(a);const{index:c,range:l}=o,f=e.objectStore(t),h=c.isPrimaryKey?f:f.index(c.name),p=i?u?"prevunique":"prev":u?"nextunique":"next",d=n||!("openKeyCursor"in h)?h.openCursor(r(l),p):h.openKeyCursor(r(l),p);d.onerror=on(s),d.onsuccess=Je((t=>{const n=d.result;if(!n)return void a(null);n.___id=++vn,n.done=!1;const r=n.continue.bind(n);let o=n.continuePrimaryKey;o&&(o=o.bind(n));const i=n.advance.bind(n),u=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Je(s),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=Je(e),d.onerror=on(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=u,e(t)}})),a=()=>{if(d.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return d.onsuccess=Je((e=>{d.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=o,n.advance=i,a(),t},a(n)}),s)}))},count({query:e,trans:n}){const{index:o,range:i}=e;return new Promise(((e,u)=>{const a=n.objectStore(t),s=o.isPrimaryKey?a:a.index(o.name),c=r(i),l=c?s.count(c):s.count();l.onsuccess=Je((t=>e(t.target.result))),l.onerror=on(u)}))}}}(e))),s={};return a.forEach((e=>s[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!s[e])throw new Error(`Table '${e}' not found`);return s[e]},MIN_KEY:-1/0,MAX_KEY:dn(t),schema:o}}function Dn({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},o){const i=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(bn(t,n,o),e.dbcore);return{dbcore:i}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function wn({_novip:e},t,n,r){n.forEach((n=>{const o=r[n];t.forEach((t=>{const r=y(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?h(t,n,{get(){return this.table(n)},set(e){f(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,o))}))}))}function En({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function An(e,t){return e._cfg.version-t._cfg.version}function Fn(e,t,n,r){const i=e._dbSchema,u=e._createTransaction("readwrite",e._storeNames,i);u.create(n),u._completion.catch(r);const a=u._reject.bind(u),s=Be.transless||Be;nt((()=>{Be.trans=u,Be.transless=s,0===t?(o(i).forEach((e=>{xn(n,e,i[e].primKey,i[e].indexes)})),Dn(e,n),Te.follow((()=>e.on.populate.fire(u))).catch(a)):function({_novip:e},t,n,r){const i=[],u=e._versions;let a=e._dbSchema=On(0,e.idbdb,r),s=!1;const c=u.filter((e=>e._cfg.version>=t));return c.forEach((u=>{i.push((()=>{const i=a,c=u._cfg.dbschema;Sn(e,i,r),Sn(e,c,r),a=e._dbSchema=c;const l=Cn(i,c);l.add.forEach((e=>{xn(r,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((e=>{if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>_n(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),_n(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const f=u._cfg.contentUpgrade;if(f&&u._cfg.version>t){Dn(e,r),n._memoizedTables={},s=!0;let t=F(c);l.del.forEach((e=>{t[e]=i[e]})),En(e,[e.Transaction.prototype]),wn(e,[e.Transaction.prototype],o(t),t),n.schema=t;const u=M(f);let a;u&&rt();const h=Te.follow((()=>{if(a=f(n),a&&u){var e=ot.bind(null,null);a.then(e,e)}}));return a&&"function"==typeof a.then?Te.resolve(a):h.then((()=>a))}})),i.push((t=>{s&&Ct||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(u._cfg.dbschema,t),En(e,[e.Transaction.prototype]),wn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return i.length?Te.resolve(i.shift()(n.idbtrans)).then(e):Te.resolve()}().then((()=>{var e,t;t=r,o(e=a).forEach((n=>{t.db.objectStoreNames.contains(n)||xn(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,u,n).catch(a)}))}function Cn(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const o=e[r],i=t[r];if(o){const e={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||o.primKey.auto!==i.primKey.auto&&!Ft)e.recreate=!0,n.change.push(e);else{const t=o.idxByName,r=i.idxByName;let u;for(u in t)r[u]||e.del.push(u);for(u in r){const n=t[u],o=r[u];n?n.src!==o.src&&e.change.push(o):e.add.push(o)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,i])}return n}function xn(e,t,n,r){const o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>_n(o,e))),o}function _n(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function On(e,t,n){const r={};return v(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let o=t.keyPath;const i=fn(hn(o),o||"",!1,!1,!!t.autoIncrement,o&&"string"!=typeof o,!0),u=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);o=n.keyPath;var a=fn(n.name,o,!!n.unique,!!n.multiEntry,!1,o&&"string"!=typeof o,!1);u.push(a)}r[e]=pn(e,i,u)})),r}function Sn({_novip:e},t,n){const o=n.db.objectStoreNames;for(let r=0;r<o.length;++r){const i=o[r],u=n.objectStore(i);e._hasGetAll="getAll"in u;for(let e=0;e<u.indexNames.length;++e){const n=u.indexNames[e],r=u.index(n).keyPath,o="string"==typeof r?r:"["+v(r).join("+")+"]";if(t[i]){const e=t[i].idxByName[o];e&&(e.name=n,delete t[i].idxByName[o],t[i].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Bn{_parseStoresSpec(e,t){o(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return fn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),i(r),0===t)})),o=r.shift();if(o.multi)throw new ee.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")})),t[n]=pn(n,o,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,e):e;const n=t._versions,r={};let i={};return n.forEach((e=>{u(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,En(t,[t._allTables,t,t.Transaction.prototype]),wn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],o(i),i),t._storeNames=o(i),this}upgrade(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||re,e),this}}function jn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Zn(Ot,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Pn(e){return e&&"function"==typeof e.databases}function kn(e){return nt((function(){return Be.letThrough=!0,e()}))}function Tn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Ln(e){var t=t=>e.next(t),n=o(t),r=o((t=>e.throw(t)));function o(e){return t=>{var o=e(t),u=o.value;return o.done?u:u&&"function"==typeof u.then?u.then(n,r):i(u)?Promise.all(u).then(n,r):n(u)}}return o(t)()}function In(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];return n=o.pop(),[e,x(o),n]}function Rn(e,t,n,r,o){return Te.resolve().then((()=>{const i=Be.transless||Be,u=e._createTransaction(t,n,e._dbSchema,r),a={trans:u,transless:i};if(r)u.idbtrans=r.idbtrans;else try{u.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===Q.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Rn(e,t,n,null,o)))):mt(r)}const s=M(o);let c;s&&rt();const l=Te.follow((()=>{if(c=o.call(u,u),c)if(s){var e=ot.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Ln(c))}),a);return(c&&"function"==typeof c.then?Te.resolve(c).then((e=>u.active?e:mt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>c))).then((e=>(r&&u._resolve(),u._completion.then((()=>e))))).catch((e=>(u._reject(e),mt(e))))}))}function Mn(e,t,n){const r=i(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Nn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,o={},i=[];function u(e,t,n){const r=gn(e),a=o[r]=o[r]||[],s=null==e?0:"string"==typeof e?1:e.length,c=t>0,l={...n,isVirtual:c,keyTail:t,keyLength:s,extractKey:yn(e),unique:!c&&n.unique};return a.push(l),l.isPrimaryKey||i.push(l),s>1&&u(2===s?e[0]:e.slice(0,s-1),t+1,n),a.sort(((e,t)=>e.keyTail-t.keyTail)),l}const a=u(r.primaryKey.keyPath,0,r.primaryKey);o[":id"]=[a];for(const e of r.indexes)u(e.keyPath,0,e);function s(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,o=n.keyTail,{type:1===r.type?2:r.type,lower:Mn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,o),lowerOpen:!0,upper:Mn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,o),upperOpen:!0})}}:t;var r,o}const c={...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function(e){const t=o[gn(e)];return t&&t[0]}},count:e=>n.count(s(e)),query:e=>n.query(s(e)),openCursor(t){const{keyTail:r,isVirtual:o,keyLength:i}=t.query.index;return o?n.openCursor(s(t)).then((n=>n&&function(n){const o=Object.create(n,{continue:{value:function(o){null!=o?n.continue(Mn(o,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,i).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,o){n.continuePrimaryKey(Mn(t,e.MAX_KEY,r),o)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:()=>n.value}});return o}(n))):n.openCursor(t)}};return c}}}};function Un(e,t,n,r){return n=n||{},r=r||"",o(e).forEach((o=>{if(c(t,o)){var i=e[o],u=t[o];if("object"==typeof i&&"object"==typeof u&&i&&u){const e=k(i);e!==k(u)?n[r+o]=t[o]:"Object"===e?Un(i,u,n,r+o+"."):i!==u&&(n[r+o]=t[o])}else i!==u&&(n[r+o]=t[o])}else n[r+o]=void 0})),o(t).forEach((o=>{c(e,o)||(n[r+o]=t[o])})),n}const qn={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,o={...n,mutate(e){const o=Be.trans,{deleting:i,creating:u,updating:a}=o.table(t).hook;switch(e.type){case"add":if(u.fire===re)break;return o._promise("readwrite",(()=>s(e)),!0);case"put":if(u.fire===re&&a.fire===re)break;return o._promise("readwrite",(()=>s(e)),!0);case"delete":if(i.fire===re)break;return o._promise("readwrite",(()=>s(e)),!0);case"deleteRange":if(i.fire===re)break;return o._promise("readwrite",(()=>function(e){return l(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function s(e){const t=Be.trans,o=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!o)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:o}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,o).then((s=>{const l=o.map(((n,o)=>{const l=s[o],f={onerror:null,onsuccess:null};if("delete"===e.type)i.fire.call(f,n,l,t);else if("add"===e.type||void 0===l){const i=u.fire.call(f,n,e.values[o],t);null==n&&null!=i&&(n=i,e.keys[o]=n,r.outbound||A(e.values[o],r.keyPath,n))}else{const r=Un(l,e.values[o]),i=a.fire.call(f,r,n,l,t);if(i){const t=e.values[o];Object.keys(i).forEach((e=>{c(t,e)?t[e]=i[e]:A(t,e,i[e])}))}}return f}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:i})=>{for(let r=0;r<o.length;++r){const i=n?n[r]:o[r],u=l[r];null==i?u.onerror&&u.onerror(t[r]):u.onsuccess&&u.onsuccess("put"===e.type&&s[r]?e.values[r]:i)}return{failures:t,results:n,numFailures:r,lastResult:i}})).catch((e=>(l.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function l(e,t,o){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:o}).then((({result:n})=>s({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<o?{failures:[],numFailures:0,lastResult:void 0}:l(e,{...t,lower:n[n.length-1],lowerOpen:!0},o)))))}}};return o}})};function Kn(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let o=0,i=0;o<t.keys.length&&i<e.length;++o)0===Gt(t.keys[o],e[i])&&(r.push(n?B(t.values[o]):t.values[o]),++i);return r.length===e.length?r:null}catch(e){return null}}const Hn={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=Kn(e.keys,e.trans._cache,"clone"===e.cache);return t?Te.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?B(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Gn(e){return!("from"in e)}const $n=function(e,t){if(!this){const t=new $n;return e&&"d"in e&&u(t,e),t}u(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Vn(e,t,n){const r=Gt(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Gn(e))return u(e,{from:t,to:n,d:1});const o=e.l,i=e.r;if(Gt(n,e.from)<0)return o?Vn(o,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Wn(e);if(Gt(t,e.to)>0)return i?Vn(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Wn(e);Gt(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),Gt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const a=!e.r;o&&!e.l&&zn(e,o),i&&a&&zn(e,i)}function zn(e,t){Gn(t)||function e(t,{from:n,to:r,l:o,r:i}){Vn(t,n,r),o&&e(t,o),i&&e(t,i)}(e,t)}function Yn(e,t){const n=Jn(t);let r=n.next();if(r.done)return!1;let o=r.value;const i=Jn(e);let u=i.next(o.from),a=u.value;for(;!r.done&&!u.done;){if(Gt(a.from,o.to)<=0&&Gt(a.to,o.from)>=0)return!0;Gt(o.from,a.from)<0?o=(r=n.next(a.from)).value:a=(u=i.next(o.from)).value}return!1}function Jn(e){let t=Gn(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Gt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Gt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Wn(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),o=r>1?"r":r<-1?"l":"";if(o){const t="r"===o?"l":"r",n={...e},r=e[o];e.from=r.from,e.to=r.to,e[o]=r[o],n[o]=r[t],e[t]=n,n.d=Xn(n)}e.d=Xn(e)}function Xn({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}l($n.prototype,{add(e){return zn(this,e),this},addKey(e){return Vn(this,e,e),this},addKeys(e){return e.forEach((e=>Vn(this,e,e))),this},[T](){return Jn(this)}});const Qn={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new $n(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const u=e.table(r),{schema:a}=u,{primaryKey:s}=a,{extractKey:c,outbound:l}=s,f={...u,mutate:e=>{const o=e.trans,s=o.mutatedParts||(o.mutatedParts={}),c=e=>{const n=`idb://${t}/${r}/${e}`;return s[n]||(s[n]=new $n)},l=c(""),f=c(":dels"),{type:h}=e;let[p,d]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const y=e.trans._cache;return u.mutate(e).then((e=>{if(i(p)){"delete"!==h&&(p=e.results),l.addKeys(p);const t=Kn(p,y);t||"add"===h||f.addKeys(p),(t||d)&&function(e,t,n,r){t.indexes.forEach((function(t){const o=e(t.name||"");function u(e){return null!=e?t.extractKey(e):null}const a=e=>t.multiEntry&&i(e)?e.forEach((e=>o.addKey(e))):o.addKey(e);(n||r).forEach(((e,t)=>{const o=n&&u(n[t]),i=r&&u(r[t]);0!==Gt(o,i)&&(null!=o&&a(o),null!=i&&a(i))}))}))}(c,a,t,d)}else if(p){const e={from:p.lower,to:p.upper};f.add(e),l.add(e)}else l.add(n),f.add(n),a.indexes.forEach((e=>c(e.name).add(n)));return e}))}},h=({query:{index:t,range:n}})=>{var r,o;return[t,new $n(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(o=n.upper)&&void 0!==o?o:e.MAX_KEY)]},p={get:e=>[s,new $n(e.key)],getMany:e=>[s,(new $n).addKeys(e.keys)],count:h,query:h,openCursor:h};return o(p).forEach((e=>{f[e]=function(o){const{subscr:i}=Be;if(i){const a=e=>{const n=`idb://${t}/${r}/${e}`;return i[n]||(i[n]=new $n)},s=a(""),f=a(":dels"),[h,d]=p[e](o);if(a(h.name||"").add(d),!h.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&o.values&&u.query({...o,values:!1});return u[e].apply(this,arguments).then((n=>{if("query"===e){if(l&&o.values)return t.then((({result:e})=>(s.addKeys(e),n)));const e=o.values?n.result.map(c):n.result;o.values?s.addKeys(e):f.addKeys(e)}else if("openCursor"===e){const e=n,t=o.values;return e&&Object.create(e,{key:{get:()=>(f.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return f.addKey(t),t}},value:{get:()=>(t&&s.addKey(e.primaryKey),e.value)}})}return n}))}f.add(n)}}return u[e].apply(this,arguments)}})),f}}}};class Zn{constructor(e,t){this._middlewares={},this.verno=0;const n=Zn.dependencies;this._options=t={addons:Zn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:re,dbReadyPromise:null,cancelOpen:re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new Te((e=>{o.dbReadyResolve=e})),o.openCanceller=new Te(((e,t)=>{o.cancelOpen=t})),this._state=o,this.name=e,this.on=Lt(this,"populate","blocked","versionchange","close",{ready:[fe,re]}),this.on.ready.subscribe=g(this.on.ready.subscribe,(e=>(t,n)=>{Zn.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Te.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=(i=this,It(zt.prototype,(function(e,t){this.db=i;let n=Pt,r=null;if(t)try{n=t()}catch(e){r=e}const o=e._ctx,u=o.table,a=u.hook.reading.fire;this._ctx={table:u,index:o.index,isPrimKey:!o.index||u.schema.primKey.keyPath&&o.index===u.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:a!==oe?a:null}}))),this.Table=function(e){return It(Tt.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Lt(null,{creating:[ae,re],reading:[ie,oe],updating:[ce,re],deleting:[se,re]})}))}(this),this.Transaction=function(e){return It(ln.prototype,(function(t,n,r,o,i){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Lt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Te(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),mt(e)}))}))}(this),this.Version=function(e){return It(Bn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return It(rn.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const o=e._deps.indexedDB;if(!o)throw new ee.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(e,t)=>o.cmp(t,e),this._max=(e,t)=>o.cmp(e,t)>0?e:t,this._min=(e,t)=>o.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=dn(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),At.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Nn),this.use(qn),this.use(Qn),this.use(Hn),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(An),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Be.letThrough||this._vip)?e():new Te(((e,t)=>{if(this._state.openComplete)return t(new ee.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new ee.DatabaseClosed);this.open().catch(re)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:t,level:null==n?10:n,name:r}),o.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?mt(t.dbOpenError):e));N&&(t.openCanceller._stackHolder=H()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new ee.DatabaseClosed("db.open() was cancelled")}let u=t.dbReadyResolve,a=null,s=!1;return Te.race([r,("undefined"==typeof navigator?Te.resolve():Tn()).then((()=>new Te(((r,u)=>{if(i(),!n)throw new ee.MissingAPI;const c=e.name,l=t.autoSchema?n.open(c):n.open(c,Math.round(10*e.verno));if(!l)throw new ee.MissingAPI;l.onerror=on(u),l.onblocked=Je(e._fireOnBlocked),l.onupgradeneeded=Je((r=>{if(a=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=un,a.abort(),l.result.close();const e=n.deleteDatabase(c);e.onsuccess=e.onerror=Je((()=>{u(new ee.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{a.onerror=on(u);var o=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;s=o<1,e._novip.idbdb=l.result,Fn(e,o/10,a,u)}}),u),l.onsuccess=Je((()=>{a=null;const n=e._novip.idbdb=l.result,i=v(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(u=i).length?u[0]:u,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=On(0,t,n);e._storeNames=v(t.objectStoreNames,0),wn(e,[e._allTables],o(r),r)}(e,n,r):(Sn(e,e._dbSchema,r),function(e,t){const n=Cn(On(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Dn(e,r)}catch(e){}var u;At.push(e),n.onversionchange=Je((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=Je((t=>{e.on("close").fire(t)})),s&&function({indexedDB:e,IDBKeyRange:t},n){!Pn(e)&&n!==Ot&&jn(e,t).put({name:n}).catch(re)}(e._deps,c),r()}),u)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Te.resolve(kn((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(fe,re);return t.onReadyBeingFired=[],Te.resolve(kn((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{a&&a.abort()}catch(e){}return r===t.openCanceller&&e._close(),mt(n)})).finally((()=>{t.openComplete=!0,u()}))}(this)}_close(){const e=this._state,t=At.indexOf(this);if(t>=0&&At.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Te((t=>{e.dbReadyResolve=t})),e.openCanceller=new Te(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new ee.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Te(((n,r)=>{const o=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Je((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!Pn(e)&&n!==Ot&&jn(e,t).delete(n).catch(re)}(this._deps,this.name),n()})),e.onerror=on(r),e.onblocked=this._fireOnBlocked};if(e)throw new ee.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(o):o()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return o(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=In.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=Be.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const o=-1!==e.indexOf("?");let i,u;e=e.replace("!","").replace("?","");try{if(u=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===St)i=St;else{if("rw"!=e&&e!=Bt)throw new ee.InvalidArgument("Invalid transaction mode: "+e);i=Bt}if(r){if(r.mode===St&&i===Bt){if(!o)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&u.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!o)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),o&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):mt(e)}const a=Rn.bind(null,this,i,u,r,n);return r?r._promise(i,a,"lock"):Be.trans?lt(Be.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!c(this._allTables,e))throw new ee.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const er="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class tr{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[er](){return this}}function nr(e,t){return o(t).forEach((n=>{zn(e[n]||(e[n]=new $n),t[n])})),e}function rr(e){let t,n=!1;const r=new tr((r=>{const i=M(e);let u=!1,a={},s={};const c={get closed(){return u},unsubscribe:()=>{u=!0,cn.storagemutated.unsubscribe(p)}};r.start&&r.start(c);let l=!1,f=!1;function h(){return o(s).some((e=>a[e]&&Yn(a[e],s[e])))}const p=e=>{nr(a,e),h()&&d()},d=()=>{if(l||u)return;a={};const o={},y=function(t){i&&rt();const n=()=>nt(e,{subscr:t,trans:null}),r=Be.trans?lt(Be.transless,n):n();return i&&r.then(ot,ot),r}(o);f||(cn(an,p),f=!0),l=!0,Promise.resolve(y).then((e=>{n=!0,t=e,l=!1,u||(h()?d():(a={},s=o,r.next&&r.next(e)))}),(e=>{l=!1,n=!1,r.error&&r.error(e),c.unsubscribe()}))};return d(),c}));return r.hasValue=()=>n,r.getValue=()=>t,r}let or;try{or={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch(r){or={indexedDB:null,IDBKeyRange:null}}const ir=Zn;function ur(e){let t=ar;try{ar=!0,cn.storagemutated.fire(e)}finally{ar=t}}l(ir,{...ne,delete:e=>new ir(e,{addons:[]}).delete(),exists:e=>new ir(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Pn(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>e!==Ot)))):jn(e,t).toCollection().primaryKeys()}(ir.dependencies).then(e)}catch(e){return mt(new ee.MissingAPI)}},defineClass:()=>function(e){u(this,e)},ignoreTransaction:e=>Be.trans?lt(Be.transless,e):e(),vip:kn,async:function(e){return function(){try{var t=Ln(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Te.resolve(t)}catch(e){return mt(e)}}},spawn:function(e,t,n){try{var r=Ln(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Te.resolve(r)}catch(e){return mt(e)}},currentTransaction:{get:()=>Be.trans||null},waitFor:function(e,t){const n=Te.resolve("function"==typeof e?ir.ignoreTransaction(e):e).timeout(t||6e4);return Be.trans?Be.trans.waitFor(n):n},Promise:Te,debug:{get:()=>N,set:e=>{U(e,"dexie"===e?()=>!0:_t)}},derive:p,extend:u,props:l,override:g,Events:Lt,on:cn,liveQuery:rr,extendObservabilitySet:nr,getByKeyPath:E,setByKeyPath:A,delByKeyPath:function(e,t){"string"==typeof t?A(e,t,void 0):"length"in t&&[].map.call(t,(function(t){A(e,t,void 0)}))},shallowClone:F,deepClone:B,getObjectDiff:Un,cmp:Gt,asap:D,minKey:Dt,addons:[],connections:At,errnames:Q,dependencies:or,semVer:gt,version:gt.split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),ir.maxKey=dn(ir.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(cn(an,(e=>{if(!ar){let t;Ft?(t=document.createEvent("CustomEvent"),t.initCustomEvent(sn,!0,!0,e)):t=new CustomEvent(sn,{detail:e}),ar=!0,dispatchEvent(t),ar=!1}})),addEventListener(sn,(({detail:e})=>{ar||ur(e)})));let ar=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel(sn);"function"==typeof e.unref&&e.unref(),cn(an,(t=>{ar||e.postMessage(t)})),e.onmessage=e=>{e.data&&ur(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){cn(an,(e=>{try{ar||("undefined"!=typeof localStorage&&localStorage.setItem(sn,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:sn,changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if(e.key===sn){const t=JSON.parse(e.newValue);t&&ur(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&e.type===sn&&ur(e.changedParts)}))}Te.rejectionMapper=function(e,t){if(!e||e instanceof Y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&h(n,"stack",{get:function(){return this.inner.stack}}),n},U(N,_t)},2811:e=>{"use strict";e.exports=JSON.parse('{"name":"openai","version":"3.3.0","description":"Node.js library for the OpenAI API","repository":{"type":"git","url":"git@github.com:openai/openai-node.git"},"keywords":["openai","open","ai","gpt-3","gpt3"],"author":"OpenAI","license":"MIT","main":"./dist/index.js","types":"./dist/index.d.ts","scripts":{"build":"tsc --outDir dist/"},"dependencies":{"axios":"^0.26.0","form-data":"^4.0.0"},"devDependencies":{"@types/node":"^12.11.5","typescript":"^3.6.4"}}')}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=n(9520),t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function r(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function o(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u}function a(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function s(e){return this instanceof s?(this.v=e,this):new s(e)}function c(e){return"function"==typeof e}function l(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var f=l((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function h(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var p=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var l=i(s),h=l.next();!h.done;h=l.next())h.value.remove(this)}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}else s.remove(this);var p=this.initialTeardown;if(c(p))try{p()}catch(e){o=e instanceof f?e.errors:[e]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var y=i(d),v=y.next();!v.done;v=y.next()){var g=v.value;try{m(g)}catch(e){o=null!=o?o:[],e instanceof f?o=a(a([],u(o)),u(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{v&&!v.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}}if(o)throw new f(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)m(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&h(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&h(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),d=p.EMPTY;function y(e){return e instanceof p||e&&"closed"in e&&c(e.remove)&&c(e.add)&&c(e.unsubscribe)}function m(e){c(e)?e():e.unsubscribe()}var v={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},g={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=g.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,a([e,t],u(n))):setTimeout.apply(void 0,a([e,t],u(n)))},clearTimeout:function(e){var t=g.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function b(e){g.setTimeout((function(){var t=v.onUnhandledError;if(!t)throw e;t(e)}))}function D(){}var w=E("C",void 0,void 0);function E(e,t,n){return{kind:e,value:t,error:n}}var A=null;function F(e){if(v.useDeprecatedSynchronousErrorHandling){var t=!A;if(t&&(A={errorThrown:!1,error:null}),e(),t){var n=A,r=n.errorThrown,o=n.error;if(A=null,r)throw o}}else e()}var C=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,y(t)&&t.add(n)):n.destination=P,n}return r(t,e),t.create=function(e,t,n){return new S(e,t,n)},t.prototype.next=function(e){this.isStopped?j(function(e){return E("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?j(E("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?j(w,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(p),x=Function.prototype.bind;function _(e,t){return x.call(e,t)}var O=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){B(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){B(e)}else B(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){B(e)}},e}(),S=function(e){function t(t,n,r){var o,i,u=e.call(this)||this;return c(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:u&&v.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return u.unsubscribe()},o={next:t.next&&_(t.next,i),error:t.error&&_(t.error,i),complete:t.complete&&_(t.complete,i)}):o=t,u.destination=new O(o),u}return r(t,e),t}(C);function B(e){var t;v.useDeprecatedSynchronousErrorHandling?(t=e,v.useDeprecatedSynchronousErrorHandling&&A&&(A.errorThrown=!0,A.error=t)):b(e)}function j(e,t){var n=v.onStoppedNotification;n&&g.setTimeout((function(){return n(e,t)}))}var P={closed:!0,next:D,error:function(e){throw e},complete:D},k="function"==typeof Symbol&&Symbol.observable||"@@observable";function T(e){return e}var L=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof C||function(e){return e&&c(e.next)&&c(e.error)&&c(e.complete)}(r)&&y(r)?e:new S(e,t,n);return F((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=I(t))((function(t,r){var o=new S({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[k]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?T:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=I(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function I(e){var t;return null!==(t=null!=e?e:v.Promise)&&void 0!==t?t:Promise}var R=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function M(e){return c(null==e?void 0:e.then)}function N(e){return c(e[k])}function U(e){return Symbol.asyncIterator&&c(null==e?void 0:e[Symbol.asyncIterator])}function q(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var K="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function H(e){return c(null==e?void 0:e[K])}function G(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},u("next"),u("throw"),u("return"),r[Symbol.asyncIterator]=function(){return this},r;function u(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof s?Promise.resolve(n.value.v).then(c,l):f(i[0][2],n)}catch(e){f(i[0][3],e)}var n}function c(e){a("next",e)}function l(e){a("throw",e)}function f(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}(this,arguments,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,s(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,s(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,s(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function $(e){return c(null==e?void 0:e.getReader)}function V(e){if(e instanceof L)return e;if(null!=e){if(N(e))return o=e,new L((function(e){var t=o[k]();if(c(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(R(e))return r=e,new L((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(M(e))return n=e,new L((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,b)}));if(U(e))return z(e);if(H(e))return t=e,new L((function(e){var n,r;try{for(var o=i(t),u=o.next();!u.done;u=o.next()){var a=u.value;if(e.next(a),e.closed)return}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if($(e))return z(G(e))}var t,n,r,o;throw q(e)}function z(e){return new L((function(t){(function(e,t){var n,r,u,a,s,c,l,f;return s=this,c=void 0,f=function(){var s,c;return o(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=i(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}(e),o.label=1;case 1:return[4,n.next()];case 2:if((r=o.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];o.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=o.sent(),u={error:c},[3,11];case 6:return o.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:o.sent(),o.label=8;case 8:return[3,10];case 9:if(u)throw u.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{o(f.next(e))}catch(e){t(e)}}function r(e){try{o(f.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof l?o:new l((function(e){e(o)}))).then(n,r)}o((f=f.apply(s,c||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function Y(e){return function(t){if(function(e){return c(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function J(e,t,n,r,o){return new W(e,t,n,r,o)}var W=function(e){function t(t,n,r,o,i,u){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=u,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return r(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(C);function X(e,t){return Y((function(n,r){var o=0;n.subscribe(J(r,(function(n){r.next(e.call(t,n,o++))})))}))}function Q(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function Z(e,t,n){return void 0===n&&(n=1/0),c(t)?Z((function(n,r){return X((function(e,o){return t(n,e,r,o)}))(V(e(n,r)))}),n):("number"==typeof t&&(n=t),Y((function(t,r){return function(e,t,n,r,o,i,u,a){var s=[],c=0,l=0,f=!1,h=function(){!f||s.length||c||t.complete()},p=function(e){return c<r?d(e):s.push(e)},d=function(e){c++;var o=!1;V(n(e,l++)).subscribe(J(t,(function(e){t.next(e)}),(function(){o=!0}),void 0,(function(){if(o)try{c--;for(;s.length&&c<r;)e=void 0,e=s.shift(),d(e);h()}catch(e){t.error(e)}var e})))};return e.subscribe(J(t,p,(function(){f=!0,h()}))),function(){}}(t,r,e,n)})))}function ee(e){return e[e.length-1]}function te(e){return(t=ee(e))&&c(t.schedule)?e.pop():void 0;var t}function ne(e,t){return void 0===t&&(t=0),Y((function(n,r){n.subscribe(J(r,(function(n){return Q(r,e,(function(){return r.next(n)}),t)}),(function(){return Q(r,e,(function(){return r.complete()}),t)}),(function(n){return Q(r,e,(function(){return r.error(n)}),t)})))}))}function re(e,t){return void 0===t&&(t=0),Y((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function oe(e,t){if(!e)throw new Error("Iterable cannot be null");return new L((function(n){Q(n,t,(function(){var r=e[Symbol.asyncIterator]();Q(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function ie(e,t){return t?function(e,t){if(null!=e){if(N(e))return function(e,t){return V(e).pipe(re(t),ne(t))}(e,t);if(R(e))return function(e,t){return new L((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(M(e))return function(e,t){return V(e).pipe(re(t),ne(t))}(e,t);if(U(e))return oe(e,t);if(H(e))return function(e,t){return new L((function(n){var r;return Q(n,t,(function(){r=e[K](),Q(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return c(null==r?void 0:r.return)&&r.return()}}))}(e,t);if($(e))return function(e,t){return oe(G(e),t)}(e,t)}throw q(e)}(e,t):V(e)}function ue(e){return void 0===e&&(e=1/0),Z(T,e)}var ae=new L((function(e){return e.complete()}));function se(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=te(e),r=function(e,t){return"number"==typeof ee(e)?e.pop():1/0}(e),o=e;return o.length?1===o.length?V(o[0]):ue(r)(ie(o,n)):ae}function ce(e,t){return Y((function(n,r){var o=0;n.subscribe(J(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}n(6485);var le=function(){return localStorage.getItem("apiKey")},fe=n(1142),he=n.n(fe);function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==pe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===pe(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function me(){me=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==pe(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(pe(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function ve(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function ge(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){ve(i,r,o,u,a,"next",e)}function a(e){ve(i,r,o,u,a,"throw",e)}u(void 0)}))}}function be(e){return De.apply(this,arguments)}function De(){return De=ge(me().mark((function e(t){var n,r,o,i,u,a,s=arguments;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:"text-embedding-ada-002",r=le()){e.next=4;break}throw new Error("API Key not found");case 4:return o={input:t,model:n},e.next=7,fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(o)});case 7:if((i=e.sent).ok){e.next=13;break}return e.next=11,i.text();case 11:throw u=e.sent,new Error("Failed to fetch embedding: ".concat(u));case 13:return e.next=15,i.json();case 15:return a=e.sent,e.abrupt("return",a.data[0].embedding);case 17:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}function we(){return we=ge(me().mark((function e(t,n){var r,o,i,u,a,s,c,l,f,h,p,d,y,m,v,g,b=arguments;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>2&&void 0!==b[2]?b[2]:"gpt-4",o=b.length>3?b[3]:void 0,i=b.length>4&&void 0!==b[4]?b[4]:[],u=b.length>5&&void 0!==b[5]?b[5]:function(){},a=b.length>6&&void 0!==b[6]?b[6]:function(){},s=b.length>7&&void 0!==b[7]?b[7]:function(){},c=b.length>8&&void 0!==b[8]?b[8]:function(){},le()){e.next=10;break}return e.abrupt("return");case 10:return l={messages:t.map((function(e){return"function"===e.role?ye(ye({},e),{},{name:"TODO"}):e})),model:r,max_tokens:o,temperature:n,stream:!0},i.length>0&&(l.functions=i,l.function_call="auto"),e.next=14,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(le()),"Content-Type":"application/json"},body:JSON.stringify(l)});case 14:if((f=e.sent).body){e.next=17;break}return e.abrupt("return");case 17:h=new TextDecoder("utf8"),p=f.body.getReader(),d=null,y="";case 22:return e.next=25,p.read();case 25:if(m=e.sent,v=m.value,g=m.done,void 0,h.decode(v).split("\n\n").map((function(e){return e.trim()})).filter((function(e){return e.startsWith("data: ")})).forEach((function(e){""!==(y=Ee(e,y,d,(function(e){return d=e}),a,s,c))&&u(d?"Function call: ".concat(d,"\n\nArguments: ")+y:y)})),!g){e.next=34;break}return e.abrupt("return");case 34:e.next=22;break;case 36:case"end":return e.stop()}}),e)}))),we.apply(this,arguments)}function Ee(e,t,n,r,o,i,u){if("data: [DONE]"===e.trim())return t;var a=JSON.parse(e.substring(6).trim());if(a.choices[0].delta.function_call&&a.choices[0].delta.function_call.name)return r(a.choices[0].delta.function_call.name),a.choices[0].delta.function_call.arguments||"";if(a.choices[0].delta.function_call&&void 0!==a.choices[0].delta.function_call.arguments)return t+a.choices[0].delta.function_call.arguments;if(void 0!==a.choices[0].delta.content)return t+a.choices[0].delta.content;var s=a.choices[0].finish_reason;return"stop"===s?(i(t),""):"function_call"===s?(o({name:n,parameters:he().parse(t)}),""):"length"===s?(u(t),""):(console.error("Unknown chunk type:",a),t)}var Ae=l((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Fe=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r(t,e),t.prototype.lift=function(e){var t=new Ce(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ae},t.prototype.next=function(e){var t=this;F((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=i(t.currentObservers),u=o.next();!u.done;u=o.next())u.value.next(e)}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;F((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;F((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?d:(this.currentObservers=null,i.push(e),new p((function(){t.currentObservers=null,h(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new L;return e.source=this,e},t.create=function(e,t){return new Ce(e,t)},t}(L),Ce=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:d},t}(Fe),xe=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Fe);function _e(e){return Y((function(t,n){var r,o=null,i=!1;o=t.subscribe(J(n,void 0,void 0,(function(u){r=V(e(u,_e(e)(t))),o?(o.unsubscribe(),o=null,r.subscribe(n)):i=!0}))),i&&(o.unsubscribe(),o=null,r.subscribe(n))}))}function Oe(e,t){return Y(function(e,t,n,r,o){return function(r,o){var i=n,u=t,a=0;r.subscribe(J(o,(function(t){var n=a++;u=i?e(u,t,n):(i=!0,t),o.next(u)}),undefined))}}(e,t,arguments.length>=2))}function Se(e,t){return void 0===t&&(t=T),e=null!=e?e:Be,Y((function(n,r){var o,i=!0;n.subscribe(J(r,(function(n){var u=t(n);!i&&e(o,u)||(i=!1,o=u,r.next(n))})))}))}function Be(e,t){return e===t}function je(e,t){return c(t)?Z(e,t,1):Z(e,1)}function Pe(e){return"user"===e||"assistant"===e}function ke(e){return e.length>0}function Te(e){return"stopReason"in e}function Le(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gpt-4",r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];n=function(e,t){return"gpt-4"===e?"gpt-4-1106-preview":t.length>0&&"gpt-3.5-turbo"===e?"gpt-3.5-turbo-0613":e}(n,o);var i=new Fe,u=new xe(null),a=new xe(null);return function(e,t){return we.apply(this,arguments)}(e,t,n,r,o,(function(e){return i.next(e)}),(function(e){return u.next({functionCall:e})}),(function(e){return a.next({text:e,stopReason:"stop"})}),(function(e){return a.next({text:e,stopReason:"length"})})).then((function(){i.complete(),u.complete(),a.complete()})).catch((function(e){console.error("Error during chat completion:",e),i.error(e),u.complete()})),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ue(1)(ie(e,te(e)))}(i.pipe(X((function(e){return{text:e}}))),u.pipe(ce((function(e){return null!==e}))),a.pipe(ce((function(e){return null!==e}))))}var Ie=l((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Re(e,t){var n="object"==typeof t;return new Promise((function(r,o){var i=new S({next:function(e){r(e),i.unsubscribe()},error:o,complete:function(){n?r(t.defaultValue):o(new Ie)}});e.subscribe(i)}))}function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Ne(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ue(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){a=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function Ue(e,t){if(e){if("string"==typeof e)return qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qe(e,t):void 0}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==Me(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Me(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ge(){Ge=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==Me(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(Me(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function $e(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function Ve(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){$e(i,r,o,u,a,"next",e)}function a(e){$e(i,r,o,u,a,"throw",e)}u(void 0)}))}}var ze=function(){var e=Ve(Ge().mark((function e(t,n){var r,o,i,u,a,s;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.content,o=t.role,i=JSON.stringify({content:r,role:o}),u=n.reduce((function(e,t){return e+t}),i),e.next=5,crypto.subtle.digest("SHA-256",(new TextEncoder).encode(u));case 5:return a=e.sent,s=Array.from(new Uint8Array(a)),e.abrupt("return",s.map((function(e){return e.toString(16).padStart(2,"0")})).join(""));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ye={message:null,metadataRecordsPromise:Promise.resolve({})};function Je(e){return e.replace(/\"\"\"/g,'\\"\\"\\"')}function We(e,t){e=Je(e);var n=Je(t.content);return"Given the following two texts to combine:\n\nNew Message (".concat(t.role,'): """\n').concat(n,'\n"""\n\nPrior Conversation Summary: """\n').concat(e,'\n"""\n\nPlease generate a summary of the overall conversation.')}function Xe(e,t){return Qe.apply(this,arguments)}function Qe(){return(Qe=Ve(Ge().mark((function e(t,n){var r,o,i,u,a,s;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.metadataRecordsPromise;case 2:if(e.t2=o=e.sent.messageSummary,e.t1=null===e.t2,e.t1){e.next=6;break}e.t1=void 0===o;case 6:if(!e.t1){e.next=10;break}e.t3=void 0,e.next=11;break;case 10:e.t3=o.summary;case 11:if(e.t4=r=e.t3,e.t0=null!==e.t4,!e.t0){e.next=15;break}e.t0=void 0!==r;case 15:if(!e.t0){e.next=19;break}e.t5=r,e.next=20;break;case 19:e.t5="";case 20:return i=e.t5,u=We(i,t),a=We("A series of exercise instructions have been recommended including sit ups, push ups, chin ups with further advice offered. Inquiries have been made about exercise activities for the purposes of strength training.",{role:"user",content:"That all seems kind of hard though..."}),s=Le([{role:"system",content:"As an AI, your task is to generate a summary that blends the contents of the prior summary (80%) with the new message (20%) without explicitly indicating which the new content came from. The new output should prioritize the content of the prior summary. Analyze the new message for key themes, but ensure they don't overshadow the content from the prior summary. The goal is a summary that maintains the context and flow, and is representative of the entire discussion up to this point. These summaries will be used for embeddings and message search, so they should be informative and detailed. The objective is a predictable, understandable summary that aids users in contextual search. Only phase out components from the prior summary if they are explicitly contradicted or negated in the new message."},{role:"user",content:a},{role:"assistant",content:"Concern is expressed at the difficulty of the exercises. A series of exercise instructions have been recommended including sit ups, push ups, chin ups."},{role:"user",content:u}],.1,"gpt-4",100),e.abrupt("return",Re(s.pipe(ce(Te),X((function(e){return e.text})))));case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e,t,n){return et.apply(this,arguments)}function et(){return et=Ve(Ge().mark((function e(t,n,r){var o,i,u,a,s,c,l,f,h,p,d,y;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.message?r.message.hash:Bn,e.next=3,ze(n,[o]);case 3:return i=e.sent,u=jn(n)&&n.hash===i?n:He(He({},n),{},{timestamp:void 0,hash:i,parentHash:o}),a=new kn,s={messageEmbedding:function(){var e=Ve(Ge().mark((function e(){var t;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(n.content);case 2:return t=e.sent,e.abrupt("return",{hash:u.hash,embedding:t});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},c={messageSummary:function(){var e=Ve(Ge().mark((function e(){var t;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe(n,r);case 2:return t=e.sent,e.abrupt("return",{hash:u.hash,summary:t});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),summaryEmbedding:function(){var e=Ve(Ge().mark((function e(t){var n;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t.summary);case 2:return n=e.sent,e.abrupt("return",{hash:u.hash,embedding:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},l="paused"===t?s:He(He({},s),c),f=a.saveMessage(u,l),v=2,h=function(e){if(Array.isArray(e))return e}(m=f)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(m,v)||Ue(m,v)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),p=h[0],d=h[1],e.t1=hn,e.t2=a,e.next=14,p;case 14:return e.t3=e.sent,e.next=17,(0,e.t1)(e.t2,e.t3);case 17:if(e.t0=e.sent,e.t0){e.next=22;break}return e.next=21,p;case 21:e.t0=e.sent;case 22:return y=e.t0,e.abrupt("return",{message:y,metadataRecordsPromise:d});case 24:case"end":return e.stop()}var m,v}),e)}))),et.apply(this,arguments)}function tt(e,t){return nt.apply(this,arguments)}function nt(){return(nt=Ve(Ge().mark((function e(t,n){var r,o,i,u,a,s;return Ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze(t,n[0],Ye);case 2:if(r=e.sent,o=[r],ke(i=n.slice(1))){e.next=7;break}return e.abrupt("return",o);case 7:u=Ne(i),e.prev=8,u.s();case 10:if((a=u.n()).done){e.next=18;break}return s=a.value,e.next=14,Ze(t,s,r);case 14:r=e.sent,o.push(r);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",o);case 27:case"end":return e.stop()}}),e,null,[[8,20,23,26]])})))).apply(this,arguments)}function rt(e,t){return e.pipe((n=function(){return t.complete()},Y((function(e,t){try{e.subscribe(t)}finally{t.add(n)}})))).subscribe(t);var n}function ot(e,t){var n=0,r=t;return function(t){return t.pipe(je((function(t){return ie(e(r,t,n++)).pipe(X((function(e){return r=e,e})))})))}}function it(){it=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==pt(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(pt(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==pt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==pt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===pt(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(e,t)||ct(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(e,t){if(e){if("string"==typeof e)return lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(e,t):void 0}}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ft(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function ht(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){ft(i,r,o,u,a,"next",e)}function a(e){ft(i,r,o,u,a,"throw",e)}u(void 0)}))}}function pt(e){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(e)}function dt(e){return"errorMessage"===e.type}function yt(e){var t="An unexpected error occurred";return e instanceof Error?t="Error(".concat(e.name,"): ").concat(e.message).trim():"string"==typeof e?t=e:"number"==typeof e?t="Error code: ".concat(e):"object"===pt(e)&&null!==e&&(t=JSON.stringify(e)),{type:"errorMessage",payload:{content:t,role:"system"}}}function mt(e){return"newMessage"===e.type}function vt(e,t){return gt.apply(this,arguments)}function gt(){return gt=ht(it().mark((function e(t,n){var r,o,i,u,a,s,c=arguments;return it().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:"gpt-4",o=c.length>3&&void 0!==c[3]?c[3]:[],e.next=4,tt(r,n);case 4:if(i=e.sent,ke(u=i.map((function(e){return e.message})))){e.next=8;break}throw new Error("No messages in conversation");case 8:return n=u,a={newMessagesInput:new Fe,outgoingMessageStream:new xe({messages:n,typingStatus:new Map}),functions:o,model:r},s=a.newMessagesInput.pipe(_e((function(e){return console.error("Error caught in aggregatedOutput!",e),ie([yt(e)])})),ot(function(){var e=ht(it().mark((function e(t,n){var o;return it().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!mt(n)&&!dt(n)){e.next=7;break}return e.next=3,Ze(r,n.payload,t.lastResult);case 3:return o=e.sent,e.abrupt("return",{lastResult:o,event:{type:"processedMessage",payload:o.message}});case 7:return e.abrupt("return",at(at({},t),{},{event:n}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),{lastResult:i[i.length-1],event:null}),X((function(e){return e.event})),ce(Boolean),Oe((function(e,t){if("processedMessage"===t.type){var n=[].concat(function(e){if(Array.isArray(e))return lt(e)}(o=e.messages)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||ct(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t.payload]),r=t.payload.role;return Pe(r)&&e.typingStatus.get(r)?at(at({},e),{},{messages:n,typingStatus:new Map(e.typingStatus).set(r,"")}):at(at({},e),{},"function"===r?{messages:n,typingStatus:new Map(e.typingStatus).set("assistant","")}:{messages:n})}var o;if("typingUpdate"===t.type){var i=new Map(e.typingStatus);return i.set(t.payload.role,t.payload.content),at(at({},e),{},{typingStatus:i})}return e}),a.outgoingMessageStream.value)),rt(s,a.outgoingMessageStream),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)}))),gt.apply(this,arguments)}function bt(e){console.log("TEARDOWNCONVO"),e.newMessagesInput.complete()}function Dt(e,t){var n=yt(t);e.newMessagesInput.next(n)}function wt(e,t){e.newMessagesInput.next({type:"newMessage",payload:{content:t,role:"function"}})}function Et(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?0:function(e){return e.outgoingMessageStream.value.messages}(e).length;return e.outgoingMessageStream.pipe(X((function(e){return[e.messages,e.typingStatus]})),Se((function(e,t){var n=st(e,2),r=n[0],o=(n[1],st(t,2)),i=o[0];return o[1],r===i})),Oe((function(e,t){var n=st(e,3),r=(n[0],n[1]),o=(n[2],st(t,2)),i=o[0],u=o[1],a=i.slice(r);return[a,r+a.length,u]}),[[],t,new Map]),je((function(e){var t=st(e,3),n=t[0],r=(t[1],t[2]);return ie(n.map((function(e){return[e,r]})))})))}(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]).pipe(X((function(e){var t=st(e,2),n=t[0];return t[1],n})))}const At={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Ft;const Ct=new Uint8Array(16);function xt(){if(!Ft&&(Ft="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ft))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ft(Ct)}const _t=[];for(let e=0;e<256;++e)_t.push((e+256).toString(16).slice(1));const Ot=function(e,t,n){if(At.randomUUID&&!t&&!e)return At.randomUUID();const r=(e=e||{}).random||(e.rng||xt)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return _t[e[t+0]]+_t[e[t+1]]+_t[e[t+2]]+_t[e[t+3]]+"-"+_t[e[t+4]]+_t[e[t+5]]+"-"+_t[e[t+6]]+_t[e[t+7]]+"-"+_t[e[t+8]]+_t[e[t+9]]+"-"+_t[e[t+10]]+_t[e[t+11]]+_t[e[t+12]]+_t[e[t+13]]+_t[e[t+14]]+_t[e[t+15]]}(r)};function St(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var o=new S({next:function(){o.unsubscribe(),e()}});return V(t.apply(void 0,a([],u(n)))).subscribe(o)}}else e()}function Bt(e){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bt(e)}function jt(){jt=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==Bt(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(Bt(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Tt(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function Lt(){var e;return e=jt().mark((function e(t,n){var r;return jt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map((function(e){return jn(e)?yn(t,e).then((function(t){return{role:e.role,content:t}})):Promise.resolve(e)})),e.abrupt("return",Promise.all(r));case 2:case"end":return e.stop()}}),e)})),Lt=function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){Tt(i,r,o,u,a,"next",e)}function a(e){Tt(i,r,o,u,a,"throw",e)}u(void 0)}))},Lt.apply(this,arguments)}function It(e,t){if("paused"===e.model)return e;var n=e.outgoingMessageStream.pipe(X((function(e){var t;return[e.messages,{role:"assistant",content:null!==(t=e.typingStatus.get("assistant"))&&void 0!==t?t:""}]})),Se((function(e,t){var n=Pt(e,2),r=n[0],o=(n[1],Pt(t,2)),i=o[0];return o[1],r===i}))),r=function(e){return e.pipe(ce((function(e){var t=Pt(e,2),n=t[0];return t[1],n.length>0&&"system"===n[n.length-1].role})))}(n),o=function(e){return e.pipe(ce((function(e){var t=Pt(e,2),n=t[0],r=t[1];return n.length>0&&"user"===n[n.length-1].role&&0===r.content.length})))}(n),i=function(e,t,n,r){return t.pipe((5,5e3,function(e){var t=[];return new L((function(n){return e.subscribe({next:function(e){var r=Date.now();(t=t.filter((function(e){return r-e<5e3}))).length>=5?n.error(new Error("Rate limit exceeded. Maximum allowed is ".concat(5," calls within ").concat(5e3," milliseconds."))):(t.push(r),n.next(e))},error:function(e){n.error(e)},complete:function(){n.complete()}})}))}),(o=function(t){var o=function(e,t){return Lt.apply(this,arguments)}(e,t);return ie(o).pipe(je((function(e){return Le(e,.1,n,1e3,r)})))},Y((function(e,t){var n=null,r=!1,i=function(){return r&&!n&&t.complete()};e.subscribe(J(t,(function(e){null==n||n.unsubscribe();0;V(o(e)).subscribe(n=J(t,(function(e){return t.next(e)}),(function(){n=null,i()})))}),(function(){r=!0,i()})))}))),function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Fe}:t,r=e.resetOnError,o=void 0===r||r,i=e.resetOnComplete,u=void 0===i||i,a=e.resetOnRefCountZero,s=void 0===a||a;return function(e){var t,r,i,a=0,c=!1,l=!1,f=function(){null==r||r.unsubscribe(),r=void 0},h=function(){f(),t=i=void 0,c=l=!1},p=function(){var e=t;h(),null==e||e.unsubscribe()};return Y((function(e,d){a++,l||c||f();var y=i=null!=i?i:n();d.add((function(){0!=--a||l||c||(r=St(p,s))})),y.subscribe(d),!t&&a>0&&(t=new S({next:function(e){return y.next(e)},error:function(e){l=!0,f(),r=St(h,o,e),y.error(e)},complete:function(){c=!0,f(),r=St(h,u),y.complete()}}),V(e).subscribe(t))}))(e)}}({connector:function(){return new Fe},resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1}));var o}(t,se(o,r).pipe(X((function(e){var t=Pt(e,2),n=t[0];return t[1],n}))),e.model,e.functions).pipe(_e((function(t){return console.error("Error from before handleGptMessages!",t),Dt(e,t),ae})));return function(e,t,n){t.pipe(je((function(t){try{return function(e){return"text"in e&&!("stopReason"in e)}(t)?(function(e,t,n){e.newMessagesInput.next({type:"typingUpdate",payload:{role:"assistant",content:n}})}(e,0,t.text),ae):Te(t)?(function(e,t,n){n&&e.newMessagesInput.next({type:"newMessage",payload:{content:n,role:"assistant"}})}(e,0,"length"===t.stopReason?t.text+"[terminated due to length]":t.text),ae):function(e){return"functionCall"in e}(t)?ie(function(e,t,n){return an.apply(this,arguments)}(e,t.functionCall,n)):(console.warn("Unknown message type",t),ae)}catch(e){return console.error("Error during handleGptMessages",e),o=c(r=function(){return e})?r:function(){return r},new L((function(e){return e.error(o())}))}var r,o})),_e((function(t){return console.error("Error from handleGptMessages catchError!",t),Dt(e,t),ae}))).subscribe()}(e,i,t),e}function Rt(e){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rt(e)}function Mt(){Mt=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==Rt(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(Rt(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Nt(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function Ut(e,t){return qt.apply(this,arguments)}function qt(){return e=Mt().mark((function e(t,n){var r,o,i,u=arguments;return Mt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:"gpt-4",o=u.length>3&&void 0!==u[3]?u[3]:[],e.next=4,vt(t,n,r,o);case 4:return i=e.sent,e.abrupt("return",It(i,t));case 6:case"end":return e.stop()}}),e)})),qt=function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){Nt(i,r,o,u,a,"next",e)}function a(e){Nt(i,r,o,u,a,"throw",e)}u(void 0)}))},qt.apply(this,arguments);var e}function Kt(e){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(e)}function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==Kt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Kt(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $t(e){return function(e){if(Array.isArray(e))return zt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Vt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vt(e,t){if(e){if("string"==typeof e)return zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zt(e,t):void 0}}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yt(){Yt=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==Kt(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(Kt(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Jt(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function Wt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){Jt(i,r,o,u,a,"next",e)}function a(e){Jt(i,r,o,u,a,"throw",e)}u(void 0)}))}}function Xt(e){return"function"===e.role}function Qt(e){return Xt(e)&&"isComplete"in e&&"results"in e}function Zt(e,t,n){return{name:t,description:n,implementation:function(t,n,r,o){var i=t.db,u=function(){var t=Wt(Yt().mark((function t(){var u,a,s;return Yt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,be(n);case 2:return u=t.sent,t.next=5,i.searchEmbedding(u,r,e,o);case 5:if(0!==(a=t.sent).length){t.next=10;break}return t.abrupt("return",["No results found."]);case 10:return t.next=12,Promise.all(a.map((function(e){return i.getMessageByHash(e)})));case 12:return s=t.sent.filter((function(e){return Boolean(e)})),t.abrupt("return",s.map((function(e){return"".concat(e.hash,": ").concat((60,(t=e.content.replace(/\n/g,"")).length>60?t.substring(0,57)+"...":t));var t})));case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return ie(u()).pipe(je((function(e){return ie(e)})))},parameters:[{name:"query",type:"string",description:"The query to convert into an embedding for the search.",required:!0},{name:"limit",type:"number",description:"The maximum number of message results to return.",required:!0},{name:"descendedFromSHA",type:"string",description:"Optional - when provided, only searches messages descended from the message with the provided SHA. Do not include quotes.",required:!1}]}}n(7294),n(1039);var en,tn,nn=[Zt("embeddings","direct_message_embedding_search","Compares the embedding of the search `query` with the embeddings of the contents of messages using cosine similarity. Returns 'limit' number of closest matching messages."),Zt("summaryEmbeddings","summary_message_embedding_search","Compares the embedding of the search `query` with the embeddings of the summaries of conversations terminating with potential message results using cosine similarity. Returns 'limit' number of closest matching messages."),{name:"append_user_reply",description:"Appends the provided message content as a user reply to the message specified by the SHA.",implementation:function(e,t,n,r){return new L((function(o){Wt(Yt().mark((function i(){var u,a,s,c,l,f,h,p,d,y,m;return Yt().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n||(n="user"),"user"===n||"system"===n||"assistant"===n){i.next=3;break}throw new Error('Invalid role "'.concat(n,'". Must be either "user" or "system" or "assistant".'));case 3:if(u=n,a=[],!r){i.next=14;break}return i.next=8,e.db.getMessageByHash(r);case 8:if(s=i.sent){i.next=11;break}throw new Error("Message with SHA ".concat(r," not found."));case 11:return i.next=13,e.db.getConversationFromLeafMessage(s);case 13:a=i.sent;case 14:if(c={role:u,content:t},ke(l=[].concat($t(a),[c]))){i.next=18;break}throw new Error("Unexpected codepoint reached.");case 18:return i.next=20,tt("gpt-4",l);case 20:return f=i.sent,h=f[f.length-1].message,o.next("Appended SHA: ".concat(h.hash)),i.next=25,e.db.getConversationFromLeafMessage(h);case 25:if(p=i.sent,"assistant"===u){i.next=36;break}return i.next=29,Ut(e.db,p,"gpt-4",[]);case 29:return d=i.sent,y=Et(d).pipe(ce((function(e){return"assistant"===e.role}))),i.next=33,Re(y);case 33:m=i.sent,bt(d),o.next("\nReply SHA: ".concat(m.hash,"\n\nContent: ").concat(m.content,"\n            ").trim());case 36:o.complete();case 37:case"end":return i.stop()}}),i)})))().catch((function(e){return o.error(e)}))}))},parameters:[{name:"content",type:"string",description:"The content of the new message.",required:!0},{name:"role",type:"string",description:"Must be one of either 'user' or 'system'. (defaults to 'user')",required:!1},{name:"sha",type:"string",description:"The SHA of the message to append a user reply to. (defaults to starting a new conversation from the root rather than replying to an existing message)",required:!1}]},{name:"generate_dynamic_function",description:"TODO",implementation:(tn=Wt(Yt().mark((function e(t,n,r){var o,i,u,a;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.functionMessagePromise;case 2:if(cn((o=e.sent).content)){e.next=6;break}throw new Error("Invalid function message content");case 6:if(i=t.functionOptions,u=i.map((function(e){return e.name})),!((a=r.filter((function(e){return!u.includes(e)}))).length>0)){e.next=11;break}throw new Error("Missing dependencies: ".concat(a.join(", ")));case 11:return e.next=13,Promise.all(r.map(function(){var e=Wt(Yt().mark((function e(n){var r;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.find((function(e){return e.name===n}))){e.next=3;break}throw new Error('Function option "'.concat(n,'" not found in function options.'));case 3:return e.next=5,t.db.saveFunctionDependency(o,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:return e.abrupt("return","Dynamic function persisted:\n\n"+JSON.stringify({hash:o.hash,functionBody:n,dependencies:r}));case 14:case"end":return e.stop()}}),e)}))),function(e,t,n){return tn.apply(this,arguments)}),parameters:[{name:"functionBody",type:"string",description:"The body of the async function to generate without the enclosing async function definition.",required:!0},{name:"dependencies",type:"array",items:{type:"string"},description:"A list of the names of the functions to which the generated function should have access.",required:!0}]},{name:"invoke_dynamic_function",description:"TODO",implementation:function(e,t,n){return new L((function(r){var o=new Worker(window.workerPath);o.addEventListener("message",(function(e){var t=e.data;if("complete"===t.status)return r.complete(),void o.terminate();console.log("Received from worker:",t),r.next(String(t.content))})),o.addEventListener("error",(function(e){r.error(e.error||e.message),o.terminate()}));var i={functionHash:t,input:n,functionOptions:e.functionOptions};o.postMessage(i)}))},parameters:[{name:"functionHash",type:"string",description:"The SHA of the function to invoke.",required:!0},{name:"input",type:"string",description:"The input to provide to the function.",required:!0}]},{name:"alert",description:"Displays a browser alert with the provided message.",implementation:(en=Wt(Yt().mark((function e(t,n){return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert(n),e.abrupt("return","sent alert!");case 2:case"end":return e.stop()}}),e)}))),function(e,t){return en.apply(this,arguments)}),parameters:[{name:"message",type:"string",description:"The message to display in the alert.",required:!0}]},{name:"prompt",description:"Opens a prompt dialog asking the user to input some text.",implementation:function(e,t,n){return prompt(t,n)||""},parameters:[{name:"message",type:"string",description:"The message to display in the prompt.",required:!0},{name:"defaultValue",type:"string",description:"The default value to prefill in the prompt input.",required:!1}]},{name:"error",description:"Throws an error with the provided message.",implementation:function(e,t){throw new Error(t)},parameters:[{name:"message",type:"string",description:"The message to display in the error.",required:!0}]}];function rn(e,t){return e.functions.some((function(e){return e.name===t.name}))}function on(e,t){return un.apply(this,arguments)}function un(){return(un=Wt(Yt().mark((function e(t,n){var r;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Et(t,!1),e.abrupt("return",Re(r.pipe(ce(Xt),ce((function(e){var t;return(null===(t=cn(e.content))||void 0===t?void 0:t.uuid)===n.uuid})))));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function an(){return an=Wt(Yt().mark((function e(t,n,r){var o,i,u,a,s,l,f,h;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(rn(t,n)){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,o=sn(n),i=Ot(),d=u=Gt(Gt({},n),{},{uuid:i,v:1}),a=JSON.stringify(d),wt(t,a),s=on(t,u),l=o({db:r,functionMessagePromise:s,functionOptions:t.functions}),f=function(){var e=Wt(Yt().mark((function e(t,o){return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=2;break}return e.abrupt("return",r.saveFunctionResult({uuid:i,functionName:n.name,completed:!0}));case 2:return e.abrupt("return",r.saveFunctionResult({uuid:i,functionName:n.name,result:t,completed:!1}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),!(p=l)||!(p instanceof L||c(p.lift)&&c(p.subscribe))){e.next=14;break}return l.subscribe({next:function(){var e=Wt(Yt().mark((function e(t){return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,!1);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),complete:function(){var e=Wt(Yt().mark((function e(){return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("",!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 14:return e.next=16,l;case 16:if(null===(h=e.sent)){e.next=20;break}return e.next=20,f(h,!1);case 20:return e.next=22,f("",!0);case 22:e.next=28;break;case 24:throw e.prev=24,e.t0=e.catch(2),console.error("caught error in callFunction",e.t0),e.t0;case 28:case"end":return e.stop()}var p,d}),e,null,[[2,24]])}))),an.apply(this,arguments)}function sn(e){var t=nn.find((function(t){return t.name===e.name}));if(!t)throw new Error('Function "'.concat(e.name,'" not found in specs.'));var n=t.parameters.map((function(t){if(t.name in e.parameters){var n,r=e.parameters[t.name];if("number"===t.type)return Number(r);if("boolean"===t.type)return Boolean(r);if("string"===t.type)return String(r);if("array"===t.type&&"string"===(null===(n=t.items)||void 0===n?void 0:n.type))return r.map(String);throw new Error('Unsupported parameter type "'.concat(t.type,'" for parameter "').concat(t.name,'". It had value of ').concat(r))}if(t.required)throw new Error('Required parameter "'.concat(t.name,'" missing in function call.'))}));return function(e){return t.implementation.apply(t,[e].concat($t(n)))}}function cn(e){try{var t=JSON.parse(e);return t.uuid&&1===t.v?t:null}catch(e){return null}}function ln(e,t){return fn.apply(this,arguments)}function fn(){return fn=Wt(Yt().mark((function e(t,n){var r;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"===n.role){e.next=2;break}return e.abrupt("return",null);case 2:if(r=cn(n.content)){e.next=6;break}return console.error("Invalid function message content",n.content),e.abrupt("return",null);case 6:return e.abrupt("return",t.getFunctionResultsByUUID(r.uuid));case 7:case"end":return e.stop()}}),e)}))),fn.apply(this,arguments)}function hn(e,t){return pn.apply(this,arguments)}function pn(){return pn=Wt(Yt().mark((function e(t,n){var r,o;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ln(t,n);case 2:if(null!==(r=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return o=Gt(Gt({},n),{},{role:"function",isComplete:-1!==r.findIndex((function(e){return e.completed})),results:r}),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),pn.apply(this,arguments)}function dn(e){var t,n,r=Math.max.apply(Math,$t(null!==(t=null===(n=e.match(/`+/g))||void 0===n?void 0:n.map((function(e){return e.length})))&&void 0!==t?t:[0]));if(/\r?\n/.test(e)){var o="`".repeat(Math.max(3,r+1));return"\n".concat(o,"\n").concat(e,"\n").concat(o)}var i="`".repeat(r+1);return"".concat(i).concat(e).concat(i)}function yn(e,t){return mn.apply(this,arguments)}function mn(){return mn=Wt(Yt().mark((function e(t,n){var r,o,i,u;return Yt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Qt(n)){e.next=2;break}return e.abrupt("return",n.content);case 2:if(r=cn(n.content)){e.next=5;break}return e.abrupt("return",n.content);case 5:return e.next=7,t.getFunctionResultsByUUID(r.uuid);case 7:return o=e.sent,i=-1!==o.findIndex((function(e){return e.completed})),u=o.filter((function(e){return!e.completed})),e.abrupt("return","\n**function**: ".concat(dn(r.name),"\n\n").concat(Object.entries(r.parameters).map((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(t,n)||Vt(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];return"**".concat(o,"**: ").concat(dn("string"==typeof i?i:JSON.stringify(i)))})).join("\n"),"\n\n").concat(u.map((function(e){var t,n=dn(null!==(t=e.result)&&void 0!==t?t:"");return"Result: ".concat(n)})).join("\n"),"\n").concat(i?"Function call complete.":"Function call incomplete...","\n  ").trim());case 11:case"end":return e.stop()}}),e)}))),mn.apply(this,arguments)}function vn(e){return vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(e)}function gn(e){return function(e){if(Array.isArray(e))return An(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||En(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(){bn=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==vn(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(vn(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Dn(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function wn(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){Dn(i,r,o,u,a,"next",e)}function a(e){Dn(i,r,o,u,a,"throw",e)}u(void 0)}))}}function En(e,t){if(e){if("string"==typeof e)return An(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?An(e,t):void 0}}function An(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fn(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=_n(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_n(r.key),r)}}function _n(e){var t=function(e,t){if("object"!==vn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==vn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===vn(t)?t:String(t)}function On(e,t){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},On(e,t)}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sn(e)}var Bn="root";function jn(e){return void 0!==e.timestamp}function Pn(e){return e.parentHash&&e.parentHash!==Bn}var kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&On(e,t)}(E,e);var t,n,r,o,i,u,a,s,c,l,f,h,p,d,y,m,v,g,b,D,w=(b=E,D=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Sn(b);if(D){var n=Sn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===vn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function E(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,E),(e=w.call(this,"ConversationDatabase")).version(16).stores({messages:"&hash,timestamp,parentHash,role,content",embeddings:"&hash,timestamp,embedding",summaries:"&hash,timestamp,summary",summaryEmbeddings:"&hash,timestamp,embedding",pins:"&hash,timestamp,version,remoteTimestamp",functionResults:"++id,*uuid,timestamp,functionName,result,completed",functionDependencies:"&hash,timestamp,dependencyName"}),e.messages=e.table("messages"),e.embeddings=e.table("embeddings"),e.summaries=e.table("summaries"),e.summaryEmbeddings=e.table("summaryEmbeddings"),e.pins=e.table("pins"),e.functionResults=e.table("functionResults"),e.functionDependencies=e.table("functionDependencies"),e}return t=E,n=[{key:"saveMessage",value:function(e,t){var n,r=this;n=jn(e)?Promise.resolve(e):this.transaction("rw",this.messages,(function(){return r.getMessageByHash(e.hash).then((function(t){if(t&&(Pn(t)||Pn(e))&&t.parentHash!==e.parentHash)throw new Error("Message with hash: ".concat(e.hash," exists but with a different parent hash."));if(t)return t;if(Pn(e))return r.getMessageByHash(e.parentHash).then((function(t){if(!t)throw new Error("Parent hash: ".concat(e.parentHash," does not exist in the database."));var n=Cn(Cn({},e),{},{timestamp:Date.now()});return r.messages.add(n).then((function(){return n}))}));var n=Cn(Cn({},e),{},{timestamp:Date.now()});return r.messages.add(n).then((function(){return n}))}))}));var o=t.messageSummary?this.getSummaryByHash(e.hash).then((function(e){return e||(t.messageSummary?t.messageSummary().then((function(e){return r.saveSummary(e)})):Promise.resolve(void 0))})):Promise.resolve(void 0),i=t.summaryEmbedding?o.then((function(n){if(!n)throw new Error("MessageSummary must be specified when SummaryEmbedding is specified.");return r.getSummaryEmbeddingByHash(e.hash).then((function(e){return e||(t.summaryEmbedding?t.summaryEmbedding(n).then((function(e){return r.saveSummaryEmbedding(e)})):Promise.resolve(void 0))}))})):Promise.resolve(void 0),u=t.messageEmbedding?this.getEmbeddingByHash(e.hash).then((function(e){return e||(t.messageEmbedding?t.messageEmbedding().then((function(e){return r.saveMetadata(e)})):Promise.resolve(void 0))})):Promise.resolve(void 0);return[n,Promise.all([o,i,u]).then((function(e){var n,r,o=(r=3,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,a=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(n,r)||En(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],u=o[1],a={messageEmbedding:o[2],messageSummary:i,summaryEmbedding:u};return function(e,t){for(var n in e)if(!(n in t))throw new Error("Key ".concat(n," is missing in metadata records."))}(t,a),a}))]}},{key:"getSummaryByHash",value:(g=wn(bn().mark((function e(t){return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.summaries.get(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"saveSummary",value:(v=wn(bn().mark((function e(t){var n=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.messages,this.summaries],wn(bn().mark((function e(){var r,o;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSummaryByHash(t.hash);case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,n.getMessageByHash(t.hash);case 7:if(e.sent){e.next=9;break}throw new Error("Hash: ".concat(t.hash," does not exist in the database."));case 9:return o=Cn(Cn({},t),{},{timestamp:Date.now()}),e.next=12,n.summaries.add(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"saveSummaryEmbedding",value:(m=wn(bn().mark((function e(t){var n=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.messages,this.summaryEmbeddings],wn(bn().mark((function e(){var r,o;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSummaryEmbeddingByHash(t.hash);case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,n.getMessageByHash(t.hash);case 7:if(e.sent){e.next=9;break}throw new Error("Hash: ".concat(t.hash," does not exist in the database."));case 9:return o=Cn(Cn({},t),{},{timestamp:Date.now()}),e.next=12,n.summaryEmbeddings.add(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"saveMetadata",value:(y=wn(bn().mark((function e(t){var n=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.messages,this.embeddings],wn(bn().mark((function e(){var r,o;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getEmbeddingByHash(t.hash);case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,n.getMessageByHash(t.hash);case 7:if(e.sent){e.next=9;break}throw new Error("Hash: ".concat(t.hash," does not exist in the database."));case 9:return o=Cn(Cn({},t),{},{timestamp:Date.now()}),e.next=12,n.embeddings.add(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getMessageByHash",value:function(e){return this.messages.get(e)}},{key:"getEmbeddingByHash",value:function(e){return this.embeddings.get(e)}},{key:"getSummaryEmbeddingByHash",value:function(e){return this.summaryEmbeddings.get(e)}},{key:"getConversationFromLeaf",value:(d=wn(bn().mark((function e(t){var n,r,o;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=t;case 2:if(!r){e.next=12;break}return e.next=5,this.getMessageByHash(r);case 5:if(o=e.sent){e.next=8;break}return e.abrupt("break",12);case 8:n.push(o),r=Pn(o)?o.parentHash:null,e.next=2;break;case 12:return e.abrupt("return",n.reverse());case 13:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getConversationFromLeafMessage",value:(p=wn(bn().mark((function e(t){var n,r;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[t],Pn(t)){e.next=3;break}return e.abrupt("return",n);case 3:return e.next=5,this.getMessageByHash(t.parentHash);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",n);case 8:return e.t0=[],e.t1=gn,e.next=12,this.getConversationFromLeafMessage(r);case 12:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=n,e.abrupt("return",e.t0.concat.call(e.t0,e.t3,e.t4));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getMessagesFrom",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};return(t=function(){return n.getDirectChildren(e)},new L((function(e){V(t()).subscribe(e)}))).pipe(Z((function(t){var i=t.map((function(e){return n.getMessagesFrom(e,r+1,o)}));return e&&o(e,t)&&i.unshift(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ie(e,te(e))}({message:e,pathLength:r})),se.apply(void 0,gn(i))})))}},{key:"getLeafMessagesFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getMessagesFrom(e,t,(function(e,t){return 0===t.length}))}},{key:"getDirectChildren",value:function(e){return this.messages.where("parentHash").equals(e?e.hash:Bn).reverse().sortBy("timestamp")}},{key:"searchEmbedding",value:(h=wn(bn().mark((function e(t,n,r,o){var i,u,a,s,c,l,f=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null,!o){e.next=21;break}return e.next=4,this.getMessageByHash(o);case 4:if(e.t1=u=e.sent,e.t0=null!==e.t1,!e.t0){e.next=8;break}e.t0=void 0!==u;case 8:if(!e.t0){e.next=12;break}e.t2=u,e.next=13;break;case 12:e.t2=null;case 13:if(i=e.t2){e.next=21;break}return e.next=17,this.messages.toArray();case 17:return a=e.sent,s=a.find((function(e){return e.hash===o})),console.error("searchembedding message not found!",JSON.stringify(o),i,s,a),e.abrupt("return",[]);case 21:return c=this.getMessagesFrom(i).pipe(Z((function(e){return("embeddings"===r?f.getEmbeddingByHash(e.message.hash):f.getSummaryEmbeddingByHash(e.message.hash)).then((function(t){return t?{embedding:t,leafPath:e}:null}))})),ce(Boolean)),l=[],e.abrupt("return",new Promise((function(e){c.subscribe((function(e){l.push({hash:e.leafPath.message.hash,distance:f.cosineSimilarity(t,e.embedding.embedding)}),l=l.sort((function(e,t){return t.distance-e.distance})).slice(0,n)}),null,(function(){var t=l.map((function(e){return e.hash}));e(t)}))})));case 24:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"cosineSimilarity",value:function(e,t){if(e.length!==t.length)throw new Error("Embeddings have different dimensions");var n=Math.sqrt(e.reduce((function(e,t){return e+Math.pow(t,2)}),0)),r=Math.sqrt(t.reduce((function(e,t){return e+Math.pow(t,2)}),0));return e.reduce((function(e,n,r){return e+n*t[r]}),0)/(n*r)}},{key:"getLeafMessageFromAncestor",value:(f=wn(bn().mark((function e(t){var n;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.messages.where("parentHash").equals(t.hash).sortBy("timestamp");case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",this.getLeafMessageFromAncestor(n[0]));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"addPin",value:(l=wn(bn().mark((function e(t,n){var r=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.transaction("rw",this.pins,wn(bn().mark((function e(){var o;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.hasPin(t);case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:return o={hash:t.hash,timestamp:Date.now(),version:1,remoteTimestamp:n},e.next=7,r.pins.add(o);case 7:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"removePin",value:(c=wn(bn().mark((function e(t){var n=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.transaction("rw",this.pins,wn(bn().mark((function e(){return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.pins.where("hash").equals(t.hash).delete();case 2:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"hasPin",value:(s=wn(bn().mark((function e(t){var n;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pins.get(t.hash);case 2:return n=e.sent,e.abrupt("return",!!n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getPinnedMessages",value:(a=wn(bn().mark((function e(){var t,n,r=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pins.toArray();case 2:return t=e.sent,e.next=5,Promise.all(t.map((function(e){return r.getMessageByHash(e.hash)})));case 5:return n=e.sent,e.abrupt("return",n.filter((function(e){return!!e})).sort((function(e,t){return e.timestamp-t.timestamp})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"saveFunctionResult",value:(u=wn(bn().mark((function e(t){var n,r;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Cn(Cn({},t),{},{timestamp:Date.now()}),e.next=3,this.functionResults.add(n);case 3:return r=e.sent,e.abrupt("return",Cn(Cn({},n),{},{id:r}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getFunctionResultsByUUID",value:(i=wn(bn().mark((function e(t){var n;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.functionResults.where("uuid").equals(t).sortBy("id");case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"saveFunctionDependency",value:(o=wn(bn().mark((function e(t,n){var r=this;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.functionResults,this.functionDependencies],wn(bn().mark((function e(){var o,i;return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={hash:t.hash,timestamp:Date.now(),dependencyName:n.name},e.next=3,ln(r,t);case 3:if(i=e.sent){e.next=6;break}throw new Error("Cannot add dependency to a non-function message.");case 6:if(!i.some((function(e){return e.completed}))){e.next=8;break}throw new Error("Cannot add dependency to completed function result.");case 8:return e.next=10,r.functionDependencies.add(o);case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getFunctionDependenciesByHash",value:(r=wn(bn().mark((function e(t){return bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.functionDependencies.where("hash").equals(t).toArray());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],n&&xn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),E}(e.default);function Tn(e){return Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tn(e)}function Ln(){Ln=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),a=new B(r||[]);return o(u,"_invoke",{value:x(e,n,a)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function b(){}var D={};c(D,u,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(j([])));E&&E!==n&&r.call(E,u)&&(D=E);var A=b.prototype=v.prototype=Object.create(D);function F(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,i,u,a){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==Tn(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,a)}),(function(e){n("throw",e,u,a)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,a)}))}a(s.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function x(t,n,r){var o=h;return function(i,u){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(Tn(t)+" is not iterable")}return g.prototype=b,o(A,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},F(C.prototype),c(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new C(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},F(A),c(A,s,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var s=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(s&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(s){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function In(e,t,n,r,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}var Rn=new kn;self.addEventListener("message",function(){var e,t=(e=Ln().mark((function e(t){var n,r,o,i,u;return Ln().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,r=n.functionHash,n.input,n.functionOptions,e.next=4,Rn.getMessageByHash(r);case 4:if(o=e.sent){e.next=7;break}throw new Error('Function message with hash "'.concat(r,'" not found.'));case 7:if(Xt(o)){e.next=9;break}throw new Error('Message with hash "'.concat(r,'" is not a function message.'));case 9:if(cn(o.content)){e.next=12;break}throw new Error("Invalid function message content");case 12:return e.next=14,Rn.getFunctionDependenciesByHash(o.hash);case 14:e.sent,i={status:"incomplete",content:"test!"},self.postMessage(i),u={status:"complete"},self.postMessage(u);case 19:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){In(i,r,o,u,a,"next",e)}function a(e){In(i,r,o,u,a,"throw",e)}u(void 0)}))});return function(e){return t.apply(this,arguments)}}())})()})();