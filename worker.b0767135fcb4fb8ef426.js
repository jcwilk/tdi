/*! For license information please see worker.b0767135fcb4fb8ef426.js.LICENSE.txt */
(()=>{var __webpack_modules__={93324:(e,t,n)=>{"use strict";function r(){return localStorage.getItem("apiKey")}function o(){return!!r()}n.d(t,{O4:()=>r,jm:()=>o})},69365:(e,t,n)=>{"use strict";n.d(t,{V:()=>B});var r=n(65583),o=n(9248),i=n(80230),u=n(29127),s=n(53741),a=n(23071),c=n(79878),l=n(1545),f=n(94975),h=n(34978),d=n(40052),p=n(51313),m=n(83610),y=n(21276),v=n(44459),b=n(72886),g=n(40557),w=n(23229),D=n(4671);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function _(){_=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",m="completed",y={};function v(){}function b(){}function g(){}var w={};c(w,u,(function(){return this}));var D=Object.getPrototypeOf,x=D&&D(D(j([])));x&&x!==n&&r.call(x,u)&&(w=x);var A=g.prototype=v.prototype=Object.create(w);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,i,u,s){var a=f(e[o],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==E(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,s)}))}s(a.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=h;return function(i,u){if(o===p)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===y)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=p;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?m:d,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(E(t)+" is not iterable")}return b.prototype=g,o(A,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},C(F.prototype),c(F.prototype,s,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(A),c(A,a,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===E(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,s=[],a=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){S(i,r,o,u,s,"next",e)}function s(e){S(i,r,o,u,s,"throw",e)}u(void 0)}))}}function k(){return k=O(_().mark((function e(t,n){var r;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.map(function(){var e=O(_().mark((function e(n){var r,o,i,u,s,a,c;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,D._y)(n)){e.next=2;break}return e.abrupt("return",{role:n.role,content:n.content});case 2:return e.next=4,t.getFunctionResultsByUUID(n.functionCall.uuid);case 4:if(r=e.sent,o=r.filter(D.vz),i={results:o.map((function(e){return e.result})),state:r.length===o.length?"completed":"incomplete"},!(0,g.nt)(n.functionCall)){e.next=12;break}return u=[{id:n.functionCall.id,type:"function",function:{name:n.functionCall.name,arguments:JSON.stringify(n.functionCall.parameters)}}],s={role:"assistant",tool_calls:u},a={role:"tool",content:JSON.stringify(i),tool_call_id:n.functionCall.id},e.abrupt("return",[s,a]);case 12:return c={role:"function",content:JSON.stringify(A(A({},i),{},{arguments:n.functionCall.parameters})),name:n.functionCall.name},e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(r);case 3:return e.abrupt("return",e.sent.flat());case 4:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function B(e,t){if("paused"===e.model)return e;var n=e.outgoingMessageStream.pipe((0,u.U)((function(e){var t;return[e.messages,{role:"assistant",content:null!==(t=e.typingStatus.get("assistant"))&&void 0!==t?t:""}]})),(0,s.x)((function(e,t){var n=C(e,2),r=n[0],o=(n[1],C(t,2)),i=o[0];return o[1],r.length===i.length}))),g=function(e){return e.pipe((0,f.h)((function(e){var t=C(e,2),n=t[0];return t[1],"system"===n[n.length-1].role})))}(n),D=function(e){return e.pipe((0,f.h)((function(e){var t=C(e,2),n=t[0],r=t[1];return"user"===n[n.length-1].role&&0===r.content.length})))}(n),E=function(e,t,n,u){return t.pipe((5,5e3,function(e){var t=[];return new i.y((function(n){return e.subscribe({next:function(e){var r=Date.now();(t=t.filter((function(e){return r-e<5e3}))).length>=5?n.error(new Error("Rate limit exceeded. Maximum allowed is ".concat(5," calls within ").concat(5e3," milliseconds."))):(t.push(r),n.next(e))},error:function(e){n.error(e)},complete:function(){n.complete()}})}))}),(0,h.w)((function(t){var r=function(e,t){return k.apply(this,arguments)}(e,t);return(0,d.D)(r).pipe((0,p.b)((function(e){return(0,b.Ds)(e,.1,n,1e3,u)})))})),(0,r.B)({connector:function(){return new o.x},resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1}))}(t,(0,a.T)(D,g).pipe((0,u.U)((function(e){var t=C(e,2),n=t[0];return t[1],n}))),e.model,e.functions).pipe((0,c.K)((function(t){return console.error("Error from before handleGptMessages!",t),(0,y.y7)(e,t),l.E})));return function(e,t,n){t.pipe((0,p.b)((function(t){try{return(0,b.YX)(t)?((0,v.un)(e,"assistant",t.text),l.E):(0,b.fY)(t)?((0,v.bG)(e,"assistant","length"===t.stopReason?t.text+"[terminated due to length]":t.text),l.E):(0,b.yS)(t)?(0,w.EO)(e,t.functionCall)?(0,d.D)((0,w.N3)(e,t.functionCall,n)):l.E:(console.warn("Unknown message type",t),l.E)}catch(e){return console.error("Error during handleGptMessages",e),(0,m._)((function(){return e}))}})),(0,c.K)((function(t){return console.error("Error from handleGptMessages catchError!",t),(0,y.y7)(e,t),l.E}))).subscribe()}(e,E,t),e}},72886:(e,t,n)=>{"use strict";n.d(t,{Ds:()=>d,YX:()=>f,fY:()=>h,yS:()=>l});var r=n(9248),o=n(86515),i=n(26362),u=n(29127),s=n(94975),a=n(40557),c=n(64211);function l(e){return"functionCall"in e}function f(e){return"text"in e&&!("stopReason"in e)}function h(e){return"stopReason"in e}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gpt-4",l=arguments.length>3?arguments[3]:void 0,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];n=function(e,t){return"gpt-4"===e?"gpt-4-1106-preview":t.length>0&&"gpt-3.5-turbo"===e?"gpt-3.5-turbo-0613":e}(n,f);var h=new r.x,d=new o.X(null),p=new o.X(null);return(0,a.Gj)(e,t,n,l,f,(function(e){return h.next(e)}),(function(e){return d.next({functionCall:e})}),(function(e){return p.next({text:e,stopReason:"stop"})}),(function(e){return p.next({text:e,stopReason:"length"})})).then((function(){h.complete(),d.complete(),p.complete()})).catch((function(e){console.error("Error during chat completion:",e),h.error(e),d.complete()})),(0,i.z)(h.pipe((0,u.U)((function(e){return{text:e}}))),d.pipe((0,s.h)(c.fQ)),p.pipe((0,s.h)(c.fQ)))}},21276:(e,t,n)=>{"use strict";n.d(t,{Mx:()=>B,Xw:()=>O,cm:()=>j,kg:()=>T,qu:()=>I,y7:()=>P});var r=n(9248),o=n(86515),i=n(79878),u=n(40052),s=n(29127),a=n(94975),c=n(56542),l=n(53741),f=n(51313),h=n(44459),d=n(89982),p=n(26130),m=n(64211),y=n(93324);function v(){v=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof b?t:b,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",m="completed",y={};function b(){}function g(){}function w(){}var D={};c(D,u,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(j([])));_&&_!==n&&r.call(_,u)&&(D=_);var x=w.prototype=b.prototype=Object.create(D);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,i,u,s){var a=f(e[o],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==A(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,s)}))}s(a.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=h;return function(i,u){if(o===p)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===y)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=p;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?m:d,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(A(t)+" is not iterable")}return g.prototype=w,o(x,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:g,configurable:!0}),g.displayName=c(w,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,a,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},C(F.prototype),c(F.prototype,s,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(x),c(x,a,"Generator"),c(x,u,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==A(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===A(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,s=[],a=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return s}}(e,t)||D(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){_(i,r,o,u,s,"next",e)}function s(e){_(i,r,o,u,s,"throw",e)}u(void 0)}))}}function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function C(e){return"errorMessage"===e.type}function F(e){var t="An unexpected error occurred";return e instanceof Error?t="Error(".concat(e.name,"): ").concat(e.message).trim():"string"==typeof e?t=e:"number"==typeof e?t="Error code: ".concat(e):"object"===A(e)&&null!==e&&(t=JSON.stringify(e)),{type:"errorMessage",payload:{content:t,role:"system"}}}function S(e){return"newMessage"===e.type}function O(e,t){return k.apply(this,arguments)}function k(){return k=x(v().mark((function e(t,n){var l,f,b,w,_,A,O=arguments;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=O.length>2&&void 0!==O[2]?O[2]:"gpt-4",f=O.length>3&&void 0!==O[3]?O[3]:[],(0,y.jm)()||(l="paused"),e.next=5,(0,d.pO)(t,l,n);case 5:if(b=e.sent,w=b.map((function(e){return e.message})),(0,m.A1)(w)){e.next=9;break}throw new Error("No messages in conversation");case 9:return _={newMessagesInput:new r.x,outgoingMessageStream:new o.X({messages:w,typingStatus:new Map}),functions:f,model:l},A=_.newMessagesInput.pipe((0,i.K)((function(e){return console.error("Error caught in aggregatedOutput!",e),(0,u.D)([F(e)])})),(0,p.P1)(function(){var e=x(v().mark((function e(n,r){var o;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!S(r)&&!C(r)){e.next=7;break}return e.next=3,(0,d.VO)(t,l,r.payload,n.lastResult);case 3:return o=e.sent,e.abrupt("return",{lastResult:o,event:{type:"processedMessage",payload:o.message}});case 7:return e.abrupt("return",g(g({},n),{},{event:r}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),{lastResult:b[b.length-1],event:null}),(0,s.U)((function(e){return e.event})),(0,a.h)(Boolean),(0,c.R)((function(e,t){if("processedMessage"===t.type){var n=[].concat(function(e){if(Array.isArray(e))return E(e)}(o=e.messages)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||D(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t.payload]),r=t.payload.role;return(0,h.WV)(r)&&e.typingStatus.get(r)?g(g({},e),{},{messages:n,typingStatus:new Map(e.typingStatus).set(r,"")}):g(g({},e),{},"function"===r?{messages:n,typingStatus:new Map(e.typingStatus).set("assistant","")}:{messages:n})}var o;if("typingUpdate"===t.type){var i=new Map(e.typingStatus);return i.set(t.payload.role,t.payload.content),g(g({},e),{},{typingStatus:i})}return e}),_.outgoingMessageStream.value)),(0,p.aw)(A,_.outgoingMessageStream),e.abrupt("return",_);case 14:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function B(e){console.log("TEARDOWNCONVO"),e.newMessagesInput.complete()}function P(e,t){var n=F(t);e.newMessagesInput.next(n)}function j(e,t){e.newMessagesInput.next({type:"newMessage",payload:{content:t,role:"function"}})}function I(e){return e.outgoingMessageStream.value.messages}function T(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?0:I(e).length;return e.outgoingMessageStream.pipe((0,s.U)((function(e){return[e.messages,e.typingStatus]})),(0,l.x)((function(e,t){var n=w(e,2),r=n[0],o=(n[1],w(t,2)),i=o[0];return o[1],r===i})),(0,c.R)((function(e,t){var n=w(e,3),r=(n[0],n[1]),o=(n[2],w(t,2)),i=o[0],u=o[1],s=i.slice(r);return[s,r+s.length,u]}),[[],t,new Map]),(0,f.b)((function(e){var t=w(e,3),n=t[0],r=(t[1],t[2]),o=n.map((function(e){return[e,r]}));return(0,u.D)(o)})))}(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]).pipe((0,s.U)((function(e){var t=w(e,2),n=t[0];return t[1],n})))}},4671:(e,t,n)=>{"use strict";n.d(t,{Au:()=>R,Ud:()=>F,_y:()=>O,oE:()=>S,os:()=>k,vz:()=>j});var r=n(49520),o=n(1545),i=n(19917),u=n(43994),s=n(32817),a=n(23071),c=n(94975),l=n(23229),f=n(99601),h=n(64211);function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function p(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(){m=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",y="executing",v="completed",b={};function g(){}function w(){}function D(){}var E={};c(E,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(j([])));x&&x!==n&&r.call(x,u)&&(E=x);var A=D.prototype=g.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,i,u,s){var a=f(e[o],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==d(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,s)}))}s(a.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=h;return function(i,u){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===b)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?v:p,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=v,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,b;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(d(t)+" is not iterable")}return w.prototype=D,o(A,"constructor",{value:D,configurable:!0}),o(D,"constructor",{value:w,configurable:!0}),w.displayName=c(D,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,D):(e.__proto__=D,c(e,a,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},C(F.prototype),c(F.prototype,s,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(A),c(A,a,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function y(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=D(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,D(r.key),r)}}function D(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===d(t)?t:String(t)}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function A(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){A(i,r,o,u,s,"next",e)}function s(e){A(i,r,o,u,s,"throw",e)}u(void 0)}))}}function F(e){return"function"===e.role&&"functionCall"in e}function S(e){return void 0!==e.timestamp}function O(e){return S(e)&&("user"===e.role||"assistant"===e.role||"system"===e.role)}var k="root";function B(e,t){return P.apply(this,arguments)}function P(){return(P=C(m().mark((function e(t,n){var r,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O(n)){e.next=2;break}return e.abrupt("return",n);case 2:return e.next=4,(0,l.TZ)(n.content);case 4:if(r=e.sent){e.next=8;break}return console.error("Could not deserialize function message content.",n),e.abrupt("return",g(g({},n),{},{role:"system",content:"Error: Could not deserialize function message content."}));case 8:return o=g(g({},n),{},{role:"function",functionCall:(0,l.Ij)(r)?{name:r.name,parameters:r.parameters,uuid:r.uuid}:{name:r.name,parameters:r.parameters,id:r.toolId,uuid:r.uuid}}),e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return"string"==typeof e.result}function I(e){return"number"==typeof e.id}function T(e){return e.parentHash&&e.parentHash!==k}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(Z,e);var t,n,r,v,b,D,A,F,S,P,j,R,L,M,N,q,K,U,$,H,G,X,z,W,V,J=(W=Z,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(W);if(V){var n=x(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _(e)}(this,e)});function Z(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Z),e=J.call(this,"ConversationDatabase"),(0,f.l)(_(e)),e.messages=e.table("messages"),e.embeddings=e.table("embeddings"),e.summaries=e.table("summaries"),e.summaryEmbeddings=e.table("summaryEmbeddings"),e.pins=e.table("pins"),e.functionResults=e.table("functionResults"),e.functionDependencies=e.table("functionDependencies"),e.functionDependencies2=e.table("functionDependencies2"),e}return t=Z,n=[{key:"saveMessage",value:function(e,t){var n,r=this;n=function(e){return void 0!==e.timestamp}(e)?B(this,e):this.transaction("rw",this.messages,(function(){return r.getMessageByHash(e.hash).then((function(t){if(t&&(T(t)||T(e))&&t.parentHash!==e.parentHash)throw new Error("Message with hash: ".concat(e.hash," exists but with a different parent hash."));if(t)return t;if(T(e))return r.getMessageByHash(e.parentHash).then((function(t){if(!t)throw new Error("Parent hash: ".concat(e.parentHash," does not exist in the database."));var n=g(g({},e),{},{timestamp:Date.now()});return r.messages.add(n).then((function(){return B(r,n)}))}));var n=g(g({},e),{},{timestamp:Date.now()});return r.messages.add(n).then((function(){return B(r,n)}))}))}));var o=t.messageSummary?this.getSummaryByHash(e.hash).then((function(e){return e||(t.messageSummary?t.messageSummary().then((function(e){return r.saveSummary(e)})):Promise.resolve(void 0))})):Promise.resolve(void 0),i=t.summaryEmbedding?o.then((function(n){if(!n)throw new Error("MessageSummary must be specified when SummaryEmbedding is specified.");return r.getSummaryEmbeddingByHash(e.hash).then((function(e){return e||(t.summaryEmbedding?t.summaryEmbedding(n).then((function(e){return r.saveSummaryEmbedding(e)})):Promise.resolve(void 0))}))})):Promise.resolve(void 0),u=t.messageEmbedding?this.getEmbeddingByHash(e.hash).then((function(e){return e||(t.messageEmbedding?t.messageEmbedding().then((function(e){return r.saveMetadata(e)})):Promise.resolve(void 0))})):Promise.resolve(void 0);return[n,Promise.all([o,i,u]).then((function(e){var n,r,o=(r=3,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,s=[],a=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return s}}(n,r)||y(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],u=o[1],s={messageEmbedding:o[2],messageSummary:i,summaryEmbedding:u};return function(e,t){for(var n in e)if(!(n in t))throw new Error("Key ".concat(n," is missing in metadata records."))}(t,s),s}))]}},{key:"getSummaryByHash",value:(z=C(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.summaries.get(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"saveSummary",value:(X=C(m().mark((function e(t){var n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.messages,this.summaries],C(m().mark((function e(){var r,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSummaryByHash(t.hash);case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,n.getMessageByHash(t.hash);case 7:if(e.sent){e.next=9;break}throw new Error("Hash: ".concat(t.hash," does not exist in the database."));case 9:return o=g(g({},t),{},{timestamp:Date.now()}),e.next=12,n.summaries.add(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"saveSummaryEmbedding",value:(G=C(m().mark((function e(t){var n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.messages,this.summaryEmbeddings],C(m().mark((function e(){var r,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSummaryEmbeddingByHash(t.hash);case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,n.getMessageByHash(t.hash);case 7:if(e.sent){e.next=9;break}throw new Error("Hash: ".concat(t.hash," does not exist in the database."));case 9:return o=g(g({},t),{},{timestamp:Date.now()}),e.next=12,n.summaryEmbeddings.add(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"saveMetadata",value:(H=C(m().mark((function e(t){var n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.messages,this.embeddings],C(m().mark((function e(){var r,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getEmbeddingByHash(t.hash);case 2:if(!(r=e.sent)){e.next=5;break}return e.abrupt("return",r);case 5:return e.next=7,n.getMessageByHash(t.hash);case 7:if(e.sent){e.next=9;break}throw new Error("Hash: ".concat(t.hash," does not exist in the database."));case 9:return o=g(g({},t),{},{timestamp:Date.now()}),e.next=12,n.embeddings.add(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"getMessageByHash",value:($=C(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.messages.get(t);case 2:return n=e.sent,e.abrupt("return",n&&B(this,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"getEmbeddingByHash",value:function(e){return this.embeddings.get(e)}},{key:"getSummaryEmbeddingByHash",value:function(e){return this.summaryEmbeddings.get(e)}},{key:"getConversationFromLeaf",value:(U=C(m().mark((function e(t){var n,r,o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=t;case 2:if(!r){e.next=12;break}return e.next=5,this.getMessageByHash(r);case 5:if(o=e.sent){e.next=8;break}return e.abrupt("break",12);case 8:n.push(o),r=T(o)?o.parentHash:null,e.next=2;break;case 12:return e.abrupt("return",n.reverse());case 13:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"getConversationFromLeafMessage",value:(K=C(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[t],T(t)){e.next=3;break}return e.abrupt("return",n);case 3:return e.next=5,this.getMessageByHash(t.parentHash);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",n);case 8:return e.t0=[],e.t1=p,e.next=12,this.getConversationFromLeafMessage(r);case 12:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=n,e.abrupt("return",e.t0.concat.call(e.t0,e.t3,e.t4));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"getMessagesFrom",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0},c=arguments.length>3?arguments[3]:void 0;return void 0!==c&&n>c?o.E:(0,i.P)((function(){return t.getDirectChildren(e)})).pipe((0,u.z)((function(o){var i=o.map((function(e){return t.getMessagesFrom(e,n+1,r,c)}));return e&&r(e,o)&&i.unshift((0,s.of)({message:e,pathLength:n})),a.T.apply(void 0,p(i))})))}},{key:"getLeafMessagesFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getMessagesFrom(e,t,(function(e,t){return 0===t.length}))}},{key:"getDirectChildren",value:(q=C(m().mark((function e(t){var n,r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.messages.where("parentHash").equals(t?t.hash:k).reverse().sortBy("timestamp");case 2:return n=e.sent,e.abrupt("return",Promise.all(n.map((function(e){return B(r,e)}))));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"getDirectSiblings",value:(N=C(m().mark((function e(t){var n,r,o=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.messages.where("parentHash").equals(null!==(n=t.parentHash)&&void 0!==n?n:"").sortBy("timestamp");case 2:return r=e.sent,e.abrupt("return",Promise.all(r.map((function(e){return B(o,e)}))));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"searchEmbedding",value:(M=C(m().mark((function e(t,n,r,o,i){var s,a,l,f,h=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null,!o){e.next=16;break}return e.next=4,this.getMessageByHash(o);case 4:if(e.t1=a=e.sent,e.t0=null!==e.t1,!e.t0){e.next=8;break}e.t0=void 0!==a;case 8:if(!e.t0){e.next=12;break}e.t2=a,e.next=13;break;case 12:e.t2=null;case 13:if(s=e.t2){e.next=16;break}throw new Error("searchembedding message not found! ".concat(o));case 16:return l=this.getMessagesFrom(s,0,(function(){return!0}),i).pipe((0,u.z)((function(e){return("embeddings"===r?h.getEmbeddingByHash(e.message.hash):h.getSummaryEmbeddingByHash(e.message.hash)).then((function(t){return t?{embedding:t,leafPath:e}:null}))})),(0,c.h)(Boolean)),f=[],e.abrupt("return",new Promise((function(e){var r=h;l.subscribe({next:function(e){f.push({hash:e.leafPath.message.hash,distance:r.cosineSimilarity(t,e.embedding.embedding)}),f=f.sort((function(e,t){return t.distance-e.distance})).slice(0,n)},complete:function(){var t=f.map((function(e){return e.hash}));e(t)}})})));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return M.apply(this,arguments)})},{key:"cosineSimilarity",value:function(e,t){if(e.length!==t.length)throw new Error("Embeddings have different dimensions");var n=Math.sqrt(e.reduce((function(e,t){return e+Math.pow(t,2)}),0)),r=Math.sqrt(t.reduce((function(e,t){return e+Math.pow(t,2)}),0));return e.reduce((function(e,n,r){return e+n*t[r]}),0)/(n*r)}},{key:"getLeafMessageFromAncestorHelper",value:(L=C(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.messages.where("parentHash").equals(t.hash).sortBy("timestamp");case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",this.getLeafMessageFromAncestorHelper(n[0]));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"getLeafMessageFromAncestor",value:(R=C(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLeafMessageFromAncestorHelper(t);case 2:return n=e.sent,e.abrupt("return",B(this,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"addPin",value:(j=C(m().mark((function e(t,n){var r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.transaction("rw",this.pins,C(m().mark((function e(){var o;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.hasPin(t);case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:return o={hash:t.hash,timestamp:Date.now(),version:1,remoteTimestamp:n},e.next=7,r.pins.add(o);case 7:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"removePin",value:(P=C(m().mark((function e(t){var n=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.transaction("rw",this.pins,C(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.pins.where("hash").equals(t.hash).delete();case 2:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"hasPin",value:(S=C(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pins.get(t.hash);case 2:return n=e.sent,e.abrupt("return",!!n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"getPinnedMessages",value:(F=C(m().mark((function e(){var t,n,r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pins.toArray();case 2:return t=e.sent,e.next=5,Promise.all(t.map((function(e){return r.getMessageByHash(e.hash)})));case 5:return n=e.sent,e.abrupt("return",n.filter(h.fQ).sort((function(e,t){return e.timestamp-t.timestamp})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"saveFunctionResult",value:(A=C(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g(g({},t),{},{timestamp:Date.now()}),e.next=3,this.functionResults.add(n);case 3:return r=e.sent,e.abrupt("return",g(g({},n),{},{id:r}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"getFunctionResultsByUUID",value:(D=C(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.functionResults.where("uuid").equals(t).sortBy("id");case 2:return e.abrupt("return",e.sent.filter(I));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"preloadMessage",value:(b=C(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O(t)){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,this.getFunctionResultsByUUID(t.functionCall.uuid);case 4:return n=e.sent,e.abrupt("return",g(g({},t),{},{results:n}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"saveFunctionDependency",value:(v=C(m().mark((function e(t,n){var r=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.transaction("rw",[this.functionResults,this.functionDependencies],C(m().mark((function e(){var o,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={hash:t.hash,timestamp:Date.now(),dependencyName:n},e.next=3,(0,l.qO)(r,t);case 3:if(i=e.sent){e.next=6;break}throw new Error("Cannot add dependency to a non-function message.");case 6:if(!i.some((function(e){return e.completed}))){e.next=8;break}throw new Error("Cannot add dependency to completed function result.");case 8:return e.next=10,r.functionDependencies.add(o);case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"getFunctionDependenciesByHash",value:(r=C(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.functionDependencies.where("hash").equals(t).toArray());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],n&&w(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),Z}(r.default)},99601:(e,t,n)=>{"use strict";function r(e){e.version(16).stores({messages:"&hash,timestamp,parentHash,role,content",embeddings:"&hash,timestamp,embedding",summaries:"&hash,timestamp,summary",summaryEmbeddings:"&hash,timestamp,embedding",pins:"&hash,timestamp,version,remoteTimestamp",functionResults:"++id,*uuid,timestamp,functionName,result,completed",functionDependencies:"&hash,timestamp,dependencyName"}),e.version(17).stores({functionDependencies2:"&[hash+dependencyName]"}),e.version(18).upgrade((function(){return e.table("functionDependencies").toArray().then((function(t){return e.table("functionDependencies2").bulkAdd(t)}))})),e.version(19).stores({functionDependencies:null}),e.version(20).stores({functionDependencies:"&[hash+dependencyName]"}).upgrade((function(){return e.table("functionDependencies2").toArray().then((function(t){return e.table("functionDependencies").bulkAdd(t)}))}))}n.d(t,{l:()=>r})},23229:(e,t,n)=>{"use strict";n.d(t,{EO:()=>$,Ij:()=>J,MM:()=>Z,N3:()=>X,TZ:()=>Y,YT:()=>U,ck:()=>S,hp:()=>W,qO:()=>Q,r$:()=>k});var r=n(40557),o=n(21276),i=n(4671),u=n(89982),s=n(40052),a=n(51313),c=n(80230),l=n(1718),f=n(43994),h=n(94975),d=n(30062),p=n(9141),m=n(28400),y=n(64211),v=n(93324),b=n(69365);function g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=E(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,s=[],a=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return s}}(e,t)||E(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function A(){A=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",m="completed",y={};function v(){}function b(){}function g(){}var w={};c(w,u,(function(){return this}));var D=Object.getPrototypeOf,E=D&&D(D(j([])));E&&E!==n&&r.call(E,u)&&(w=E);var _=g.prototype=v.prototype=Object.create(w);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,i,u,s){var a=f(e[o],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==x(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,s)}))}s(a.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=h;return function(i,u){if(o===p)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===y)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=p;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?m:d,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(x(t)+" is not iterable")}return b.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},C(F.prototype),c(F.prototype,s,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(_),c(_,a,"Generator"),c(_,u,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function C(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function F(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){C(i,r,o,u,s,"next",e)}function s(e){C(i,r,o,u,s,"throw",e)}u(void 0)}))}}var S=["generate_dynamic_function","invoke_dynamic_function","compose_dynamic_functions"],O=["generate_dynamic_function","compose_dynamic_functions"];function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.length<2)throw new Error("At least two function names are required to generate invocation code.");if(t===e.length-1)return'dependencies["'.concat(e[t],'"](input)');var n=k(e,t+1);return(0===t?"return ":"")+'dependencies["'.concat(e[t],'"](').concat(n,")")}function B(e,t,n){return{name:t,description:n,implementation:function(t,n,o,i,u){var c=t.db,l=function(){var t=F(A().mark((function t(){var s,a,l;return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,r.ke)(n);case 2:return s=t.sent,t.next=5,c.searchEmbedding(s,o,e,i,u);case 5:if(0!==(a=t.sent).length){t.next=10;break}return t.abrupt("return",["No results found."]);case 10:return t.next=12,Promise.all(a.map((function(e){return c.getMessageByHash(e)})));case 12:return l=t.sent.filter(y.fQ),t.abrupt("return",l.map((function(e){return"".concat(e.hash,": ").concat((60,(t=e.content.replace(/\n/g,"")).length>60?t.substring(0,57)+"...":t));var t})));case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,s.D)(l()).pipe((0,a.b)((function(e){return(0,s.D)(e)})))},parameters:[{name:"query",type:"string",description:"The query to convert into an embedding for the search.",required:!0},{name:"limit",type:"number",description:"The maximum number of message results to return.",required:!0},{name:"descendedFromSHA",type:"string",description:"Optional - when provided, only searches messages descended from the message with the provided SHA. Do not include quotes.",required:!1},{name:"maxDepth",type:"number",description:"Optional - when provided, only searches `maxDepth` more levels beneath the specified `descendedFromSHA`.",required:!1}]}}"\nCreate a JavaScript function dynamically and save it to a new message. `functionBody` is a string of code, and `dependencies` is an array of callable function SHAs or function names provided in the API call payload. Return values from other functions are coerced into Observable<string>. Use `RxJS` for RxJS functions and `dependencies` with SHAs or function names to call other functions.\n\nExample:\n###JSON\n{\n  \"functionBody\": \"return RxJS.forkJoin([dependencies['c2931bf195'](input), dependencies['some_function']({someParam: 10, otherParam: \"yes\"})]).pipe(RxJS.map(results => results.join(' and ')));\",\n  \"dependencies\": ['c2931bf195', 'some_function']\n}\n###\n\nIn the above example the `c2931bf195` SHA and the contrived `some_function` function calling mechanism function were specified as dependencies and became available via `dependencies[]()`.\n".trim();var P='\nInvoke a dynamic function using its SHA hash with `invoke_dynamic_function`. Provide `functionHash`, the SHA of the function, and `input`, an array of strings to pass as arguments. The function returns an RxJS Observable<string> with the function\'s output. The function is executed in a Worker, ensuring isolation and asynchronous execution. The observable emits values as they are received from the worker and completes when the function execution is done.\n\nExample:\n###JSON\n{\n  "functionHash": "c2931bf195957b133ebb5e8820df94a20c96887e234d2869ecafad53846501e7",\n  "input": ["sample input"]\n}\n###\n'.trim();function j(e,t,n){return new c.y((function(e){var r=new Worker(window.workerPath);r.postMessage({SET_API_KEY:(0,v.O4)()}),r.addEventListener("message",(function(t){var n=t.data;return"error"===n.status?(e.error(n.error),e.complete(),r.terminate(),void console.log("received error",n)):"complete"===n.status?(e.complete(),void r.terminate()):void e.next("object"===x(n.content)?JSON.stringify(n.content):String(n.content))})),r.addEventListener("error",(function(t){console.log("received error",t),e.error(t.error||t.message),r.terminate()}));var o={functionHash:t,input:n};r.postMessage(o)}))}var I,T,R,L,M,N,q,K,U=[B("embeddings","direct_message_embedding_search","Compares the embedding of the search `query` with the embeddings of the contents of messages using cosine similarity. Returns 'limit' number of closest matching messages."),B("summaryEmbeddings","summary_message_embedding_search","Compares the embedding of the search `query` with the embeddings of the summaries of conversations terminating with potential message results using cosine similarity. Returns 'limit' number of closest matching messages."),{name:"append_user_reply",description:"Appends the provided message content as a user (or overridden `role`) reply to the message specified by `parentHash`.",implementation:(K=F(A().mark((function e(t,n,r,o){var i,s,a,c,l,f,h;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r||(r="user"),["user","system","assistant"].includes(r)){e.next=3;break}throw new Error('Invalid role "'.concat(r,'". Must be either "user" or "system" or "assistant".'));case 3:if(i=r,s=[],!o){e.next=14;break}return e.next=8,t.db.getMessageByHash(o);case 8:if(a=e.sent){e.next=11;break}throw new Error("Message with SHA ".concat(o," not found."));case 11:return e.next=13,t.db.getConversationFromLeafMessage(a);case 13:s=e.sent;case 14:if(c={role:i,content:n},l=[].concat(D(s),[c]),(0,y.A1)(l)){e.next=18;break}throw new Error("Unexpected codepoint reached - empty messages array in append_user_reply");case 18:return e.next=20,(0,u.pO)(t.db,"paused",l);case 20:return f=e.sent,h=f[f.length-1].message,e.abrupt("return",h.hash);case 23:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return K.apply(this,arguments)}),parameters:[{name:"content",type:"string",description:"The content of the new message.",required:!0},{name:"role",type:"string",description:"Must be one of either 'user', 'system', or `assistant`. (defaults to 'user')",required:!1},{name:"parentHash",type:"string",description:"The SHA of the message to append a reply to. (defaults to starting a new conversation from the root rather than replying to an existing message)",required:!1}]},{name:"conversation_completion",description:"Uses GPT to get the next message in a conversation at the specified leaf message.",implementation:(q=F(A().mark((function e(t,n,r){var i,u,s,a,c,f;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r||"").split(",").map((function(e){return e.trim()})),u=U.map((function(e){return{name:e.name,description:e.description,parameters:{type:"object",properties:e.parameters.reduce((function(e,t){return e[t.name]={type:t.type,description:t.description},t.items&&(e[t.name].items=t.items),e}),{})},required:e.parameters.filter((function(e){return e.required})).map((function(e){return e.name}))}})).filter((function(e){return i.includes(e.name)})),e.next=4,t.db.getMessageByHash(n);case 4:if(s=e.sent){e.next=7;break}throw new Error("Message with SHA ".concat(n," not found."));case 7:if(["system","user"].includes(s.role)){e.next=9;break}return e.abrupt("return","");case 9:return e.next=11,t.db.getConversationFromLeafMessage(s);case 11:return a=e.sent,e.next=14,(0,m.vw)(t.db,a,"gpt-4",u);case 14:return c=e.sent,f=(0,o.kg)(c,!1),e.next=18,(0,l.z)(f).then((function(e){return(0,o.Mx)(c),e.hash}));case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e)}))),function(e,t,n){return q.apply(this,arguments)}),parameters:[{name:"sha",type:"string",description:"The SHA address of the last message in the conversation to run a completion against. If the message is not a user or system message, the function will complete without a result.",required:!0},{name:"enabledFunctions",type:"string",description:"A comma separated list of function names to enable for this completion. Defaults to no functions.",required:!1}]},{name:"generate_dynamic_function",description:"Create a JavaScript function dynamically and save it to a new message. `functionBody` is a string of code, and `dependencies` is an array of callable function SHAs or function names provided in the API call payload. Return values from other functions are coerced into Observable<string>. Use `RxJS` for RxJS functions and `dependencies` with SHAs or function names to call other functions. The function must handle errors and return each element as a separate event in an Observable<string> when multiple values are involved.",implementation:(N=F(A().mark((function e(t,n,r){var o,i,u,s,a,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r=[]),e.next=3,t.functionMessagePromise;case 3:if(Y((o=e.sent).content)){e.next=7;break}throw new Error("Invalid function message content");case 7:if(i=t.functionOptions,u=i.map((function(e){return e.name})),!((s=r.filter((function(e){return S.includes(e)}))).length>0)){e.next=12;break}throw new Error("Forbidden dependencies: ".concat(s.join(", ")));case 12:return a=r.filter((function(e){return!u.includes(e)})),e.next=15,Promise.all(a.map(function(){var e=F(A().mark((function e(n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.getMessageByHash(n);case 2:return r=e.sent,e.abrupt("return",r?null:n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:if(!((c=e.sent.filter(Boolean)).length>0)){e.next=18;break}throw new Error("Missing dependencies: ".concat(c.join(", ")));case 18:return e.next=20,Promise.all(r.map(function(){var e=F(A().mark((function e(n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.saveFunctionDependency(o,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:return e.abrupt("return","Dynamic function persisted:\n\n"+JSON.stringify({hash:o.hash,functionBody:n,dependencies:r}));case 21:case"end":return e.stop()}}),e)}))),function(e,t,n){return N.apply(this,arguments)}),parameters:[{name:"functionBody",type:"string",description:"The body of the function to generate without the enclosing function definition or surrounding curly braces. `input` is an RxJS Observable<string>, and must be accessed as such (e.g., `input.pipe(RxJS.first(), ...`). `dependencies` is an object mapping function names to functions, and must be accessed as an object. When invoking a dependency function, pass the argument directly without wrapping it in an object unless the function explicitly requires an object. The function must either not return, or return a string, Observable<string>, or Promise<string>. An empty string return will be interpreted the same as no return. Avoid returning Observable<string[]> or Promise<string[]> as they will be flattened into a single string; instead, emit each element as a separate event in an Observable<string> whenever possible. It is important to ensure that the function body correctly handles the invocation of dependencies, especially when dealing with dynamic function SHAs. Incorrect invocation can lead to errors such as invalid object where a stream was expected.",required:!0},{name:"dependencies",type:"array",items:{type:"string"},description:"Defaults to []. A list of the names of the functions to which the generated function should have access. Access will be provided to the `functionBody` via a `dependencies` variable. Any functions or SHAs not specified in this list will not be accessible to the generated function. Specify the SHA of a function to include it as a callable dependency within the generated function. When specifying a function by SHA, use the SHA as the key in the `dependencies` object. Example: `['get_message_property', 'c2931bf195957b133ebb5e8820df94a20c96887e234d2869ecafad53846501e7']`. The following functions are forbidden as dependencies: "+S.join(", ")+".",required:!1}]},{name:"compose_dynamic_functions",description:"Compose multiple dynamic functions into a single function by chaining them such that the output of one function is the input to the next. The order of execution is determined by the reverse of the array order; for example, an array `['f', 'g']` will result in a composition equivalent to `return f(g(input))`. Only dynamic functions specified by their SHAs are supported, and each must accept and return an RxJS Observable<string>.",implementation:(M=F(A().mark((function e(t,n){var r,o;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.functionMessagePromise;case 2:if(Y((r=e.sent).content)){e.next=6;break}throw new Error("Invalid function message content");case 6:return e.next=8,Promise.all(n.map(function(){var e=F(A().mark((function e(n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.getMessageByHash(n);case 2:return r=e.sent,e.abrupt("return",r?null:n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:if(!((o=e.sent.filter(Boolean)).length>0)){e.next=11;break}throw new Error("Missing functionHashes: ".concat(o.join(", ")));case 11:return e.next=13,Promise.all(n.map(function(){var e=F(A().mark((function e(n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.saveFunctionDependency(r,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:return e.abrupt("return","Dynamic function persisted:\n\n"+JSON.stringify({hash:r.hash,functionBody:k(n),functionHashes:n}));case 14:case"end":return e.stop()}}),e)}))),function(e,t){return M.apply(this,arguments)}),parameters:[{name:"functionHashes",type:"array",items:{type:"string"},description:"An array of SHAs, each representing a dynamic function to be composed. The functions are composed in reverse order, with the last SHA in the array being the first to process the input and the first SHA being the last, forming a pipeline. All functions must accept and return an RxJS Observable<string>. The array must contain at least two SHAs.",required:!0}]},{name:"invoke_dynamic_function",description:P,implementation:j,parameters:[{name:"functionHash",type:"string",description:"The SHA of the function to invoke.",required:!0},{name:"input",type:"array",items:{type:"string"},description:"The input to provide to the function. Defaults to [].",required:!1}]},{name:"get_message_property",description:"Gets a `property` of a message at the provided `sha` address.",implementation:function(e,t,n){return n||(n="content"),new c.y((function(r){F(A().mark((function o(){var u,s,a,c,l,f;return A().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.db.getMessageByHash(t);case 2:if(u=o.sent){o.next=6;break}return r.error("Message with SHA ".concat(t," not found.")),o.abrupt("return");case 6:if("role"!==n&&"content"!==n&&"parentHash"!==n&&"timestamp"!==n&&"hash"!==n){o.next=9;break}return r.next(String(u[n])),o.abrupt("return");case 9:if("children"!==n){o.next=15;break}return o.next=12,e.db.getDirectChildren(u);case 12:return o.sent.forEach((function(e){return r.next(e.hash)})),o.abrupt("return");case 15:if("siblings"!==n){o.next=21;break}return o.next=18,e.db.getDirectSiblings(u);case 18:return o.sent.forEach((function(e){return r.next(e.hash)})),o.abrupt("return");case 21:if("summary"!==n){o.next=27;break}return o.next=24,e.db.getSummaryByHash(u.hash);case 24:return null!=(s=o.sent)&&s.summary&&r.next(s.summary),o.abrupt("return");case 27:if("functionResults"!==n){o.next=38;break}if((0,i.Ud)(u)){o.next=30;break}return o.abrupt("return");case 30:if(a=Y(u.content)){o.next=33;break}return o.abrupt("return");case 33:return o.next=35,e.db.getFunctionResultsByUUID(a.uuid);case 35:return(c=o.sent).find((function(e){return e.completed}))&&c.filter((function(e){return!e.completed})).forEach((function(e){return r.next(e.result)})),o.abrupt("return");case 38:if("functionDependencies"!==n){o.next=44;break}return o.next=41,e.db.getFunctionDependenciesByHash(u.hash);case 41:return o.sent.forEach((function(e){return r.next(e.dependencyName)})),o.abrupt("return");case 44:if("embedding"!==n){o.next=50;break}return o.next=47,e.db.getEmbeddingByHash(u.hash);case 47:return(l=o.sent)&&l.embedding.forEach((function(e){return r.next(String(e))})),o.abrupt("return");case 50:if("summaryEmbedding"!==n){o.next=56;break}return o.next=53,e.db.getSummaryEmbeddingByHash(u.hash);case 53:return(f=o.sent)&&f.embedding.forEach((function(e){return r.next(String(e))})),o.abrupt("return");case 56:throw new Error('Invalid property "'.concat(n,"\". Must be either 'role', 'content', 'parentHash', 'timestamp', 'hash', 'children', 'siblings', 'summary', 'functionResults', 'functionDependencies', 'embedding', or 'summaryEmbedding'."));case 57:case"end":return o.stop()}}),o)})))().then((function(){return r.complete()}))}))},parameters:[{name:"sha",type:"string",description:"SHA address which specifies the target message for property retrieval.",required:!0},{name:"property",type:"string",description:"The property to retrieve, defaults to 'content'. Must be one of either:\n'role'\n'content'\n'parentHash'\n'timestamp' (stringified integer representation)\n'hash'\n'children' (their SHAs each in its own event)\n'siblings' (their SHAs each in its own event)\n'summary' (recursive summary representing the conversation path from root to the specified message)\n'functionResults' (EMPTY if not a completed function message)\n'functionDependencies' (each in its own event)\n'embedding' (EMPTY if no embedding, stringified floats each in their own event if present)\n'summaryEmbedding' (same behavior as 'embedding' but for the recursive summary)\n        ".trim(),required:!1}]},{name:"recursively_summarize_path",description:"For any messages which are missing it, recursively summarizes and generates an embedding for both the message content and the summary for every message in the conversation path from the root to the message specified by `sha`. Useful for ensuring that all messages in a conversation path have summaries and embeddings before performing an action which depends on them.",implementation:(L=F(A().mark((function e(t,n){var r,o,i;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.getMessageByHash(n);case 2:if(r=e.sent){e.next=5;break}throw new Error("Message with SHA ".concat(n," not found."));case 5:return e.next=7,t.db.getConversationFromLeafMessage(r);case 7:return o=e.sent,e.next=10,(0,u.pO)(t.db,"gpt-4",o);case 10:return i=e.sent,e.next=13,Promise.all(i.map((function(e){return e.metadataRecordsPromise})));case 13:return e.abrupt("return","");case 14:case"end":return e.stop()}}),e)}))),function(e,t){return L.apply(this,arguments)}),parameters:[{name:"sha",type:"string",description:"SHA address which specifies the last message in a conversation path starting at the root of the tree.",required:!0}]},{name:"jsonp_data_retrevial",description:"Retrieves data from a JSONP endpoint and returns it as a string via JSON.stringify.",implementation:function(e,t){return new Promise((function(e,n){var r="jsonp_callback_"+Math.round(1e5*Math.random());window[r]=function(t){delete window[r],document.body.removeChild(o),e(JSON.stringify(t.data))};var o=document.createElement("script");o.src=t+(t.indexOf("?")>=0?"&":"?")+"callback="+r,document.body.appendChild(o)}))},parameters:[{name:"url",type:"string",description:"The URL of the JSONP-compatible endpoint to retrieve data from. The JSONP callback parameter will be automatically appended to the URL.",required:!0}]},{name:"cors_data_retrieval",description:"Retrieves data from a CORS-compatible endpoint with specified options and returns it as a string.",implementation:(R=F(A().mark((function e(t,n,r,o,i){var u,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={method:r||"GET",headers:o||{}},i&&"POST"===(null==r?void 0:r.toUpperCase())&&(u.body=i),e.next=4,fetch(n,u);case 4:return s=e.sent,e.abrupt("return",s.text());case 6:case"end":return e.stop()}}),e)}))),function(e,t,n,r,o){return R.apply(this,arguments)}),parameters:[{name:"url",type:"string",description:"The URL of the CORS-compatible endpoint to retrieve data from.",required:!0},{name:"method",type:"string",description:"The HTTP method (e.g., GET, POST). Optional, defaults to GET.",required:!1},{name:"headers",type:"object",additionalProperties:{type:"string"},description:"Headers to include in the request. Optional.",required:!1},{name:"body",type:"string",description:"The body content for POST, PUT requests. Not needed for GET requests.",required:!1}]},{name:"rag",description:"Draws in additional messages for context via a dynamic function address while keeping them out of the ongoing conversation history.",implementation:(T=F(A().mark((function e(t,n){var r,i,u,s,a,c,p,m,v,g,E,_,x,C;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.functionMessagePromise;case 2:if(r=e.sent,i=(0,o.qu)(t.conversation),u=i.filter((function(e){return e.hash!==r.hash})),(0,y.A1)(u)){e.next=7;break}throw new Error("Conversation was too short to use RAG. Must have at least one message prior to the function message.");case 7:return s=(0,y.kb)(u),a=w(s,2),c=a[0],p=a[1],e.next=10,(0,l.z)(j(0,n,p.hash).pipe((0,f.z)(function(){var e=F(A().mark((function e(n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.db.getMessageByHash(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,h.h)(Boolean),(0,d.q)()));case 10:return m=e.sent,v={role:"system",content:"This conversation has been supplemented with the following messages for Retrieval Agumented Generation:"},g={role:"system",content:"End of RAG messages. Please use the above messages to respond to the following message:"},E={role:"system",content:"No messages were found for Retrieval Augmented Generation. Instead, respond to the following message directly:"},_=m.length>0?[].concat(D(c),[v],D(m),[g,p]):[].concat(D(c),[E,p]),x=t.conversation.functions.filter((function(e){return"rag"!==e.name})),e.next=18,(0,o.Xw)(t.db,(0,y.Al)(_),"gpt-4",x);case 18:return(C=e.sent).newMessagesInput.subscribe(t.conversation.newMessagesInput),e.abrupt("return",new Promise((function(e){(0,o.kg)(C,!1).subscribe({next:function(t){(0,o.Mx)(C),e(t.hash)},error:function(e){throw(0,o.Mx)(C),e}}),(0,b.V)(C,t.db)})));case 21:case"end":return e.stop()}}),e)}))),function(e,t){return T.apply(this,arguments)}),parameters:[{name:"functionHash",type:"string",description:"The SHA of the function to invoke, typically indicated in a system message.",required:!0}]},{name:"alert",description:"Displays a browser alert with the provided message.",implementation:(I=F(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert(n),e.abrupt("return","sent alert!");case 2:case"end":return e.stop()}}),e)}))),function(e,t){return I.apply(this,arguments)}),parameters:[{name:"message",type:"string",description:"The message to display in the alert.",required:!0}]},{name:"prompt",description:"Opens a prompt dialog asking the user to input some text.",implementation:function(e,t,n){return prompt(t,n)||""},parameters:[{name:"message",type:"string",description:"The message to display in the prompt.",required:!0},{name:"defaultValue",type:"string",description:"The default value to prefill in the prompt input.",required:!1}]},{name:"error",description:"Throws an error with the provided message.",implementation:function(e,t){throw new Error(t)},parameters:[{name:"message",type:"string",description:"The message to display in the error.",required:!0}]}];function $(e,t){return e.functions.some((function(e){return e.name===t.name}))}function H(e,t){return G.apply(this,arguments)}function G(){return(G=F(A().mark((function e(t,n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,o.kg)(t,!1),e.abrupt("return",(0,l.z)(r.pipe((0,h.h)(i.Ud),(0,h.h)((function(e){var t;return(null===(t=Y(e.content))||void 0===t?void 0:t.uuid)===n.uuid})))));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,n){return z.apply(this,arguments)}function z(){return z=F(A().mark((function e(t,n,i){var u,s,a,c,l,f,h,d,m,y;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u=V(n),v=s=(0,r.nt)(n)?{parameters:n.parameters,name:n.name,toolId:n.id,uuid:n.uuid,v:2}:{parameters:n.parameters,name:n.name,uuid:n.uuid,v:1},a=JSON.stringify(v),(0,o.cm)(t,a),c=H(t,s),l=u({db:i,functionMessagePromise:c,functionOptions:t.functions,conversation:t}),f=function(){var e=F(A().mark((function e(t,r){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return",i.saveFunctionResult({uuid:n.uuid,functionName:n.name,completed:!0}));case 2:if(""!==t){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",i.saveFunctionResult({uuid:n.uuid,functionName:n.name,result:t,completed:!1}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),!(0,p.b)(l)){e.next=11;break}return l.subscribe({next:function(){var e=F(A().mark((function e(t){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,!1);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),complete:function(){var e=F(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("",!0);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),error:function(){var e=F(A().mark((function e(n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.y7)(t,n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),e.abrupt("return");case 11:if(void 0!==l){e.next=15;break}return e.next=14,f("",!0);case 14:return e.abrupt("return");case 15:if(!Array.isArray(l)){e.next=36;break}h=g(l),e.prev=17,h.s();case 19:if((d=h.n()).done){e.next=25;break}return m=d.value,e.next=23,f(m,!1);case 23:e.next=19;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(17),h.e(e.t0);case 30:return e.prev=30,h.f(),e.finish(30);case 33:return e.next=35,f("",!0);case 35:return e.abrupt("return");case 36:return e.next=38,l;case 38:return y=e.sent,e.next=41,f(y,!1);case 41:return e.next=43,f("",!0);case 43:e.next=49;break;case 45:throw e.prev=45,e.t1=e.catch(0),console.error("caught error in callFunction",e.t1),e.t1;case 49:case"end":return e.stop()}var v}),e,null,[[0,45],[17,27,30,33]])}))),z.apply(this,arguments)}function W(e,t){return t.parameters.map((function(t){if(t.name in e){var n,r,o=e[t.name];if("number"===t.type)return Number(o);if("boolean"===t.type)return Boolean(o);if("string"===t.type)return String(o);if("array"===t.type&&"string"===(null===(n=t.items)||void 0===n?void 0:n.type))return o.map(String);if("object"===t.type&&"string"===(null===(r=t.additionalProperties)||void 0===r?void 0:r.type))return Object.fromEntries(Object.entries(o).map((function(e){var t=w(e,2),n=t[0],r=t[1];return[n,String(r)]})));throw new Error('Unsupported parameter type "'.concat(t.type,'" for parameter "').concat(t.name,'". It had value of ').concat(o))}if(t.required)throw new Error('Required parameter "'.concat(t.name,'" missing in function call.'))}))}function V(e){var t=U.find((function(t){return t.name===e.name}));if(!t)throw new Error('Function "'.concat(e.name,'" not found in specs.'));var n=W(e.parameters,t);return function(e){return t.implementation.apply(t,[e].concat(D(n)))}}function J(e){return 1===e.v}function Z(e){return O.includes(e.name)}function Y(e){try{var t=JSON.parse(e);return!t.uuid||1!==t.v&&2!==t.v?null:t}catch(t){return console.error("Error deserializing function message content",t,e),null}}function Q(e,t){return ee.apply(this,arguments)}function ee(){return(ee=F(A().mark((function e(t,n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"===n.role){e.next=2;break}return e.abrupt("return",null);case 2:if(r=Y(n.content)){e.next=6;break}return console.error("Invalid function message content",n.content),e.abrupt("return",null);case 6:return e.abrupt("return",t.getFunctionResultsByUUID(r.uuid));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},89982:(e,t,n)=>{"use strict";n.d(t,{VO:()=>C,pO:()=>S});var r=n(4671),o=n(40557),i=n(64211),u=n(72886),s=n(1718),a=n(94975),c=n(29127),l=n(93324);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==f(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===f(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(){v=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",p="suspendedYield",m="executing",y="completed",b={};function g(){}function w(){}function D(){}var E={};c(E,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(j([])));x&&x!==n&&r.call(x,u)&&(E=x);var A=D.prototype=g.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,i,u,s){var a=h(e[o],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==f(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,s)}))}s(a.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=d;return function(i,u){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===b)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var c=h(t,n,r);if("normal"===c.type){if(o=r.done?y:p,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=y,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var i=h(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,b;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(f(t)+" is not iterable")}return w.prototype=D,o(A,"constructor",{value:D,configurable:!0}),o(D,"constructor",{value:w,configurable:!0}),w.displayName=c(D,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,D):(e.__proto__=D,c(e,a,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},C(F.prototype),c(F.prototype,s,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(A),c(A,a,"Generator"),c(A,u,(function(){return this})),c(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function b(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){b(i,r,o,u,s,"next",e)}function s(e){b(i,r,o,u,s,"throw",e)}u(void 0)}))}}var w=function(){var e=g(v().mark((function e(t,n){var r,o,i,u,s,a;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.content,o=t.role,i=JSON.stringify({content:r,role:o}),u=n.reduce((function(e,t){return e+t}),i),e.next=5,crypto.subtle.digest("SHA-256",(new TextEncoder).encode(u));case 5:return s=e.sent,a=Array.from(new Uint8Array(s)),e.abrupt("return",a.map((function(e){return e.toString(16).padStart(2,"0")})).join(""));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),D={message:null,metadataRecordsPromise:Promise.resolve({})};function E(e){return e.replace(/\"\"\"/g,'\\"\\"\\"')}function _(e,t){e=E(e);var n=E(t.content);return"Given the following two texts to combine:\n\nNew Message (".concat(t.role,'): """\n').concat(n,'\n"""\n\nPrior Conversation Summary: """\n').concat(e,'\n"""\n\nPlease generate a summary of the overall conversation.')}function x(e,t){return A.apply(this,arguments)}function A(){return(A=g(v().mark((function e(t,n){var r,o,i,l,f,h;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.metadataRecordsPromise;case 2:if(e.t2=o=e.sent.messageSummary,e.t1=null===e.t2,e.t1){e.next=6;break}e.t1=void 0===o;case 6:if(!e.t1){e.next=10;break}e.t3=void 0,e.next=11;break;case 10:e.t3=o.summary;case 11:if(e.t4=r=e.t3,e.t0=null!==e.t4,!e.t0){e.next=15;break}e.t0=void 0!==r;case 15:if(!e.t0){e.next=19;break}e.t5=r,e.next=20;break;case 19:e.t5="";case 20:return i=e.t5,l=_(i,t),f=_("A series of exercise instructions have been recommended including sit ups, push ups, chin ups with further advice offered. Inquiries have been made about exercise activities for the purposes of strength training.",{role:"user",content:"That all seems kind of hard though..."}),h=(0,u.Ds)([{role:"system",content:"As an AI, your task is to generate a summary that blends the contents of the prior summary (80%) with the new message (20%) without explicitly indicating which the new content came from. The new output should prioritize the content of the prior summary. Analyze the new message for key themes, but ensure they don't overshadow the content from the prior summary. The goal is a summary that maintains the context and flow, and is representative of the entire discussion up to this point. These summaries will be used for embeddings and message search, so they should be informative and detailed. The objective is a predictable, understandable summary that aids users in contextual search. Only phase out components from the prior summary if they are explicitly contradicted or negated in the new message."},{role:"user",content:f},{role:"assistant",content:"Concern is expressed at the difficulty of the exercises. A series of exercise instructions have been recommended including sit ups, push ups, chin ups."},{role:"user",content:l}],.1,"gpt-4",100),e.abrupt("return",(0,s.z)(h.pipe((0,a.h)(u.fY),(0,c.U)((function(e){return e.text})))));case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t,n,r){return F.apply(this,arguments)}function F(){return F=g(v().mark((function e(t,n,i,u){var s,a,c,f,h,p,m,b,D,E,_;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,l.jm)()||(n="paused"),s=u.message?u.message.hash:r.os,e.next=4,w(i,[s]);case 4:return a=e.sent,(0,r.oE)(i)&&i.hash===a?c=i:(f={content:i.content,role:i.role,hash:a,parentHash:s},c=f),h={messageEmbedding:function(){var e=g(v().mark((function e(){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.ke)(i.content);case 2:return t=e.sent,e.abrupt("return",{hash:c.hash,embedding:t});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},p={messageSummary:function(){var e=g(v().mark((function e(){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(i,u);case 2:return t=e.sent,e.abrupt("return",{hash:c.hash,summary:t});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),summaryEmbedding:function(){var e=g(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.ke)(t.summary);case 2:return n=e.sent,e.abrupt("return",{hash:c.hash,embedding:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},m="paused"===n?h:y(y({},h),p),b=t.saveMessage(c,m),C=2,D=function(e){if(Array.isArray(e))return e}(A=b)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,u,s=[],a=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return s}}(A,C)||d(A,C)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),E=D[0],_=D[1],e.next=12,E;case 12:return e.t0=e.sent,e.t1=_,e.abrupt("return",{message:e.t0,metadataRecordsPromise:e.t1});case 15:case"end":return e.stop()}var A,C}),e)}))),F.apply(this,arguments)}function S(e,t,n){return O.apply(this,arguments)}function O(){return(O=g(v().mark((function e(t,n,r){var o,u,s,a,c,l;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t,n,r[0],D);case 2:if(o=e.sent,u=[o],s=r.slice(1),(0,i.A1)(s)){e.next=7;break}return e.abrupt("return",u);case 7:a=h(s),e.prev=8,a.s();case 10:if((c=a.n()).done){e.next=18;break}return l=c.value,e.next=14,C(t,n,l,o);case 14:o=e.sent,u.push(o);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),a.e(e.t0);case 23:return e.prev=23,a.f(),e.finish(23);case 26:return e.abrupt("return",u);case 27:case"end":return e.stop()}}),e,null,[[8,20,23,26]])})))).apply(this,arguments)}},44459:(e,t,n)=>{"use strict";function r(e){return"user"===e||"assistant"===e}function o(e,t,n){e.newMessagesInput.next({type:"typingUpdate",payload:{role:t,content:n}})}function i(e,t,n){n&&e.newMessagesInput.next({type:"newMessage",payload:{content:n,role:t}})}n.d(t,{WV:()=>r,bG:()=>i,un:()=>o})},26130:(e,t,n)=>{"use strict";n.d(t,{P1:()=>a,aw:()=>s});var r=n(83286),o=n(51313),i=n(40052),u=n(29127);function s(e,t){return e.pipe((0,r.x)((function(){return t.complete()}))).subscribe(t)}function a(e,t){var n=0,r=t;return function(t){return t.pipe((0,o.b)((function(t){return(0,i.D)(e(r,t,n++)).pipe((0,u.U)((function(e){return r=e,e})))})))}}},28400:(e,t,n)=>{"use strict";n.d(t,{vw:()=>a}),n(67294);var r=n(21276),o=(n(4671),n(69365));function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function u(){u=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="suspendedYield",y="executing",v="completed",b={};function g(){}function w(){}function D(){}var E={};f(E,a,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(j([])));x&&x!==n&&r.call(x,a)&&(E=x);var A=D.prototype=g.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,u,s,a){var c=d(e[o],e,u);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==i(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}var u;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return u=u?u.then(o,o):o()}})}function S(t,n,r){var o=p;return function(i,u){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===b)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var c=d(t,n,r);if("normal"===c.type){if(o=r.done?v:m,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=v,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var i=d(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,b;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,u=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return u.next=u}}throw new TypeError(i(t)+" is not iterable")}return w.prototype=D,o(A,"constructor",{value:D,configurable:!0}),o(D,"constructor",{value:w,configurable:!0}),w.displayName=f(D,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,D):(e.__proto__=D,f(e,l,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},C(F.prototype),f(F.prototype,c,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(h(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(A),f(A,l,"Generator"),f(A,a,(function(){return this})),f(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function s(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function a(e,t){return c.apply(this,arguments)}function c(){return e=u().mark((function e(t,n){var i,s,a,c=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:"gpt-4",s=c.length>3&&void 0!==c[3]?c[3]:[],e.next=4,(0,r.Xw)(t,n,i,s);case 4:return a=e.sent,e.abrupt("return",(0,o.V)(a,t));case 6:case"end":return e.stop()}}),e)})),c=function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){s(i,r,o,u,a,"next",e)}function a(e){s(i,r,o,u,a,"throw",e)}u(void 0)}))},c.apply(this,arguments);var e}n(51039)},40557:(e,t,n)=>{"use strict";n.d(t,{Gj:()=>y,ke:()=>p,nt:()=>d});var r=n(45468),o=n(93324),i=n(11142),u=n.n(i),s=n(72045);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function c(){c=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,u=Object.create(i.prototype),s=new P(r||[]);return o(u,"_invoke",{value:S(e,n,s)}),u}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="suspendedYield",y="executing",v="completed",b={};function g(){}function w(){}function D(){}var E={};f(E,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(j([])));x&&x!==n&&r.call(x,u)&&(E=x);var A=D.prototype=g.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(o,i,u,s){var c=d(e[o],e,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==a(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(f).then((function(e){l.value=e,u(l)}),(function(e){return n("throw",e,u,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function S(t,n,r){var o=p;return function(i,u){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=O(s,r);if(a){if(a===b)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var c=d(t,n,r);if("normal"===c.type){if(o=r.done?v:m,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=v,r.method="throw",r.arg=c.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var i=d(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,b;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(a(t)+" is not iterable")}return w.prototype=D,o(A,"constructor",{value:D,configurable:!0}),o(D,"constructor",{value:w,configurable:!0}),w.displayName=f(D,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,D):(e.__proto__=D,f(e,l,"GeneratorFunction")),e.prototype=Object.create(A),e},t.awrap=function(e){return{__await:e}},C(F.prototype),f(F.prototype,s,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new F(h(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},C(A),f(A,l,"Generator"),f(A,u,(function(){return this})),f(A,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function l(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){l(i,r,o,u,s,"next",e)}function s(e){l(i,r,o,u,s,"throw",e)}u(void 0)}))}}var h=function(){var e=(0,o.O4)();return e?new r.Pp({apiKey:e,organization:"org-6d0xAcuSuOUHzq8s4TejB1TQ",dangerouslyAllowBrowser:!0}):null};function d(e){return"id"in e&&"string"==typeof e.id}function p(e){return m.apply(this,arguments)}function m(){return m=f(c().mark((function e(t){var n,r,i,u,s,a,l=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:"text-embedding-ada-002",r=(0,o.O4)()){e.next=4;break}throw new Error("API Key not found");case 4:return i={input:t,model:n},e.next=7,fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(i)});case 7:if((u=e.sent).ok){e.next=13;break}return e.next=11,u.text();case 11:throw s=e.sent,new Error("Failed to fetch embedding: ".concat(s));case 13:return e.next=15,u.json();case 15:return a=e.sent,e.abrupt("return",a.data[0].embedding);case 17:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function y(e,t){return v.apply(this,arguments)}function v(){return v=f(c().mark((function e(t,n){var r,o,i,a,l,f,d,p,m,y,v=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>2&&void 0!==v[2]?v[2]:"gpt-4",o=v.length>3?v[3]:void 0,i=v.length>4&&void 0!==v[4]?v[4]:[],a=v.length>5&&void 0!==v[5]?v[5]:function(){},l=v.length>6&&void 0!==v[6]?v[6]:function(){},f=v.length>7&&void 0!==v[7]?v[7]:function(){},d=v.length>8&&void 0!==v[8]?v[8]:function(){},p=h()){e.next=10;break}return e.abrupt("return");case 10:return m={messages:t,model:r,max_tokens:o,temperature:n,stream:!0},i.length>0&&(m.tools=i.map((function(e){return{type:"function",function:e}})),m.tool_choice="auto"),(y=p.beta.chat.completions.stream(m)).on("content",(function(e,t){a(t)})),y.on("chatCompletion",(function(e){var t=e.choices[0].message,n=e.choices[0].finish_reason;t.content&&t.content.length>0&&("length"===n?d(t.content):f(t.content)),t.function_call&&l({name:t.function_call.name,parameters:u().parse(t.function_call.arguments),uuid:(0,s.Z)()}),t.tool_calls&&t.tool_calls.forEach((function(e){l({name:e.function.name,parameters:u().parse(e.function.arguments),id:e.id,uuid:(0,s.Z)()})}))})),e.next=17,y.done();case 17:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}},64211:(e,t,n)=>{"use strict";function r(e){return e.length>0}function o(e){var t=e[e.length-1];return[e.slice(0,-1),t]}function i(e){if(!r(e))throw new Error("Impossible code path");return e}function u(e){return Boolean(e)}n.d(t,{A1:()=>r,Al:()=>i,fQ:()=>u,kb:()=>o})},51039:function(e,t,n){!function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=r(n);function i(e,t,n){var r,i;"function"==typeof e?(r=t||[],i=n):(r=[],i=t);var u=o.default.useRef({hasResult:!1,result:i,error:null}),s=o.default.useReducer((function(e){return e+1}),0);s[0];var a=s[1],c=o.default.useMemo((function(){var t="function"==typeof e?e():e;if(!t||"function"!=typeof t.subscribe)throw e===t?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!u.current.hasResult&&"undefined"!=typeof window&&("function"!=typeof t.hasValue||t.hasValue()))if("function"==typeof t.getValue)u.current.result=t.getValue(),u.current.hasResult=!0;else{var n=t.subscribe((function(e){u.current.result=e,u.current.hasResult=!0}));"function"==typeof n?n():n.unsubscribe()}return t}),r);if(o.default.useDebugValue(u.current.result),o.default.useEffect((function(){var e=c.subscribe((function(e){var t=u.current;null===t.error&&t.result===e||(t.error=null,t.result=e,t.hasResult=!0,a())}),(function(e){var t=u.current;t.error!==e&&(t.error=e,a())}));return"function"==typeof e?e:e.unsubscribe.bind(e)}),r),u.current.error)throw u.current.error;return u.current.result}e.useLiveQuery=function(e,n,r){return i((function(){return t.liveQuery(e)}),n||[],r)},e.useObservable=i,e.usePermissions=function(e,n,r){if(!e)throw new TypeError("Invalid arguments to usePermissions(): undefined or null");var o;if(arguments.length>=3){if(!("transaction"in e))throw new TypeError("Invalid arguments to usePermission(db, table, obj): 1st arg must be a Dexie instance");if("string"!=typeof n)throw new TypeError("Invalid arguments to usePermission(db, table, obj): 2nd arg must be string");if(!r||"object"!=typeof r)throw new TypeError("Invalid arguments to usePermission(db, table, obj): 3rd arg must be an object");o=e}else{if(e instanceof t.Dexie)throw new TypeError("Invalid arguments to usePermission(db, table, obj): Missing table and obj arguments.");if("function"!=typeof e.table||"object"!=typeof e.db)throw new TypeError("Invalid arguments to usePermissions(). Expected usePermissions(entity: DexieCloudEntity) or usePermissions(db: Dexie, table: string, obj: DexieCloudObject)");o=e.db,r=e,n=e.table()}if(!("cloud"in o))throw new Error("usePermissions() is only for Dexie Cloud but there's no dexie-cloud-addon active in given db.");if(!("permissions"in o.cloud))throw new Error("usePermissions() requires a newer version of dexie-cloud-addon. Please upgrade it.");return i((function(){return o.cloud.permissions(r,n)}),[r.realmId,r.owner,n])},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(49520),n(67294))},11142:function(e){e.exports=function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}var t=e((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),n=e((function(e){var t=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=t)})),r=(n.version,function(e){return"object"==typeof e?null!==e:"function"==typeof e}),o=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e},i=function(e){try{return!!e()}catch(e){return!0}},u=!i((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),s=t.document,a=r(s)&&r(s.createElement),c=!u&&!i((function(){return 7!=Object.defineProperty((e="div",a?s.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),l=Object.defineProperty,f={f:u?Object.defineProperty:function(e,t,n){if(o(e),t=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}(t,!0),o(n),c)try{return l(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},h=u?function(e,t,n){return f.f(e,t,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}(1,n))}:function(e,t,n){return e[t]=n,e},d={}.hasOwnProperty,p=function(e,t){return d.call(e,t)},m=0,y=Math.random(),v=e((function(e){var r="__core-js_shared__",o=t[r]||(t[r]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),b=v("native-function-to-string",Function.toString),g=e((function(e){var r=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++m+y).toString(36))}("src"),o="toString",i=(""+b).split(o);n.inspectSource=function(e){return b.call(e)},(e.exports=function(e,n,o,u){var s="function"==typeof o;s&&(p(o,"name")||h(o,"name",n)),e[n]!==o&&(s&&(p(o,r)||h(o,r,e[n]?""+e[n]:i.join(String(n)))),e===t?e[n]=o:u?e[n]?e[n]=o:h(e,n,o):(delete e[n],h(e,n,o)))})(Function.prototype,o,(function(){return"function"==typeof this&&this[r]||b.call(this)}))})),w=function(e,t,n){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},D="prototype",E=function(e,r,o){var i,u,s,a,c=e&E.F,l=e&E.G,f=e&E.S,d=e&E.P,p=e&E.B,m=l?t:f?t[r]||(t[r]={}):(t[r]||{})[D],y=l?n:n[r]||(n[r]={}),v=y[D]||(y[D]={});for(i in l&&(o=r),o)s=((u=!c&&m&&void 0!==m[i])?m:o)[i],a=p&&u?w(s,t):d&&"function"==typeof s?w(Function.call,s):s,m&&g(m,i,s,e&E.U),y[i]!=s&&h(y,i,a),d&&v[i]!=s&&(v[i]=s)};t.core=n,E.F=1,E.G=2,E.S=4,E.P=8,E.B=16,E.W=32,E.U=64,E.R=128;var _=E,x=Math.ceil,A=Math.floor,C=function(e){return isNaN(e=+e)?0:(e>0?A:x)(e)},F=(!1,function(e,t){var n,r,o=String(function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}(e)),i=C(t),u=o.length;return i<0||i>=u?void 0:(n=o.charCodeAt(i))<55296||n>56319||i+1===u||(r=o.charCodeAt(i+1))<56320||r>57343?n:r-56320+(n-55296<<10)+65536});_(_.P,"String",{codePointAt:function(e){return F(this,e)}}),n.String.codePointAt;var S=Math.max,O=Math.min,k=String.fromCharCode,B=String.fromCodePoint;_(_.S+_.F*(!!B&&1!=B.length),"String",{fromCodePoint:function(e){for(var t,n=arguments,r=[],o=arguments.length,i=0;o>i;){if(t=+n[i++],s=1114111,((u=C(u=t))<0?S(u+s,0):O(u,s))!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?k(t):k(55296+((t-=65536)>>10),t%1024+56320))}var u,s;return r.join("")}}),n.String.fromCodePoint;var P,j,I,T,R,L,M,N,q,K,U,$,H,G,X={Space_Separator:/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ID_Start:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ID_Continue:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},z={isSpaceSeparator:function(e){return"string"==typeof e&&X.Space_Separator.test(e)},isIdStartChar:function(e){return"string"==typeof e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||"$"===e||"_"===e||X.ID_Start.test(e))},isIdContinueChar:function(e){return"string"==typeof e&&(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"$"===e||"_"===e||"‌"===e||"‍"===e||X.ID_Continue.test(e))},isDigit:function(e){return"string"==typeof e&&/[0-9]/.test(e)},isHexDigit:function(e){return"string"==typeof e&&/[0-9A-Fa-f]/.test(e)}};function W(e,t,n){var r=e[t];if(null!=r&&"object"==typeof r)if(Array.isArray(r))for(var o=0;o<r.length;o++){var i=String(o),u=W(r,i,n);void 0===u?delete r[i]:Object.defineProperty(r,i,{value:u,writable:!0,enumerable:!0,configurable:!0})}else for(var s in r){var a=W(r,s,n);void 0===a?delete r[s]:Object.defineProperty(r,s,{value:a,writable:!0,enumerable:!0,configurable:!0})}return n.call(e,t,r)}function V(){for(K="default",U="",$=!1,H=1;;){G=J();var e=Y[K]();if(e)return e}}function J(){if(P[T])return String.fromCodePoint(P.codePointAt(T))}function Z(){var e=J();return"\n"===e?(R++,L=0):e?L+=e.length:L++,e&&(T+=e.length),e}var Y={default:function(){switch(G){case"\t":case"\v":case"\f":case" ":case" ":case"\ufeff":case"\n":case"\r":case"\u2028":case"\u2029":return void Z();case"/":return Z(),void(K="comment");case void 0:return Z(),Q("eof")}if(!z.isSpaceSeparator(G))return Y[j]();Z()},comment:function(){switch(G){case"*":return Z(),void(K="multiLineComment");case"/":return Z(),void(K="singleLineComment")}throw ie(Z())},multiLineComment:function(){switch(G){case"*":return Z(),void(K="multiLineCommentAsterisk");case void 0:throw ie(Z())}Z()},multiLineCommentAsterisk:function(){switch(G){case"*":return void Z();case"/":return Z(),void(K="default");case void 0:throw ie(Z())}Z(),K="multiLineComment"},singleLineComment:function(){switch(G){case"\n":case"\r":case"\u2028":case"\u2029":return Z(),void(K="default");case void 0:return Z(),Q("eof")}Z()},value:function(){switch(G){case"{":case"[":return Q("punctuator",Z());case"n":return Z(),ee("ull"),Q("null",null);case"t":return Z(),ee("rue"),Q("boolean",!0);case"f":return Z(),ee("alse"),Q("boolean",!1);case"-":case"+":return"-"===Z()&&(H=-1),void(K="sign");case".":return U=Z(),void(K="decimalPointLeading");case"0":return U=Z(),void(K="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return U=Z(),void(K="decimalInteger");case"I":return Z(),ee("nfinity"),Q("numeric",1/0);case"N":return Z(),ee("aN"),Q("numeric",NaN);case'"':case"'":return $='"'===Z(),U="",void(K="string")}throw ie(Z())},identifierNameStartEscape:function(){if("u"!==G)throw ie(Z());Z();var e=te();switch(e){case"$":case"_":break;default:if(!z.isIdStartChar(e))throw se()}U+=e,K="identifierName"},identifierName:function(){switch(G){case"$":case"_":case"‌":case"‍":return void(U+=Z());case"\\":return Z(),void(K="identifierNameEscape")}if(!z.isIdContinueChar(G))return Q("identifier",U);U+=Z()},identifierNameEscape:function(){if("u"!==G)throw ie(Z());Z();var e=te();switch(e){case"$":case"_":case"‌":case"‍":break;default:if(!z.isIdContinueChar(e))throw se()}U+=e,K="identifierName"},sign:function(){switch(G){case".":return U=Z(),void(K="decimalPointLeading");case"0":return U=Z(),void(K="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return U=Z(),void(K="decimalInteger");case"I":return Z(),ee("nfinity"),Q("numeric",H*(1/0));case"N":return Z(),ee("aN"),Q("numeric",NaN)}throw ie(Z())},zero:function(){switch(G){case".":return U+=Z(),void(K="decimalPoint");case"e":case"E":return U+=Z(),void(K="decimalExponent");case"x":case"X":return U+=Z(),void(K="hexadecimal")}return Q("numeric",0*H)},decimalInteger:function(){switch(G){case".":return U+=Z(),void(K="decimalPoint");case"e":case"E":return U+=Z(),void(K="decimalExponent")}if(!z.isDigit(G))return Q("numeric",H*Number(U));U+=Z()},decimalPointLeading:function(){if(z.isDigit(G))return U+=Z(),void(K="decimalFraction");throw ie(Z())},decimalPoint:function(){switch(G){case"e":case"E":return U+=Z(),void(K="decimalExponent")}return z.isDigit(G)?(U+=Z(),void(K="decimalFraction")):Q("numeric",H*Number(U))},decimalFraction:function(){switch(G){case"e":case"E":return U+=Z(),void(K="decimalExponent")}if(!z.isDigit(G))return Q("numeric",H*Number(U));U+=Z()},decimalExponent:function(){switch(G){case"+":case"-":return U+=Z(),void(K="decimalExponentSign")}if(z.isDigit(G))return U+=Z(),void(K="decimalExponentInteger");throw ie(Z())},decimalExponentSign:function(){if(z.isDigit(G))return U+=Z(),void(K="decimalExponentInteger");throw ie(Z())},decimalExponentInteger:function(){if(!z.isDigit(G))return Q("numeric",H*Number(U));U+=Z()},hexadecimal:function(){if(z.isHexDigit(G))return U+=Z(),void(K="hexadecimalInteger");throw ie(Z())},hexadecimalInteger:function(){if(!z.isHexDigit(G))return Q("numeric",H*Number(U));U+=Z()},string:function(){switch(G){case"\\":return Z(),void(U+=function(){switch(J()){case"b":return Z(),"\b";case"f":return Z(),"\f";case"n":return Z(),"\n";case"r":return Z(),"\r";case"t":return Z(),"\t";case"v":return Z(),"\v";case"0":if(Z(),z.isDigit(J()))throw ie(Z());return"\0";case"x":return Z(),function(){var e="",t=J();if(!z.isHexDigit(t))throw ie(Z());if(e+=Z(),t=J(),!z.isHexDigit(t))throw ie(Z());return e+=Z(),String.fromCodePoint(parseInt(e,16))}();case"u":return Z(),te();case"\n":case"\u2028":case"\u2029":return Z(),"";case"\r":return Z(),"\n"===J()&&Z(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case void 0:throw ie(Z())}return Z()}());case'"':return $?(Z(),Q("string",U)):void(U+=Z());case"'":return $?void(U+=Z()):(Z(),Q("string",U));case"\n":case"\r":throw ie(Z());case"\u2028":case"\u2029":!function(e){console.warn("JSON5: '"+ae(e)+"' in strings is not valid ECMAScript; consider escaping")}(G);break;case void 0:throw ie(Z())}U+=Z()},start:function(){switch(G){case"{":case"[":return Q("punctuator",Z())}K="value"},beforePropertyName:function(){switch(G){case"$":case"_":return U=Z(),void(K="identifierName");case"\\":return Z(),void(K="identifierNameStartEscape");case"}":return Q("punctuator",Z());case'"':case"'":return $='"'===Z(),void(K="string")}if(z.isIdStartChar(G))return U+=Z(),void(K="identifierName");throw ie(Z())},afterPropertyName:function(){if(":"===G)return Q("punctuator",Z());throw ie(Z())},beforePropertyValue:function(){K="value"},afterPropertyValue:function(){switch(G){case",":case"}":return Q("punctuator",Z())}throw ie(Z())},beforeArrayValue:function(){if("]"===G)return Q("punctuator",Z());K="value"},afterArrayValue:function(){switch(G){case",":case"]":return Q("punctuator",Z())}throw ie(Z())},end:function(){throw ie(Z())}};function Q(e,t){return{type:e,value:t,line:R,column:L}}function ee(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if(J()!==r)throw ie(Z());Z()}}function te(){for(var e="",t=4;t-- >0;){var n=J();if(!z.isHexDigit(n))throw ie(Z());e+=Z()}return String.fromCodePoint(parseInt(e,16))}var ne={start:function(){if("eof"===M.type)throw ue();re()},beforePropertyName:function(){switch(M.type){case"identifier":case"string":return N=M.value,void(j="afterPropertyName");case"punctuator":return void oe();case"eof":throw ue()}},afterPropertyName:function(){if("eof"===M.type)throw ue();j="beforePropertyValue"},beforePropertyValue:function(){if("eof"===M.type)throw ue();re()},beforeArrayValue:function(){if("eof"===M.type)throw ue();"punctuator"!==M.type||"]"!==M.value?re():oe()},afterPropertyValue:function(){if("eof"===M.type)throw ue();switch(M.value){case",":return void(j="beforePropertyName");case"}":oe()}},afterArrayValue:function(){if("eof"===M.type)throw ue();switch(M.value){case",":return void(j="beforeArrayValue");case"]":oe()}},end:function(){}};function re(){var e;switch(M.type){case"punctuator":switch(M.value){case"{":e={};break;case"[":e=[]}break;case"null":case"boolean":case"numeric":case"string":e=M.value}if(void 0===q)q=e;else{var t=I[I.length-1];Array.isArray(t)?t.push(e):Object.defineProperty(t,N,{value:e,writable:!0,enumerable:!0,configurable:!0})}if(null!==e&&"object"==typeof e)I.push(e),j=Array.isArray(e)?"beforeArrayValue":"beforePropertyName";else{var n=I[I.length-1];j=null==n?"end":Array.isArray(n)?"afterArrayValue":"afterPropertyValue"}}function oe(){I.pop();var e=I[I.length-1];j=null==e?"end":Array.isArray(e)?"afterArrayValue":"afterPropertyValue"}function ie(e){return ce(void 0===e?"JSON5: invalid end of input at "+R+":"+L:"JSON5: invalid character '"+ae(e)+"' at "+R+":"+L)}function ue(){return ce("JSON5: invalid end of input at "+R+":"+L)}function se(){return ce("JSON5: invalid identifier character at "+R+":"+(L-=5))}function ae(e){var t={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(t[e])return t[e];if(e<" "){var n=e.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return e}function ce(e){var t=new SyntaxError(e);return t.lineNumber=R,t.columnNumber=L,t}return{parse:function(e,t){P=String(e),j="start",I=[],T=0,R=1,L=0,M=void 0,N=void 0,q=void 0;do{M=V(),ne[j]()}while("eof"!==M.type);return"function"==typeof t?W({"":q},"",t):q},stringify:function(e,t,n){var r,o,i,u=[],s="",a="";if(null==t||"object"!=typeof t||Array.isArray(t)||(n=t.space,i=t.quote,t=t.replacer),"function"==typeof t)o=t;else if(Array.isArray(t)){r=[];for(var c=0,l=t;c<l.length;c+=1){var f=l[c],h=void 0;"string"==typeof f?h=f:("number"==typeof f||f instanceof String||f instanceof Number)&&(h=String(f)),void 0!==h&&r.indexOf(h)<0&&r.push(h)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),"number"==typeof n?n>0&&(n=Math.min(10,Math.floor(n)),a="          ".substr(0,n)):"string"==typeof n&&(a=n.substr(0,10)),d("",{"":e});function d(e,t){var n=t[e];switch(null!=n&&("function"==typeof n.toJSON5?n=n.toJSON5(e):"function"==typeof n.toJSON&&(n=n.toJSON(e))),o&&(n=o.call(t,e,n)),n instanceof Number?n=Number(n):n instanceof String?n=String(n):n instanceof Boolean&&(n=n.valueOf()),n){case null:return"null";case!0:return"true";case!1:return"false"}return"string"==typeof n?p(n):"number"==typeof n?String(n):"object"==typeof n?Array.isArray(n)?function(e){if(u.indexOf(e)>=0)throw TypeError("Converting circular structure to JSON5");u.push(e);var t=s;s+=a;for(var n,r=[],o=0;o<e.length;o++){var i=d(String(o),e);r.push(void 0!==i?i:"null")}if(0===r.length)n="[]";else if(""===a)n="["+r.join(",")+"]";else{var c=",\n"+s,l=r.join(c);n="[\n"+s+l+",\n"+t+"]"}return u.pop(),s=t,n}(n):function(e){if(u.indexOf(e)>=0)throw TypeError("Converting circular structure to JSON5");u.push(e);var t=s;s+=a;for(var n,o,i=[],c=0,l=r||Object.keys(e);c<l.length;c+=1){var f=l[c],h=d(f,e);if(void 0!==h){var p=m(f)+":";""!==a&&(p+=" "),p+=h,i.push(p)}}if(0===i.length)n="{}";else if(""===a)n="{"+(o=i.join(","))+"}";else{var y=",\n"+s;o=i.join(y),n="{\n"+s+o+",\n"+t+"}"}return u.pop(),s=t,n}(n):void 0}function p(e){for(var t={"'":.1,'"':.2},n={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},r="",o=0;o<e.length;o++){var u=e[o];switch(u){case"'":case'"':t[u]++,r+=u;continue;case"\0":if(z.isDigit(e[o+1])){r+="\\x00";continue}}if(n[u])r+=n[u];else if(u<" "){var s=u.charCodeAt(0).toString(16);r+="\\x"+("00"+s).substring(s.length)}else r+=u}var a=i||Object.keys(t).reduce((function(e,n){return t[e]<t[n]?e:n}));return a+(r=r.replace(new RegExp(a,"g"),n[a]))+a}function m(e){if(0===e.length)return p(e);var t=String.fromCodePoint(e.codePointAt(0));if(!z.isIdStartChar(t))return p(e);for(var n=t.length;n<e.length;n++)if(!z.isIdContinueChar(String.fromCodePoint(e.codePointAt(n))))return p(e);return e}}}}()},72408:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),d=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||p}function b(){}function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var w=g.prototype=new b;w.constructor=g,m(w,v.prototype),w.isPureReactComponent=!0;var D=Array.isArray,E=Object.prototype.hasOwnProperty,_={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,r){var o,i={},u=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(u=""+t.key),t)E.call(t,o)&&!x.hasOwnProperty(o)&&(i[o]=t[o]);var a=arguments.length-2;if(1===a)i.children=r;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(o in a=e.defaultProps)void 0===i[o]&&(i[o]=a[o]);return{$$typeof:n,type:e,key:u,ref:s,props:i,_owner:_.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var F=/\/+/g;function S(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,o,i,u){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var a=!1;if(null===e)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case n:case r:a=!0}}if(a)return u=u(a=e),e=""===i?"."+S(a,0):i,D(u)?(o="",null!=e&&(o=e.replace(F,"$&/")+"/"),O(u,t,o,"",(function(e){return e}))):null!=u&&(C(u)&&(u=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(u,o+(!u.key||a&&a.key===u.key?"":(""+u.key).replace(F,"$&/")+"/")+e)),t.push(u)),1;if(a=0,i=""===i?".":i+":",D(e))for(var c=0;c<e.length;c++){var l=i+S(s=e[c],c);a+=O(s,t,o,l,u)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)a+=O(s=s.value,t,o,l=i+S(s,c++),u);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function k(e,t,n){if(null==e)return e;var r=[],o=0;return O(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function B(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},j={transition:null},I={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:j,ReactCurrentOwner:_};t.Children={map:k,forEach:function(e,t,n){k(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return k(e,(function(){t++})),t},toArray:function(e){return k(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=o,t.Profiler=u,t.PureComponent=g,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),i=e.key,u=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(u=t.ref,s=_.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)E.call(t,c)&&!x.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==a?a[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];o.children=a}return{$$typeof:n,type:e.type,key:i,ref:u,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:B}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=j.transition;j.transition={};try{e()}finally{j.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},67294:(e,t,n)=>{"use strict";e.exports=n(72408)},72107:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ArgumentOutOfRangeError:()=>ce,AsyncSubject:()=>D,BehaviorSubject:()=>b.X,ConnectableObservable:()=>c,EMPTY:()=>V.E,EmptyError:()=>ie.K,NEVER:()=>it,NotFoundError:()=>le,Notification:()=>Q,NotificationKind:()=>O,ObjectUnsubscribedError:()=>fe.N,Observable:()=>r.y,ReplaySubject:()=>w,Scheduler:()=>I,SequenceError:()=>he,Subject:()=>v.x,Subscriber:()=>W.Lv,Subscription:()=>i.w0,TimeoutError:()=>ye,UnsubscriptionError:()=>ge.B,VirtualAction:()=>z,VirtualTimeScheduler:()=>X,animationFrame:()=>G,animationFrameScheduler:()=>H,animationFrames:()=>d,asap:()=>L,asapScheduler:()=>R,async:()=>N,asyncScheduler:()=>M,audit:()=>Dt,auditTime:()=>Et,bindCallback:()=>Fe,bindNodeCallback:()=>Se,buffer:()=>_t,bufferCount:()=>xt,bufferTime:()=>At,bufferToggle:()=>Ct,bufferWhen:()=>Ft,catchError:()=>St.K,combineAll:()=>Pt,combineLatest:()=>Le,combineLatestAll:()=>Bt,combineLatestWith:()=>It,concat:()=>qe.z,concatAll:()=>Tt.u,concatMap:()=>Rt.b,concatMapTo:()=>Lt,concatWith:()=>Nt,config:()=>wt.v,connect:()=>Kt,connectable:()=>$e,count:()=>$t,debounce:()=>Ht,debounceTime:()=>Gt,defaultIfEmpty:()=>Xt,defer:()=>Ke.P,delay:()=>Zt,delayWhen:()=>Jt,dematerialize:()=>Yt,distinct:()=>Qt,distinctUntilChanged:()=>en.x,distinctUntilKeyChanged:()=>tn,elementAt:()=>on,empty:()=>V.c,endWith:()=>un,every:()=>sn,exhaust:()=>ln,exhaustAll:()=>cn,exhaustMap:()=>an,expand:()=>hn,filter:()=>ht.h,finalize:()=>dn.x,find:()=>pn,findIndex:()=>yn,first:()=>vn,firstValueFrom:()=>se.z,flatMap:()=>An,forkJoin:()=>He,from:()=>Ie.D,fromEvent:()=>Je,fromEventPattern:()=>Ye,generate:()=>et,groupBy:()=>bn,identity:()=>re.y,ignoreElements:()=>Wt,iif:()=>tt,interval:()=>rt,isEmpty:()=>gn,isObservable:()=>oe.b,last:()=>Dn,lastValueFrom:()=>ue,map:()=>Ee.U,mapTo:()=>Vt,materialize:()=>En,max:()=>_n,merge:()=>ot.T,mergeAll:()=>xn.J,mergeMap:()=>Ge.z,mergeMapTo:()=>Cn,mergeScan:()=>Fn,mergeWith:()=>On,min:()=>kn,multicast:()=>Bn,never:()=>ut,noop:()=>ne.Z,observable:()=>l.L,observeOn:()=>Ae.Q,of:()=>J.of,onErrorResumeNext:()=>ct,onErrorResumeNextWith:()=>Pn,pairs:()=>lt,pairwise:()=>jn,partition:()=>dt,pipe:()=>te.z,pluck:()=>In,publish:()=>Tn,publishBehavior:()=>Rn,publishLast:()=>Ln,publishReplay:()=>Mn,queue:()=>U,queueScheduler:()=>K,race:()=>pt,raceWith:()=>Nn,range:()=>yt,reduce:()=>Ut.u,refCount:()=>a,repeat:()=>qn,repeatWhen:()=>Kn,retry:()=>Un,retryWhen:()=>$n,sample:()=>Hn,sampleTime:()=>Gn,scan:()=>Xn.R,scheduled:()=>gt.x,sequenceEqual:()=>zn,share:()=>Wn.B,shareReplay:()=>Vn,single:()=>Jn,skip:()=>Zn,skipLast:()=>Yn,skipUntil:()=>Qn,skipWhile:()=>er,startWith:()=>tr,subscribeOn:()=>De.R,switchAll:()=>rr,switchMap:()=>nr.w,switchMapTo:()=>or,switchScan:()=>ir,take:()=>zt,takeLast:()=>wn,takeUntil:()=>ur,takeWhile:()=>sr,tap:()=>ar,throttle:()=>cr,throttleTime:()=>lr,throwError:()=>Z._,throwIfEmpty:()=>nn,timeInterval:()=>fr,timeout:()=>ve,timeoutWith:()=>dr,timer:()=>nt,timestamp:()=>pr,toArray:()=>Ot.q,using:()=>vt,window:()=>mr,windowCount:()=>yr,windowTime:()=>vr,windowToggle:()=>br,windowWhen:()=>gr,withLatestFrom:()=>wr,zip:()=>bt,zipAll:()=>Dr,zipWith:()=>_r});var r=n(80230),o=n(97582),i=n(70204),u=n(96798),s=n(2566);function a(){return(0,u.e)((function(e,t){var n=null;e._refCount++;var r=(0,s.x)(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,o=n;n=null,!r||o&&r!==o||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(n=e.connect())}))}var c=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._subject=null,r._refCount=0,r._connection=null,(0,u.A)(t)&&(r.lift=t.lift),r}return(0,o.ZT)(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new i.w0;var n=this.getSubject();t.add(this.source.subscribe((0,s.x)(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=i.w0.EMPTY)}return t},t.prototype.refCount=function(){return a()(this)},t}(r.y),l=n(46766),f={now:function(){return(f.delegate||performance).now()},delegate:void 0},h={schedule:function(e){var t=requestAnimationFrame,n=cancelAnimationFrame,r=h.delegate;r&&(t=r.requestAnimationFrame,n=r.cancelAnimationFrame);var o=t((function(t){n=void 0,e(t)}));return new i.w0((function(){return null==n?void 0:n(o)}))},requestAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=h.delegate;return((null==n?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,(0,o.ev)([],(0,o.CR)(e)))},cancelAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=h.delegate;return((null==n?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,(0,o.ev)([],(0,o.CR)(e)))},delegate:void 0};function d(e){return e?p(e):y}function p(e){return new r.y((function(t){var n=e||f,r=n.now(),o=0,i=function(){t.closed||(o=h.requestAnimationFrame((function(u){o=0;var s=n.now();t.next({timestamp:e?s:u,elapsed:s-r}),i()})))};return i(),function(){o&&h.cancelAnimationFrame(o)}}))}var m,y=p(),v=n(9248),b=n(86515),g={now:function(){return(g.delegate||Date).now()},delegate:void 0},w=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=g);var o=e.call(this)||this;return o._bufferSize=t,o._windowTime=n,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,n),o}return(0,o.ZT)(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,o=n._buffer,i=n._infiniteTimeWindow,u=n._timestampProvider,s=n._windowTime;r||(o.push(t),!i&&o.push(u.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=n?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,o=e._infiniteTimeWindow,i=(o?1:2)*t;if(t<1/0&&i<r.length&&r.splice(0,r.length-i),!o){for(var u=n.now(),s=0,a=1;a<r.length&&r[a]<=u;a+=2)s=a;s&&r.splice(0,s+1)}},t}(v.x),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return(0,o.ZT)(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t._hasValue,o=t._value,i=t.thrownError,u=t.isStopped,s=t._isComplete;n?e.error(i):(u||s)&&(r&&e.next(o),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this,n=t._hasValue,r=t._value;t._isComplete||(this._isComplete=!0,n&&e.prototype.next.call(this,r),e.prototype.complete.call(this))},t}(v.x),E=function(e){function t(t,n){return e.call(this)||this}return(0,o.ZT)(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(i.w0),_={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=_.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,(0,o.ev)([e,t],(0,o.CR)(n))):setInterval.apply(void 0,(0,o.ev)([e,t],(0,o.CR)(n)))},clearInterval:function(e){var t=_.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},x=n(3699),A=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return(0,o.ZT)(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(o,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),_.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&_.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,(0,x.P)(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(E),C=1,F={};function S(e){return e in F&&(delete F[e],!0)}var O,k=function(e){var t=C++;return F[t]=!0,m||(m=Promise.resolve()),m.then((function(){return S(t)&&e()})),t},B=function(e){S(e)},P={setImmediate:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=P.delegate;return((null==n?void 0:n.setImmediate)||k).apply(void 0,(0,o.ev)([],(0,o.CR)(e)))},clearImmediate:function(e){var t=P.delegate;return((null==t?void 0:t.clearImmediate)||B)(e)},delegate:void 0},j=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return(0,o.ZT)(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=P.setImmediate(t.flush.bind(t,void 0))))},t.prototype.recycleAsyncId=function(t,n,r){var o;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var i=t.actions;null!=n&&(null===(o=i[i.length-1])||void 0===o?void 0:o.id)!==n&&(P.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},t}(A),I=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=g.now,e}(),T=function(e){function t(t,n){void 0===n&&(n=I.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return(0,o.ZT)(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(I),R=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(T))(j),L=R,M=new T(A),N=M,q=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return(0,o.ZT)(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!=r&&r>0||null==r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.flush(this),0)},t}(A),K=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t}(T))(q),U=K,$=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return(0,o.ZT)(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=h.requestAnimationFrame((function(){return t.flush(void 0)}))))},t.prototype.recycleAsyncId=function(t,n,r){var o;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var i=t.actions;null!=n&&(null===(o=i[i.length-1])||void 0===o?void 0:o.id)!==n&&(h.cancelAnimationFrame(n),t._scheduled=void 0)},t}(A),H=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(T))($),G=H,X=function(e){function t(t,n){void 0===t&&(t=z),void 0===n&&(n=1/0);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return(0,o.ZT)(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(T),z=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var o=e.call(this,t,n)||this;return o.scheduler=t,o.work=n,o.index=r,o.active=!0,o.index=t.index=r,o}return(0,o.ZT)(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),Number.isFinite(r)){if(!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var o=new t(this.scheduler,this.work);return this.add(o),o.schedule(n,r)}return i.w0.EMPTY},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var o=e.actions;return o.push(this),o.sort(t.sortActions),1},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(A),W=n(43652),V=n(1545),J=n(32817),Z=n(83610),Y=n(58474);!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(O||(O={}));var Q=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){return ee(this,e)},e.prototype.do=function(e,t,n){var r=this,o=r.kind,i=r.value,u=r.error;return"N"===o?null==e?void 0:e(i):"E"===o?null==t?void 0:t(u):null==n?void 0:n()},e.prototype.accept=function(e,t,n){var r;return(0,Y.m)(null===(r=e)||void 0===r?void 0:r.next)?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e=this,t=e.kind,n=e.value,r=e.error,o="N"===t?(0,J.of)(n):"E"===t?(0,Z._)((function(){return r})):"C"===t?V.E:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},e.createNext=function(t){return new e("N",t)},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e}();function ee(e,t){var n,r,o,i=e,u=i.kind,s=i.value,a=i.error;if("string"!=typeof u)throw new TypeError('Invalid notification, missing "kind"');"N"===u?null===(n=t.next)||void 0===n||n.call(t,s):"E"===u?null===(r=t.error)||void 0===r||r.call(t,a):null===(o=t.complete)||void 0===o||o.call(t)}var te=n(92749),ne=n(22967),re=n(90278),oe=n(9141),ie=n(18084);function ue(e,t){var n="object"==typeof t;return new Promise((function(r,o){var i,u=!1;e.subscribe({next:function(e){i=e,u=!0},error:o,complete:function(){u?r(i):n?r(t.defaultValue):o(new ie.K)}})}))}var se=n(1718),ae=n(1819),ce=(0,ae.d)((function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}})),le=(0,ae.d)((function(e){return function(t){e(this),this.name="NotFoundError",this.message=t}})),fe=n(9825),he=(0,ae.d)((function(e){return function(t){e(this),this.name="SequenceError",this.message=t}}));function de(e){return e instanceof Date&&!isNaN(e)}var pe=n(87878),me=n(47845),ye=(0,ae.d)((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function ve(e,t){var n=de(e)?{first:e}:"number"==typeof e?{each:e}:e,r=n.first,o=n.each,i=n.with,a=void 0===i?be:i,c=n.scheduler,l=void 0===c?null!=t?t:M:c,f=n.meta,h=void 0===f?null:f;if(null==r&&null==o)throw new TypeError("No timeout provided.");return(0,u.e)((function(e,t){var n,i,u=null,c=0,f=function(e){i=(0,me.f)(t,l,(function(){try{n.unsubscribe(),(0,pe.Xf)(a({meta:h,lastValue:u,seen:c})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe((0,s.x)(t,(function(e){null==i||i.unsubscribe(),c++,t.next(u=e),o>0&&f(o)}),void 0,void 0,(function(){(null==i?void 0:i.closed)||null==i||i.unsubscribe(),u=null}))),!c&&f(null!=r?"number"==typeof r?r:+r-l.now():o)}))}function be(e){throw new ye(e)}var ge=n(25948),we=n(64865),De=n(58720),Ee=n(29127),_e=Array.isArray;function xe(e){return(0,Ee.U)((function(t){return function(e,t){return _e(t)?e.apply(void 0,(0,o.ev)([],(0,o.CR)(t))):e(t)}(e,t)}))}var Ae=n(29526);function Ce(e,t,n,i){if(n){if(!(0,we.K)(n))return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return Ce(e,t,i).apply(this,r).pipe(xe(n))};i=n}return i?function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Ce(e,t).apply(this,n).pipe((0,De.R)(i),(0,Ae.Q)(i))}:function(){for(var n=this,i=[],u=0;u<arguments.length;u++)i[u]=arguments[u];var s=new D,a=!0;return new r.y((function(r){var u=s.subscribe(r);if(a){a=!1;var c=!1,l=!1;t.apply(n,(0,o.ev)((0,o.ev)([],(0,o.CR)(i)),[function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e){var r=t.shift();if(null!=r)return void s.error(r)}s.next(1<t.length?t:t[0]),l=!0,c&&s.complete()}])),l&&s.complete(),c=!0}return u}))}}function Fe(e,t,n){return Ce(!1,e,t,n)}function Se(e,t,n){return Ce(!0,e,t,n)}var Oe=Array.isArray,ke=Object.getPrototypeOf,Be=Object.prototype,Pe=Object.keys;function je(e){if(1===e.length){var t=e[0];if(Oe(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&ke(r)===Be){var n=Pe(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}var Ie=n(40052),Te=n(22457);function Re(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}function Le(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.yG)(e),o=(0,Te.jO)(e),i=je(e),u=i.args,s=i.keys;if(0===u.length)return(0,Ie.D)([],n);var a=new r.y(Me(u,n,s?function(e){return Re(s,e)}:re.y));return o?a.pipe(xe(o)):a}function Me(e,t,n){return void 0===n&&(n=re.y),function(r){Ne(t,(function(){for(var o=e.length,i=new Array(o),u=o,a=o,c=function(o){Ne(t,(function(){var c=(0,Ie.D)(e[o],t),l=!1;c.subscribe((0,s.x)(r,(function(e){i[o]=e,l||(l=!0,a--),a||r.next(n(i.slice()))}),(function(){--u||r.complete()})))}),r)},l=0;l<o;l++)c(l)}),r)}}function Ne(e,t,n){e?(0,me.f)(n,e,t):t()}var qe=n(26362),Ke=n(19917),Ue={connector:function(){return new v.x},resetOnDisconnect:!0};function $e(e,t){void 0===t&&(t=Ue);var n=null,o=t.connector,i=t.resetOnDisconnect,u=void 0===i||i,s=o(),a=new r.y((function(e){return s.subscribe(e)}));return a.connect=function(){return n&&!n.closed||(n=(0,Ke.P)((function(){return e})).subscribe(s),u&&n.add((function(){return s=o()}))),n},a}function He(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.jO)(e),o=je(e),i=o.args,u=o.keys,a=new r.y((function(e){var t=i.length;if(t)for(var n=new Array(t),r=t,o=t,a=function(t){var a=!1;(0,pe.Xf)(i[t]).subscribe((0,s.x)(e,(function(e){a||(a=!0,o--),n[t]=e}),(function(){return r--}),void 0,(function(){r&&a||(o||e.next(u?Re(u,n):n),e.complete())})))},c=0;c<t;c++)a(c);else e.complete()}));return n?a.pipe(xe(n)):a}var Ge=n(43994),Xe=n(45685),ze=["addListener","removeListener"],We=["addEventListener","removeEventListener"],Ve=["on","off"];function Je(e,t,n,i){if((0,Y.m)(n)&&(i=n,n=void 0),i)return Je(e,t,n).pipe(xe(i));var u=(0,o.CR)(function(e){return(0,Y.m)(e.addEventListener)&&(0,Y.m)(e.removeEventListener)}(e)?We.map((function(r){return function(o){return e[r](t,o,n)}})):function(e){return(0,Y.m)(e.addListener)&&(0,Y.m)(e.removeListener)}(e)?ze.map(Ze(e,t)):function(e){return(0,Y.m)(e.on)&&(0,Y.m)(e.off)}(e)?Ve.map(Ze(e,t)):[],2),s=u[0],a=u[1];if(!s&&(0,Xe.z)(e))return(0,Ge.z)((function(e){return Je(e,t,n)}))((0,pe.Xf)(e));if(!s)throw new TypeError("Invalid event target");return new r.y((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return s(t),function(){return a(t)}}))}function Ze(e,t){return function(n){return function(r){return e[n](t,r)}}}function Ye(e,t,n){return n?Ye(e,t).pipe(xe(n)):new r.y((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)},o=e(r);return(0,Y.m)(t)?function(){return t(r,o)}:void 0}))}var Qe=n(18077);function et(e,t,n,r,i){var u,s,a,c;function l(){var e;return(0,o.Jh)(this,(function(r){switch(r.label){case 0:e=c,r.label=1;case 1:return t&&!t(e)?[3,4]:[4,a(e)];case 2:r.sent(),r.label=3;case 3:return e=n(e),[3,1];case 4:return[2]}}))}return 1===arguments.length?(c=(u=e).initialState,t=u.condition,n=u.iterate,s=u.resultSelector,a=void 0===s?re.y:s,i=u.scheduler):(c=e,!r||(0,we.K)(r)?(a=re.y,i=r):a=r),(0,Ke.P)(i?function(){return(0,Qe.Q)(l(),i)}:l)}function tt(e,t,n){return(0,Ke.P)((function(){return e()?t:n}))}function nt(e,t,n){void 0===e&&(e=0),void 0===n&&(n=N);var o=-1;return null!=t&&((0,we.K)(t)?n=t:o=t),new r.y((function(t){var r=de(e)?+e-n.now():e;r<0&&(r=0);var i=0;return n.schedule((function(){t.closed||(t.next(i++),0<=o?this.schedule(void 0,o):t.complete())}),r)}))}function rt(e,t){return void 0===e&&(e=0),void 0===t&&(t=M),e<0&&(e=0),nt(e,e,t)}var ot=n(23071),it=new r.y(ne.Z);function ut(){return it}var st=Array.isArray;function at(e){return 1===e.length&&st(e[0])?e[0]:e}function ct(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=at(e);return new r.y((function(e){var t=0,r=function(){if(t<n.length){var o=void 0;try{o=(0,pe.Xf)(n[t++])}catch(e){return void r()}var i=new s.Q(e,void 0,ne.Z,ne.Z);o.subscribe(i),i.add(r)}else e.complete()};r()}))}function lt(e,t){return(0,Ie.D)(Object.entries(e),t)}function ft(e,t){return function(n,r){return!e.call(t,n,r)}}var ht=n(94975);function dt(e,t,n){return[(0,ht.h)(t,n)((0,pe.Xf)(e)),(0,ht.h)(ft(t,n))((0,pe.Xf)(e))]}function pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=at(e)).length?(0,pe.Xf)(e[0]):new r.y(mt(e))}function mt(e){return function(t){for(var n=[],r=function(r){n.push((0,pe.Xf)(e[r]).subscribe((0,s.x)(t,(function(e){if(n){for(var o=0;o<n.length;o++)o!==r&&n[o].unsubscribe();n=null}t.next(e)}))))},o=0;n&&!t.closed&&o<e.length;o++)r(o)}}function yt(e,t,n){if(null==t&&(t=e,e=0),t<=0)return V.E;var o=t+e;return new r.y(n?function(t){var r=e;return n.schedule((function(){r<o?(t.next(r++),this.schedule()):t.complete()}))}:function(t){for(var n=e;n<o&&!t.closed;)t.next(n++);t.complete()})}function vt(e,t){return new r.y((function(n){var r=e(),o=t(r);return(o?(0,pe.Xf)(o):V.E).subscribe(n),function(){r&&r.unsubscribe()}}))}function bt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.jO)(e),i=at(e);return i.length?new r.y((function(e){var t=i.map((function(){return[]})),r=i.map((function(){return!1}));e.add((function(){t=r=null}));for(var u=function(u){(0,pe.Xf)(i[u]).subscribe((0,s.x)(e,(function(i){if(t[u].push(i),t.every((function(e){return e.length}))){var s=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,(0,o.ev)([],(0,o.CR)(s))):s),t.some((function(e,t){return!e.length&&r[t]}))&&e.complete()}}),(function(){r[u]=!0,!t[u].length&&e.complete()})))},a=0;!e.closed&&a<i.length;a++)u(a);return function(){t=r=null}})):V.E}var gt=n(44878),wt=n(53912);function Dt(e){return(0,u.e)((function(t,n){var r=!1,o=null,i=null,u=!1,a=function(){if(null==i||i.unsubscribe(),i=null,r){r=!1;var e=o;o=null,n.next(e)}u&&n.complete()},c=function(){i=null,u&&n.complete()};t.subscribe((0,s.x)(n,(function(t){r=!0,o=t,i||(0,pe.Xf)(e(t)).subscribe(i=(0,s.x)(n,a,c))}),(function(){u=!0,(!r||!i||i.closed)&&n.complete()})))}))}function Et(e,t){return void 0===t&&(t=M),Dt((function(){return nt(e,t)}))}function _t(e){return(0,u.e)((function(t,n){var r=[];return t.subscribe((0,s.x)(n,(function(e){return r.push(e)}),(function(){n.next(r),n.complete()}))),(0,pe.Xf)(e).subscribe((0,s.x)(n,(function(){var e=r;r=[],n.next(e)}),ne.Z)),function(){r=null}}))}function xt(e,t){return void 0===t&&(t=null),t=null!=t?t:e,(0,u.e)((function(n,r){var i=[],u=0;n.subscribe((0,s.x)(r,(function(n){var s,a,c,l,f=null;u++%t==0&&i.push([]);try{for(var h=(0,o.XA)(i),d=h.next();!d.done;d=h.next())(y=d.value).push(n),e<=y.length&&(f=null!=f?f:[]).push(y)}catch(e){s={error:e}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(s)throw s.error}}if(f)try{for(var p=(0,o.XA)(f),m=p.next();!m.done;m=p.next()){var y=m.value;(0,x.P)(i,y),r.next(y)}}catch(e){c={error:e}}finally{try{m&&!m.done&&(l=p.return)&&l.call(p)}finally{if(c)throw c.error}}}),(function(){var e,t;try{for(var n=(0,o.XA)(i),u=n.next();!u.done;u=n.next()){var s=u.value;r.next(s)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.complete()}),void 0,(function(){i=null})))}))}function At(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var c=null!==(t=(0,Te.yG)(r))&&void 0!==t?t:M,l=null!==(n=r[0])&&void 0!==n?n:null,f=r[1]||1/0;return(0,u.e)((function(t,n){var r=[],u=!1,a=function(e){var t=e.buffer;e.subs.unsubscribe(),(0,x.P)(r,e),n.next(t),u&&h()},h=function(){if(r){var t=new i.w0;n.add(t);var o={buffer:[],subs:t};r.push(o),(0,me.f)(t,c,(function(){return a(o)}),e)}};null!==l&&l>=0?(0,me.f)(n,c,h,l,!0):u=!0,h();var d=(0,s.x)(n,(function(e){var t,n,i=r.slice();try{for(var u=(0,o.XA)(i),s=u.next();!s.done;s=u.next()){var c=s.value,l=c.buffer;l.push(e),f<=l.length&&a(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}}),(function(){for(;null==r?void 0:r.length;)n.next(r.shift().buffer);null==d||d.unsubscribe(),n.complete(),n.unsubscribe()}),void 0,(function(){return r=null}));t.subscribe(d)}))}function Ct(e,t){return(0,u.e)((function(n,r){var u=[];(0,pe.Xf)(e).subscribe((0,s.x)(r,(function(e){var n=[];u.push(n);var o=new i.w0;o.add((0,pe.Xf)(t(e)).subscribe((0,s.x)(r,(function(){(0,x.P)(u,n),r.next(n),o.unsubscribe()}),ne.Z)))}),ne.Z)),n.subscribe((0,s.x)(r,(function(e){var t,n;try{for(var r=(0,o.XA)(u),i=r.next();!i.done;i=r.next())i.value.push(e)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}),(function(){for(;u.length>0;)r.next(u.shift());r.complete()})))}))}function Ft(e){return(0,u.e)((function(t,n){var r=null,o=null,i=function(){null==o||o.unsubscribe();var t=r;r=[],t&&n.next(t),(0,pe.Xf)(e()).subscribe(o=(0,s.x)(n,i,ne.Z))};i(),t.subscribe((0,s.x)(n,(function(e){return null==r?void 0:r.push(e)}),(function(){r&&n.next(r),n.complete()}),void 0,(function(){return r=o=null})))}))}var St=n(79878),Ot=n(30062);function kt(e,t){return(0,te.z)((0,Ot.q)(),(0,Ge.z)((function(t){return e(t)})),t?xe(t):re.y)}function Bt(e){return kt(Le,e)}var Pt=Bt;function jt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.jO)(e);return n?(0,te.z)(jt.apply(void 0,(0,o.ev)([],(0,o.CR)(e))),xe(n)):(0,u.e)((function(t,n){Me((0,o.ev)([t],(0,o.CR)(at(e))))(n)}))}function It(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jt.apply(void 0,(0,o.ev)([],(0,o.CR)(e)))}var Tt=n(79834),Rt=n(51313);function Lt(e,t){return(0,Y.m)(t)?(0,Rt.b)((function(){return e}),t):(0,Rt.b)((function(){return e}))}function Mt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.yG)(e);return(0,u.e)((function(t,r){(0,Tt.u)()((0,Ie.D)((0,o.ev)([t],(0,o.CR)(e)),n)).subscribe(r)}))}function Nt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Mt.apply(void 0,(0,o.ev)([],(0,o.CR)(e)))}var qt={connector:function(){return new v.x}};function Kt(e,t){void 0===t&&(t=qt);var n=t.connector;return(0,u.e)((function(t,o){var i,u=n();(0,pe.Xf)(e((i=u,new r.y((function(e){return i.subscribe(e)}))))).subscribe(o),o.add(t.subscribe(u))}))}var Ut=n(77270);function $t(e){return(0,Ut.u)((function(t,n,r){return!e||e(n,r)?t+1:t}),0)}function Ht(e){return(0,u.e)((function(t,n){var r=!1,o=null,i=null,u=function(){if(null==i||i.unsubscribe(),i=null,r){r=!1;var e=o;o=null,n.next(e)}};t.subscribe((0,s.x)(n,(function(t){null==i||i.unsubscribe(),r=!0,o=t,i=(0,s.x)(n,u,ne.Z),(0,pe.Xf)(e(t)).subscribe(i)}),(function(){u(),n.complete()}),void 0,(function(){o=i=null})))}))}function Gt(e,t){return void 0===t&&(t=M),(0,u.e)((function(n,r){var o=null,i=null,u=null,a=function(){if(o){o.unsubscribe(),o=null;var e=i;i=null,r.next(e)}};function c(){var n=u+e,i=t.now();if(i<n)return o=this.schedule(void 0,n-i),void r.add(o);a()}n.subscribe((0,s.x)(r,(function(n){i=n,u=t.now(),o||(o=t.schedule(c,e),r.add(o))}),(function(){a(),r.complete()}),void 0,(function(){i=o=null})))}))}function Xt(e){return(0,u.e)((function(t,n){var r=!1;t.subscribe((0,s.x)(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))}function zt(e){return e<=0?function(){return V.E}:(0,u.e)((function(t,n){var r=0;t.subscribe((0,s.x)(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function Wt(){return(0,u.e)((function(e,t){e.subscribe((0,s.x)(t,ne.Z))}))}function Vt(e){return(0,Ee.U)((function(){return e}))}function Jt(e,t){return t?function(n){return(0,qe.z)(t.pipe(zt(1),Wt()),n.pipe(Jt(e)))}:(0,Ge.z)((function(t,n){return(0,pe.Xf)(e(t,n)).pipe(zt(1),Vt(t))}))}function Zt(e,t){void 0===t&&(t=M);var n=nt(e,t);return Jt((function(){return n}))}function Yt(){return(0,u.e)((function(e,t){e.subscribe((0,s.x)(t,(function(e){return ee(e,t)})))}))}function Qt(e,t){return(0,u.e)((function(n,r){var o=new Set;n.subscribe((0,s.x)(r,(function(t){var n=e?e(t):t;o.has(n)||(o.add(n),r.next(t))}))),t&&(0,pe.Xf)(t).subscribe((0,s.x)(r,(function(){return o.clear()}),ne.Z))}))}var en=n(53741);function tn(e,t){return(0,en.x)((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))}function nn(e){return void 0===e&&(e=rn),(0,u.e)((function(t,n){var r=!1;t.subscribe((0,s.x)(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))}function rn(){return new ie.K}function on(e,t){if(e<0)throw new ce;var n=arguments.length>=2;return function(r){return r.pipe((0,ht.h)((function(t,n){return n===e})),zt(1),n?Xt(t):nn((function(){return new ce})))}}function un(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return(0,qe.z)(t,J.of.apply(void 0,(0,o.ev)([],(0,o.CR)(e))))}}function sn(e,t){return(0,u.e)((function(n,r){var o=0;n.subscribe((0,s.x)(r,(function(i){e.call(t,i,o++,n)||(r.next(!1),r.complete())}),(function(){r.next(!0),r.complete()})))}))}function an(e,t){return t?function(n){return n.pipe(an((function(n,r){return(0,pe.Xf)(e(n,r)).pipe((0,Ee.U)((function(e,o){return t(n,e,r,o)})))})))}:(0,u.e)((function(t,n){var r=0,o=null,i=!1;t.subscribe((0,s.x)(n,(function(t){o||(o=(0,s.x)(n,void 0,(function(){o=null,i&&n.complete()})),(0,pe.Xf)(e(t,r++)).subscribe(o))}),(function(){i=!0,!o&&n.complete()})))}))}function cn(){return an(re.y)}var ln=cn,fn=n(29007);function hn(e,t,n){return void 0===t&&(t=1/0),t=(t||0)<1?1/0:t,(0,u.e)((function(r,o){return(0,fn.p)(r,o,e,t,void 0,!0,n)}))}var dn=n(83286);function pn(e,t){return(0,u.e)(mn(e,t,"value"))}function mn(e,t,n){var r="index"===n;return function(n,o){var i=0;n.subscribe((0,s.x)(o,(function(u){var s=i++;e.call(t,u,s,n)&&(o.next(r?s:u),o.complete())}),(function(){o.next(r?-1:void 0),o.complete()})))}}function yn(e,t){return(0,u.e)(mn(e,t,"index"))}function vn(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?(0,ht.h)((function(t,n){return e(t,n,r)})):re.y,zt(1),n?Xt(t):nn((function(){return new ie.K})))}}function bn(e,t,n,o){return(0,u.e)((function(i,u){var a;t&&"function"!=typeof t?(n=t.duration,a=t.element,o=t.connector):a=t;var c=new Map,l=function(e){c.forEach(e),e(u)},f=function(e){return l((function(t){return t.error(e)}))},h=0,d=!1,p=new s.Q(u,(function(t){try{var i=e(t),l=c.get(i);if(!l){c.set(i,l=o?o():new v.x);var m=(b=i,g=l,(w=new r.y((function(e){h++;var t=g.subscribe(e);return function(){t.unsubscribe(),0==--h&&d&&p.unsubscribe()}}))).key=b,w);if(u.next(m),n){var y=(0,s.x)(l,(function(){l.complete(),null==y||y.unsubscribe()}),void 0,void 0,(function(){return c.delete(i)}));p.add((0,pe.Xf)(n(m)).subscribe(y))}}l.next(a?a(t):t)}catch(e){f(e)}var b,g,w}),(function(){return l((function(e){return e.complete()}))}),f,(function(){return c.clear()}),(function(){return d=!0,0===h}));i.subscribe(p)}))}function gn(){return(0,u.e)((function(e,t){e.subscribe((0,s.x)(t,(function(){t.next(!1),t.complete()}),(function(){t.next(!0),t.complete()})))}))}function wn(e){return e<=0?function(){return V.E}:(0,u.e)((function(t,n){var r=[];t.subscribe((0,s.x)(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var i=(0,o.XA)(r),u=i.next();!u.done;u=i.next()){var s=u.value;n.next(s)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))}function Dn(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?(0,ht.h)((function(t,n){return e(t,n,r)})):re.y,wn(1),n?Xt(t):nn((function(){return new ie.K})))}}function En(){return(0,u.e)((function(e,t){e.subscribe((0,s.x)(t,(function(e){t.next(Q.createNext(e))}),(function(){t.next(Q.createComplete()),t.complete()}),(function(e){t.next(Q.createError(e)),t.complete()})))}))}function _n(e){return(0,Ut.u)((0,Y.m)(e)?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})}var xn=n(44367),An=Ge.z;function Cn(e,t,n){return void 0===n&&(n=1/0),(0,Y.m)(t)?(0,Ge.z)((function(){return e}),t,n):("number"==typeof t&&(n=t),(0,Ge.z)((function(){return e}),n))}function Fn(e,t,n){return void 0===n&&(n=1/0),(0,u.e)((function(r,o){var i=t;return(0,fn.p)(r,o,(function(t,n){return e(i,t,n)}),n,(function(e){i=e}),!1,void 0,(function(){return i=null}))}))}function Sn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.yG)(e),r=(0,Te._6)(e,1/0);return e=at(e),(0,u.e)((function(t,i){(0,xn.J)(r)((0,Ie.D)((0,o.ev)([t],(0,o.CR)(e)),n)).subscribe(i)}))}function On(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Sn.apply(void 0,(0,o.ev)([],(0,o.CR)(e)))}function kn(e){return(0,Ut.u)((0,Y.m)(e)?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})}function Bn(e,t){var n=(0,Y.m)(e)?e:function(){return e};return(0,Y.m)(t)?Kt(t,{connector:n}):function(e){return new c(e,n)}}function Pn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=at(e);return function(e){return ct.apply(void 0,(0,o.ev)([e],(0,o.CR)(n)))}}function jn(){return(0,u.e)((function(e,t){var n,r=!1;e.subscribe((0,s.x)(t,(function(e){var o=n;n=e,r&&t.next([o,e]),r=!0})))}))}function In(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return(0,Ee.U)((function(t){for(var r=t,o=0;o<n;o++){var i=null==r?void 0:r[e[o]];if(void 0===i)return;r=i}return r}))}function Tn(e){return e?function(t){return Kt(e)(t)}:function(e){return Bn(new v.x)(e)}}function Rn(e){return function(t){var n=new b.X(e);return new c(t,(function(){return n}))}}function Ln(){return function(e){var t=new D;return new c(e,(function(){return t}))}}function Mn(e,t,n,r){n&&!(0,Y.m)(n)&&(r=n);var o=(0,Y.m)(n)?n:void 0;return function(n){return Bn(new w(e,t,r),o)(n)}}function Nn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length?(0,u.e)((function(t,n){mt((0,o.ev)([t],(0,o.CR)(e)))(n)})):re.y}function qn(e){var t,n,r=1/0;return null!=e&&("object"==typeof e?(t=e.count,r=void 0===t?1/0:t,n=e.delay):r=e),r<=0?function(){return V.E}:(0,u.e)((function(e,t){var o,i=0,u=function(){if(null==o||o.unsubscribe(),o=null,null!=n){var e="number"==typeof n?nt(n):(0,pe.Xf)(n(i)),r=(0,s.x)(t,(function(){r.unsubscribe(),a()}));e.subscribe(r)}else a()},a=function(){var n=!1;o=e.subscribe((0,s.x)(t,void 0,(function(){++i<r?o?u():n=!0:t.complete()}))),n&&u()};a()}))}function Kn(e){return(0,u.e)((function(t,n){var r,o,i=!1,u=!1,a=!1,c=function(){return a&&u&&(n.complete(),!0)},l=function(){a=!1,r=t.subscribe((0,s.x)(n,void 0,(function(){a=!0,!c()&&(o||(o=new v.x,(0,pe.Xf)(e(o)).subscribe((0,s.x)(n,(function(){r?l():i=!0}),(function(){u=!0,c()})))),o).next()}))),i&&(r.unsubscribe(),r=null,i=!1,l())};l()}))}function Un(e){var t;void 0===e&&(e=1/0);var n=(t=e&&"object"==typeof e?e:{count:e}).count,r=void 0===n?1/0:n,o=t.delay,i=t.resetOnSuccess,a=void 0!==i&&i;return r<=0?re.y:(0,u.e)((function(e,t){var n,i=0,u=function(){var c=!1;n=e.subscribe((0,s.x)(t,(function(e){a&&(i=0),t.next(e)}),void 0,(function(e){if(i++<r){var a=function(){n?(n.unsubscribe(),n=null,u()):c=!0};if(null!=o){var l="number"==typeof o?nt(o):(0,pe.Xf)(o(e,i)),f=(0,s.x)(t,(function(){f.unsubscribe(),a()}),(function(){t.complete()}));l.subscribe(f)}else a()}else t.error(e)}))),c&&(n.unsubscribe(),n=null,u())};u()}))}function $n(e){return(0,u.e)((function(t,n){var r,o,i=!1,u=function(){r=t.subscribe((0,s.x)(n,void 0,void 0,(function(t){o||(o=new v.x,(0,pe.Xf)(e(o)).subscribe((0,s.x)(n,(function(){return r?u():i=!0})))),o&&o.next(t)}))),i&&(r.unsubscribe(),r=null,i=!1,u())};u()}))}function Hn(e){return(0,u.e)((function(t,n){var r=!1,o=null;t.subscribe((0,s.x)(n,(function(e){r=!0,o=e}))),(0,pe.Xf)(e).subscribe((0,s.x)(n,(function(){if(r){r=!1;var e=o;o=null,n.next(e)}}),ne.Z))}))}function Gn(e,t){return void 0===t&&(t=M),Hn(rt(e,t))}var Xn=n(56542);function zn(e,t){return void 0===t&&(t=function(e,t){return e===t}),(0,u.e)((function(n,r){var o={buffer:[],complete:!1},i={buffer:[],complete:!1},u=function(e){r.next(e),r.complete()},a=function(e,n){var o=(0,s.x)(r,(function(r){var o=n.buffer,i=n.complete;0===o.length?i?u(!1):e.buffer.push(r):!t(r,o.shift())&&u(!1)}),(function(){e.complete=!0;var t=n.complete,r=n.buffer;t&&u(0===r.length),null==o||o.unsubscribe()}));return o};n.subscribe(a(o,i)),(0,pe.Xf)(e).subscribe(a(i,o))}))}var Wn=n(65583);function Vn(e,t,n){var r,o,i,u,s=!1;return e&&"object"==typeof e?(r=e.bufferSize,u=void 0===r?1/0:r,o=e.windowTime,t=void 0===o?1/0:o,s=void 0!==(i=e.refCount)&&i,n=e.scheduler):u=null!=e?e:1/0,(0,Wn.B)({connector:function(){return new w(u,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}function Jn(e){return(0,u.e)((function(t,n){var r,o=!1,i=!1,u=0;t.subscribe((0,s.x)(n,(function(s){i=!0,e&&!e(s,u++,t)||(o&&n.error(new he("Too many matching values")),o=!0,r=s)}),(function(){o?(n.next(r),n.complete()):n.error(i?new le("No matching values"):new ie.K)})))}))}function Zn(e){return(0,ht.h)((function(t,n){return e<=n}))}function Yn(e){return e<=0?re.y:(0,u.e)((function(t,n){var r=new Array(e),o=0;return t.subscribe((0,s.x)(n,(function(t){var i=o++;if(i<e)r[i]=t;else{var u=i%e,s=r[u];r[u]=t,n.next(s)}}))),function(){r=null}}))}function Qn(e){return(0,u.e)((function(t,n){var r=!1,o=(0,s.x)(n,(function(){null==o||o.unsubscribe(),r=!0}),ne.Z);(0,pe.Xf)(e).subscribe(o),t.subscribe((0,s.x)(n,(function(e){return r&&n.next(e)})))}))}function er(e){return(0,u.e)((function(t,n){var r=!1,o=0;t.subscribe((0,s.x)(n,(function(t){return(r||(r=!e(t,o++)))&&n.next(t)})))}))}function tr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.yG)(e);return(0,u.e)((function(t,r){(n?(0,qe.z)(e,t,n):(0,qe.z)(e,t)).subscribe(r)}))}var nr=n(34978);function rr(){return(0,nr.w)(re.y)}function or(e,t){return(0,Y.m)(t)?(0,nr.w)((function(){return e}),t):(0,nr.w)((function(){return e}))}function ir(e,t){return(0,u.e)((function(n,r){var o=t;return(0,nr.w)((function(t,n){return e(o,t,n)}),(function(e,t){return o=t,t}))(n).subscribe(r),function(){o=null}}))}function ur(e){return(0,u.e)((function(t,n){(0,pe.Xf)(e).subscribe((0,s.x)(n,(function(){return n.complete()}),ne.Z)),!n.closed&&t.subscribe(n)}))}function sr(e,t){return void 0===t&&(t=!1),(0,u.e)((function(n,r){var o=0;n.subscribe((0,s.x)(r,(function(n){var i=e(n,o++);(i||t)&&r.next(n),!i&&r.complete()})))}))}function ar(e,t,n){var r=(0,Y.m)(e)||t||n?{next:e,error:t,complete:n}:e;return r?(0,u.e)((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var o=!0;e.subscribe((0,s.x)(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;o=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;o=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;o&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):re.y}function cr(e,t){return(0,u.e)((function(n,r){var o=null!=t?t:{},i=o.leading,u=void 0===i||i,a=o.trailing,c=void 0!==a&&a,l=!1,f=null,h=null,d=!1,p=function(){null==h||h.unsubscribe(),h=null,c&&(v(),d&&r.complete())},m=function(){h=null,d&&r.complete()},y=function(t){return h=(0,pe.Xf)(e(t)).subscribe((0,s.x)(r,p,m))},v=function(){if(l){l=!1;var e=f;f=null,r.next(e),!d&&y(e)}};n.subscribe((0,s.x)(r,(function(e){l=!0,f=e,(!h||h.closed)&&(u?v():y(e))}),(function(){d=!0,(!(c&&l&&h)||h.closed)&&r.complete()})))}))}function lr(e,t,n){void 0===t&&(t=M);var r=nt(e,t);return cr((function(){return r}),n)}function fr(e){return void 0===e&&(e=M),(0,u.e)((function(t,n){var r=e.now();t.subscribe((0,s.x)(n,(function(t){var o=e.now(),i=o-r;r=o,n.next(new hr(t,i))})))}))}var hr=function(e,t){this.value=e,this.interval=t};function dr(e,t,n){var r,o,i;if(n=null!=n?n:N,de(e)?r=e:"number"==typeof e&&(o=e),!t)throw new TypeError("No observable provided to switch to");if(i=function(){return t},null==r&&null==o)throw new TypeError("No timeout provided.");return ve({first:r,each:o,scheduler:n,with:i})}function pr(e){return void 0===e&&(e=g),(0,Ee.U)((function(t){return{value:t,timestamp:e.now()}}))}function mr(e){return(0,u.e)((function(t,n){var r=new v.x;n.next(r.asObservable());var o=function(e){r.error(e),n.error(e)};return t.subscribe((0,s.x)(n,(function(e){return null==r?void 0:r.next(e)}),(function(){r.complete(),n.complete()}),o)),(0,pe.Xf)(e).subscribe((0,s.x)(n,(function(){r.complete(),n.next(r=new v.x)}),ne.Z,o)),function(){null==r||r.unsubscribe(),r=null}}))}function yr(e,t){void 0===t&&(t=0);var n=t>0?t:e;return(0,u.e)((function(t,r){var i=[new v.x],u=0;r.next(i[0].asObservable()),t.subscribe((0,s.x)(r,(function(t){var s,a;try{for(var c=(0,o.XA)(i),l=c.next();!l.done;l=c.next())l.value.next(t)}catch(e){s={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}var f=u-e+1;if(f>=0&&f%n==0&&i.shift().complete(),++u%n==0){var h=new v.x;i.push(h),r.next(h.asObservable())}}),(function(){for(;i.length>0;)i.shift().complete();r.complete()}),(function(e){for(;i.length>0;)i.shift().error(e);r.error(e)}),(function(){i=null})))}))}function vr(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var a=null!==(t=(0,Te.yG)(r))&&void 0!==t?t:M,c=null!==(n=r[0])&&void 0!==n?n:null,l=r[1]||1/0;return(0,u.e)((function(t,n){var r=[],o=!1,u=function(e){var t=e.window,n=e.subs;t.complete(),n.unsubscribe(),(0,x.P)(r,e),o&&f()},f=function(){if(r){var t=new i.w0;n.add(t);var o=new v.x,s={window:o,subs:t,seen:0};r.push(s),n.next(o.asObservable()),(0,me.f)(t,a,(function(){return u(s)}),e)}};null!==c&&c>=0?(0,me.f)(n,a,f,c,!0):o=!0,f();var h=function(e){return r.slice().forEach(e)},d=function(e){h((function(t){var n=t.window;return e(n)})),e(n),n.unsubscribe()};return t.subscribe((0,s.x)(n,(function(e){h((function(t){t.window.next(e),l<=++t.seen&&u(t)}))}),(function(){return d((function(e){return e.complete()}))}),(function(e){return d((function(t){return t.error(e)}))}))),function(){r=null}}))}function br(e,t){return(0,u.e)((function(n,r){var u=[],a=function(e){for(;0<u.length;)u.shift().error(e);r.error(e)};(0,pe.Xf)(e).subscribe((0,s.x)(r,(function(e){var n=new v.x;u.push(n);var o,c=new i.w0;try{o=(0,pe.Xf)(t(e))}catch(e){return void a(e)}r.next(n.asObservable()),c.add(o.subscribe((0,s.x)(r,(function(){(0,x.P)(u,n),n.complete(),c.unsubscribe()}),ne.Z,a)))}),ne.Z)),n.subscribe((0,s.x)(r,(function(e){var t,n,r=u.slice();try{for(var i=(0,o.XA)(r),s=i.next();!s.done;s=i.next())s.value.next(e)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}),(function(){for(;0<u.length;)u.shift().complete();r.complete()}),a,(function(){for(;0<u.length;)u.shift().unsubscribe()})))}))}function gr(e){return(0,u.e)((function(t,n){var r,o,i=function(e){r.error(e),n.error(e)},u=function(){var t;null==o||o.unsubscribe(),null==r||r.complete(),r=new v.x,n.next(r.asObservable());try{t=(0,pe.Xf)(e())}catch(e){return void i(e)}t.subscribe(o=(0,s.x)(n,u,u,i))};u(),t.subscribe((0,s.x)(n,(function(e){return r.next(e)}),(function(){r.complete(),n.complete()}),i,(function(){null==o||o.unsubscribe(),r=null})))}))}function wr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,Te.jO)(e);return(0,u.e)((function(t,r){for(var i=e.length,u=new Array(i),a=e.map((function(){return!1})),c=!1,l=function(t){(0,pe.Xf)(e[t]).subscribe((0,s.x)(r,(function(e){u[t]=e,c||a[t]||(a[t]=!0,(c=a.every(re.y))&&(a=null))}),ne.Z))},f=0;f<i;f++)l(f);t.subscribe((0,s.x)(r,(function(e){if(c){var t=(0,o.ev)([e],(0,o.CR)(u));r.next(n?n.apply(void 0,(0,o.ev)([],(0,o.CR)(t))):t)}})))}))}function Dr(e){return kt(bt,e)}function Er(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,u.e)((function(t,n){bt.apply(void 0,(0,o.ev)([t],(0,o.CR)(e))).subscribe(n)}))}function _r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Er.apply(void 0,(0,o.ev)([],(0,o.CR)(e)))}},86515:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});var r=n(97582),o=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(n(9248).x)},85185:(e,t,n)=>{"use strict";n.d(t,{A:()=>o,JM:()=>i,TQ:()=>r});var r=u("C",void 0,void 0);function o(e){return u("E",void 0,e)}function i(e){return u("N",e,void 0)}function u(e,t,n){return{kind:e,value:t,error:n}}},80230:(e,t,n)=>{"use strict";n.d(t,{y:()=>l});var r=n(43652),o=n(70204),i=n(46766),u=n(92749),s=n(53912),a=n(58474),c=n(68846),l=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i,u=this,s=(i=e)&&i instanceof r.Lv||function(e){return e&&(0,a.m)(e.next)&&(0,a.m)(e.error)&&(0,a.m)(e.complete)}(i)&&(0,o.Nn)(i)?e:new r.Hp(e,t,n);return(0,c.x)((function(){var e=u,t=e.operator,n=e.source;s.add(t?t.call(s,n):n?u._subscribe(s):u._trySubscribe(s))})),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=f(t))((function(t,o){var i=new r.Hp({next:function(t){try{e(t)}catch(e){o(e),i.unsubscribe()}},error:o,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[i.L]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,u.U)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=f(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function f(e){var t;return null!==(t=null!=e?e:s.v.Promise)&&void 0!==t?t:Promise}},9248:(e,t,n)=>{"use strict";n.d(t,{x:()=>c});var r=n(97582),o=n(80230),i=n(70204),u=n(9825),s=n(3699),a=n(68846),c=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return(0,r.ZT)(t,e),t.prototype.lift=function(e){var t=new l(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new u.N},t.prototype.next=function(e){var t=this;(0,a.x)((function(){var n,o;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=(0,r.XA)(t.currentObservers),u=i.next();!u.done;u=i.next())u.value.next(e)}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;(0,a.x)((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;(0,a.x)((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,u=n.observers;return r||o?i.Lc:(this.currentObservers=null,u.push(e),new i.w0((function(){t.currentObservers=null,(0,s.P)(u,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new o.y;return e.source=this,e},t.create=function(e,t){return new l(e,t)},t}(o.y),l=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return(0,r.ZT)(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:i.Lc},t}(c)},43652:(e,t,n)=>{"use strict";n.d(t,{Hp:()=>y,Lv:()=>h});var r=n(97582),o=n(58474),i=n(70204),u=n(53912),s=n(40005),a=n(22967),c=n(85185),l=n(68380),f=n(68846),h=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,(0,i.Nn)(t)&&t.add(n)):n.destination=g,n}return(0,r.ZT)(t,e),t.create=function(e,t,n){return new y(e,t,n)},t.prototype.next=function(e){this.isStopped?b((0,c.JM)(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?b((0,c.A)(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?b(c.TQ,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(i.w0),d=Function.prototype.bind;function p(e,t){return d.call(e,t)}var m=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){v(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){v(e)}else v(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){v(e)}},e}(),y=function(e){function t(t,n,r){var i,s,a=e.call(this)||this;return(0,o.m)(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:a&&u.v.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},i={next:t.next&&p(t.next,s),error:t.error&&p(t.error,s),complete:t.complete&&p(t.complete,s)}):i=t,a.destination=new m(i),a}return(0,r.ZT)(t,e),t}(h);function v(e){u.v.useDeprecatedSynchronousErrorHandling?(0,f.O)(e):(0,s.h)(e)}function b(e,t){var n=u.v.onStoppedNotification;n&&l.z.setTimeout((function(){return n(e,t)}))}var g={closed:!0,next:a.Z,error:function(e){throw e},complete:a.Z}},70204:(e,t,n)=>{"use strict";n.d(t,{Lc:()=>a,Nn:()=>c,w0:()=>s});var r=n(97582),o=n(58474),i=n(25948),u=n(3699),s=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,u,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var c=(0,r.XA)(a),f=c.next();!f.done;f=c.next())f.value.remove(this)}catch(t){e={error:t}}finally{try{f&&!f.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else a.remove(this);var h=this.initialTeardown;if((0,o.m)(h))try{h()}catch(e){s=e instanceof i.B?e.errors:[e]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var p=(0,r.XA)(d),m=p.next();!m.done;m=p.next()){var y=m.value;try{l(y)}catch(e){s=null!=s?s:[],e instanceof i.B?s=(0,r.ev)((0,r.ev)([],(0,r.CR)(s)),(0,r.CR)(e.errors)):s.push(e)}}}catch(e){n={error:e}}finally{try{m&&!m.done&&(u=p.return)&&u.call(p)}finally{if(n)throw n.error}}}if(s)throw new i.B(s)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)l(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&(0,u.P)(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&(0,u.P)(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),a=s.EMPTY;function c(e){return e instanceof s||e&&"closed"in e&&(0,o.m)(e.remove)&&(0,o.m)(e.add)&&(0,o.m)(e.unsubscribe)}function l(e){(0,o.m)(e)?e():e.unsubscribe()}},53912:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});var r={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},1718:(e,t,n)=>{"use strict";n.d(t,{z:()=>i});var r=n(18084),o=n(43652);function i(e,t){var n="object"==typeof t;return new Promise((function(i,u){var s=new o.Hp({next:function(e){i(e),s.unsubscribe()},error:u,complete:function(){n?i(t.defaultValue):u(new r.K)}});e.subscribe(s)}))}},26362:(e,t,n)=>{"use strict";n.d(t,{z:()=>u});var r=n(79834),o=n(22457),i=n(40052);function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,r.u)()((0,i.D)(e,(0,o.yG)(e)))}},19917:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var r=n(80230),o=n(87878);function i(e){return new r.y((function(t){(0,o.Xf)(e()).subscribe(t)}))}},1545:(e,t,n)=>{"use strict";n.d(t,{E:()=>o,c:()=>i});var r=n(80230),o=new r.y((function(e){return e.complete()}));function i(e){return e?function(e){return new r.y((function(t){return e.schedule((function(){return t.complete()}))}))}(e):o}},40052:(e,t,n)=>{"use strict";n.d(t,{D:()=>i});var r=n(44878),o=n(87878);function i(e,t){return t?(0,r.x)(e,t):(0,o.Xf)(e)}},87878:(e,t,n)=>{"use strict";n.d(t,{Xf:()=>m});var r=n(97582),o=n(45685),i=n(53841),u=n(80230),s=n(71764),a=n(58430),c=n(88729),l=n(1837),f=n(48671),h=n(58474),d=n(40005),p=n(46766);function m(e){if(e instanceof u.y)return e;if(null!=e){if((0,s.c)(e))return b=e,new u.y((function(e){var t=b[p.L]();if((0,h.m)(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if((0,o.z)(e))return v=e,new u.y((function(e){for(var t=0;t<v.length&&!e.closed;t++)e.next(v[t]);e.complete()}));if((0,i.t)(e))return m=e,new u.y((function(e){m.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,d.h)}));if((0,a.D)(e))return y(e);if((0,l.T)(e))return n=e,new u.y((function(e){var t,o;try{for(var i=(0,r.XA)(n),u=i.next();!u.done;u=i.next()){var s=u.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{u&&!u.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}e.complete()}));if((0,f.L)(e))return t=e,y((0,f.Q)(t))}var t,n,m,v,b;throw(0,c.z)(e)}function y(e){return new u.y((function(t){(function(e,t){var n,o,i,u;return(0,r.mG)(this,void 0,void 0,(function(){var s,a;return(0,r.Jh)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=(0,r.KL)(e),c.label=1;case 1:return[4,n.next()];case 2:if((o=c.sent()).done)return[3,4];if(s=o.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),o&&!o.done&&(u=n.return)?[4,u.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}},23071:(e,t,n)=>{"use strict";n.d(t,{T:()=>a});var r=n(44367),o=n(87878),i=n(1545),u=n(22457),s=n(40052);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,u.yG)(e),a=(0,u._6)(e,1/0),c=e;return c.length?1===c.length?(0,o.Xf)(c[0]):(0,r.J)(a)((0,s.D)(c,n)):i.E}},32817:(e,t,n)=>{"use strict";n.d(t,{of:()=>i});var r=n(22457),o=n(40052);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(0,r.yG)(e);return(0,o.D)(e,n)}},83610:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(80230),o=n(58474);function i(e,t){var n=(0,o.m)(e)?e:function(){return e},i=function(e){return e.error(n())};return new r.y(t?function(e){return t.schedule(i,0,e)}:i)}},2566:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i,x:()=>o});var r=n(97582);function o(e,t,n,r,o){return new i(e,t,n,r,o)}var i=function(e){function t(t,n,r,o,i,u){var s=e.call(this,t)||this;return s.onFinalize=i,s.shouldUnsubscribe=u,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return(0,r.ZT)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(n(43652).Lv)},79878:(e,t,n)=>{"use strict";n.d(t,{K:()=>u});var r=n(87878),o=n(2566),i=n(96798);function u(e){return(0,i.e)((function(t,n){var i,s=null,a=!1;s=t.subscribe((0,o.x)(n,void 0,void 0,(function(o){i=(0,r.Xf)(e(o,u(e)(t))),s?(s.unsubscribe(),s=null,i.subscribe(n)):a=!0}))),a&&(s.unsubscribe(),s=null,i.subscribe(n))}))}},79834:(e,t,n)=>{"use strict";n.d(t,{u:()=>o});var r=n(44367);function o(){return(0,r.J)(1)}},51313:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var r=n(43994),o=n(58474);function i(e,t){return(0,o.m)(t)?(0,r.z)(e,t,1):(0,r.z)(e,1)}},53741:(e,t,n)=>{"use strict";n.d(t,{x:()=>u});var r=n(90278),o=n(96798),i=n(2566);function u(e,t){return void 0===t&&(t=r.y),e=null!=e?e:s,(0,o.e)((function(n,r){var o,u=!0;n.subscribe((0,i.x)(r,(function(n){var i=t(n);!u&&e(o,i)||(u=!1,o=i,r.next(n))})))}))}function s(e,t){return e===t}},94975:(e,t,n)=>{"use strict";n.d(t,{h:()=>i});var r=n(96798),o=n(2566);function i(e,t){return(0,r.e)((function(n,r){var i=0;n.subscribe((0,o.x)(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}},83286:(e,t,n)=>{"use strict";n.d(t,{x:()=>o});var r=n(96798);function o(e){return(0,r.e)((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))}},29127:(e,t,n)=>{"use strict";n.d(t,{U:()=>i});var r=n(96798),o=n(2566);function i(e,t){return(0,r.e)((function(n,r){var i=0;n.subscribe((0,o.x)(r,(function(n){r.next(e.call(t,n,i++))})))}))}},44367:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});var r=n(43994),o=n(90278);function i(e){return void 0===e&&(e=1/0),(0,r.z)(o.y,e)}},29007:(e,t,n)=>{"use strict";n.d(t,{p:()=>u});var r=n(87878),o=n(47845),i=n(2566);function u(e,t,n,u,s,a,c,l){var f=[],h=0,d=0,p=!1,m=function(){!p||f.length||h||t.complete()},y=function(e){return h<u?v(e):f.push(e)},v=function(e){a&&t.next(e),h++;var l=!1;(0,r.Xf)(n(e,d++)).subscribe((0,i.x)(t,(function(e){null==s||s(e),a?y(e):t.next(e)}),(function(){l=!0}),void 0,(function(){if(l)try{h--;for(var e=function(){var e=f.shift();c?(0,o.f)(t,c,(function(){return v(e)})):v(e)};f.length&&h<u;)e();m()}catch(e){t.error(e)}})))};return e.subscribe((0,i.x)(t,y,(function(){p=!0,m()}))),function(){null==l||l()}}},43994:(e,t,n)=>{"use strict";n.d(t,{z:()=>a});var r=n(29127),o=n(87878),i=n(96798),u=n(29007),s=n(58474);function a(e,t,n){return void 0===n&&(n=1/0),(0,s.m)(t)?a((function(n,i){return(0,r.U)((function(e,r){return t(n,e,i,r)}))((0,o.Xf)(e(n,i)))}),n):("number"==typeof t&&(n=t),(0,i.e)((function(t,r){return(0,u.p)(t,r,e,n)})))}},29526:(e,t,n)=>{"use strict";n.d(t,{Q:()=>u});var r=n(47845),o=n(96798),i=n(2566);function u(e,t){return void 0===t&&(t=0),(0,o.e)((function(n,o){n.subscribe((0,i.x)(o,(function(n){return(0,r.f)(o,e,(function(){return o.next(n)}),t)}),(function(){return(0,r.f)(o,e,(function(){return o.complete()}),t)}),(function(n){return(0,r.f)(o,e,(function(){return o.error(n)}),t)})))}))}},77270:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var r=n(71674),o=n(96798);function i(e,t){return(0,o.e)((0,r.U)(e,t,arguments.length>=2,!1,!0))}},56542:(e,t,n)=>{"use strict";n.d(t,{R:()=>i});var r=n(96798),o=n(71674);function i(e,t){return(0,r.e)((0,o.U)(e,t,arguments.length>=2,!0))}},71674:(e,t,n)=>{"use strict";n.d(t,{U:()=>o});var r=n(2566);function o(e,t,n,o,i){return function(u,s){var a=n,c=t,l=0;u.subscribe((0,r.x)(s,(function(t){var n=l++;c=a?e(c,t,n):(a=!0,t),o&&s.next(c)}),i&&function(){a&&s.next(c),s.complete()}))}}},65583:(e,t,n)=>{"use strict";n.d(t,{B:()=>a});var r=n(97582),o=n(87878),i=n(9248),u=n(43652),s=n(96798);function a(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new i.x}:t,r=e.resetOnError,a=void 0===r||r,l=e.resetOnComplete,f=void 0===l||l,h=e.resetOnRefCountZero,d=void 0===h||h;return function(e){var t,r,i,l=0,h=!1,p=!1,m=function(){null==r||r.unsubscribe(),r=void 0},y=function(){m(),t=i=void 0,h=p=!1},v=function(){var e=t;y(),null==e||e.unsubscribe()};return(0,s.e)((function(e,s){l++,p||h||m();var b=i=null!=i?i:n();s.add((function(){0!=--l||p||h||(r=c(v,d))})),b.subscribe(s),!t&&l>0&&(t=new u.Hp({next:function(e){return b.next(e)},error:function(e){p=!0,m(),r=c(y,a,e),b.error(e)},complete:function(){h=!0,m(),r=c(y,f),b.complete()}}),(0,o.Xf)(e).subscribe(t))}))(e)}}function c(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!0!==t){if(!1!==t){var s=new u.Hp({next:function(){s.unsubscribe(),e()}});return(0,o.Xf)(t.apply(void 0,(0,r.ev)([],(0,r.CR)(n)))).subscribe(s)}}else e()}},58720:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var r=n(96798);function o(e,t){return void 0===t&&(t=0),(0,r.e)((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}},34978:(e,t,n)=>{"use strict";n.d(t,{w:()=>u});var r=n(87878),o=n(96798),i=n(2566);function u(e,t){return(0,o.e)((function(n,o){var u=null,s=0,a=!1,c=function(){return a&&!u&&o.complete()};n.subscribe((0,i.x)(o,(function(n){null==u||u.unsubscribe();var a=0,l=s++;(0,r.Xf)(e(n,l)).subscribe(u=(0,i.x)(o,(function(e){return o.next(t?t(n,e,l,a++):e)}),(function(){u=null,c()})))}),(function(){a=!0,c()})))}))}},30062:(e,t,n)=>{"use strict";n.d(t,{q:()=>u});var r=n(77270),o=n(96798),i=function(e,t){return e.push(t),e};function u(){return(0,o.e)((function(e,t){(0,r.u)(i,[])(e).subscribe(t)}))}},13217:(e,t,n)=>{"use strict";n.d(t,{r:()=>o});var r=n(80230);function o(e,t){return new r.y((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}},45002:(e,t,n)=>{"use strict";n.d(t,{z:()=>i});var r=n(80230),o=n(47845);function i(e,t){if(!e)throw new Error("Iterable cannot be null");return new r.y((function(n){(0,o.f)(n,t,(function(){var r=e[Symbol.asyncIterator]();(0,o.f)(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}},18077:(e,t,n)=>{"use strict";n.d(t,{Q:()=>s});var r=n(80230),o=n(39768),i=n(58474),u=n(47845);function s(e,t){return new r.y((function(n){var r;return(0,u.f)(n,t,(function(){r=e[o.h](),(0,u.f)(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return(0,i.m)(null==r?void 0:r.return)&&r.return()}}))}},93524:(e,t,n)=>{"use strict";n.d(t,{l:()=>u});var r=n(87878),o=n(29526),i=n(58720);function u(e,t){return(0,r.Xf)(e).pipe((0,i.R)(t),(0,o.Q)(t))}},75362:(e,t,n)=>{"use strict";n.d(t,{c:()=>u});var r=n(87878),o=n(29526),i=n(58720);function u(e,t){return(0,r.Xf)(e).pipe((0,i.R)(t),(0,o.Q)(t))}},46444:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var r=n(45002),o=n(48671);function i(e,t){return(0,r.z)((0,o.Q)(e),t)}},44878:(e,t,n)=>{"use strict";n.d(t,{x:()=>y});var r=n(93524),o=n(75362),i=n(13217),u=n(18077),s=n(45002),a=n(71764),c=n(53841),l=n(45685),f=n(1837),h=n(58430),d=n(88729),p=n(48671),m=n(46444);function y(e,t){if(null!=e){if((0,a.c)(e))return(0,r.l)(e,t);if((0,l.z)(e))return(0,i.r)(e,t);if((0,c.t)(e))return(0,o.c)(e,t);if((0,h.D)(e))return(0,s.z)(e,t);if((0,f.T)(e))return(0,u.Q)(e,t);if((0,p.L)(e))return(0,m.v)(e,t)}throw(0,d.z)(e)}},68380:(e,t,n)=>{"use strict";n.d(t,{z:()=>o});var r=n(97582),o={setTimeout:function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var u=o.delegate;return(null==u?void 0:u.setTimeout)?u.setTimeout.apply(u,(0,r.ev)([e,t],(0,r.CR)(n))):setTimeout.apply(void 0,(0,r.ev)([e,t],(0,r.CR)(n)))},clearTimeout:function(e){var t=o.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0}},39768:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});var r="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},46766:(e,t,n)=>{"use strict";n.d(t,{L:()=>r});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},18084:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var r=(0,n(1819).d)((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}))},9825:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var r=(0,n(1819).d)((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}))},25948:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});var r=(0,n(1819).d)((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}))},22457:(e,t,n)=>{"use strict";n.d(t,{_6:()=>a,jO:()=>u,yG:()=>s});var r=n(58474),o=n(64865);function i(e){return e[e.length-1]}function u(e){return(0,r.m)(i(e))?e.pop():void 0}function s(e){return(0,o.K)(i(e))?e.pop():void 0}function a(e,t){return"number"==typeof i(e)?e.pop():t}},3699:(e,t,n)=>{"use strict";function r(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}n.d(t,{P:()=>r})},1819:(e,t,n)=>{"use strict";function r(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}n.d(t,{d:()=>r})},68846:(e,t,n)=>{"use strict";n.d(t,{O:()=>u,x:()=>i});var r=n(53912),o=null;function i(e){if(r.v.useDeprecatedSynchronousErrorHandling){var t=!o;if(t&&(o={errorThrown:!1,error:null}),e(),t){var n=o,i=n.errorThrown,u=n.error;if(o=null,i)throw u}}else e()}function u(e){r.v.useDeprecatedSynchronousErrorHandling&&o&&(o.errorThrown=!0,o.error=e)}},47845:(e,t,n)=>{"use strict";function r(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}n.d(t,{f:()=>r})},90278:(e,t,n)=>{"use strict";function r(e){return e}n.d(t,{y:()=>r})},45685:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},58430:(e,t,n)=>{"use strict";n.d(t,{D:()=>o});var r=n(58474);function o(e){return Symbol.asyncIterator&&(0,r.m)(null==e?void 0:e[Symbol.asyncIterator])}},58474:(e,t,n)=>{"use strict";function r(e){return"function"==typeof e}n.d(t,{m:()=>r})},71764:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});var r=n(46766),o=n(58474);function i(e){return(0,o.m)(e[r.L])}},1837:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});var r=n(39768),o=n(58474);function i(e){return(0,o.m)(null==e?void 0:e[r.h])}},9141:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var r=n(80230),o=n(58474);function i(e){return!!e&&(e instanceof r.y||(0,o.m)(e.lift)&&(0,o.m)(e.subscribe))}},53841:(e,t,n)=>{"use strict";n.d(t,{t:()=>o});var r=n(58474);function o(e){return(0,r.m)(null==e?void 0:e.then)}},48671:(e,t,n)=>{"use strict";n.d(t,{L:()=>u,Q:()=>i});var r=n(97582),o=n(58474);function i(e){return(0,r.FC)(this,arguments,(function(){var t,n,o;return(0,r.Jh)(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,(0,r.qq)(t.read())];case 3:return n=i.sent(),o=n.value,n.done?[4,(0,r.qq)(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,(0,r.qq)(o)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function u(e){return(0,o.m)(null==e?void 0:e.getReader)}},64865:(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var r=n(58474);function o(e){return e&&(0,r.m)(e.schedule)}},96798:(e,t,n)=>{"use strict";n.d(t,{A:()=>o,e:()=>i});var r=n(58474);function o(e){return(0,r.m)(null==e?void 0:e.lift)}function i(e){return function(t){if(o(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}},22967:(e,t,n)=>{"use strict";function r(){}n.d(t,{Z:()=>r})},92749:(e,t,n)=>{"use strict";n.d(t,{U:()=>i,z:()=>o});var r=n(90278);function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i(e)}function i(e){return 0===e.length?r.y:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}},40005:(e,t,n)=>{"use strict";n.d(t,{h:()=>i});var r=n(53912),o=n(68380);function i(e){o.z.setTimeout((function(){var t=r.v.onUnhandledError;if(!t)throw e;t(e)}))}},88729:(e,t,n)=>{"use strict";function r(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}n.d(t,{z:()=>r})},93744:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}},13653:(e,t,n)=>{"use strict";let r;n.d(t,{Z:()=>i});const o=new Uint8Array(16);function i(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}},3958:(e,t,n)=>{"use strict";n.d(t,{S:()=>o});const r=[];for(let e=0;e<256;++e)r.push((e+256).toString(16).slice(1));function o(e,t=0){return r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]}},72045:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(93744),o=n(13653),i=n(3958);const u=function(e,t,n){if(r.Z.randomUUID&&!t&&!e)return r.Z.randomUUID();const u=(e=e||{}).random||(e.rng||o.Z)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=u[e];return t}return(0,i.S)(u)}},49520:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Dexie:()=>Qn,RangeSet:()=>Gn,default:()=>Qn,liveQuery:()=>rr,mergeRanges:()=>zn,rangesOverlap:()=>Wn});const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=Object.keys,i=Array.isArray;function u(e,t){return"object"!=typeof t||o(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||r.Promise||(r.Promise=Promise);const s=Object.getPrototypeOf,a={}.hasOwnProperty;function c(e,t){return a.call(e,t)}function l(e,t){"function"==typeof t&&(t=t(s(e))),("undefined"==typeof Reflect?o:Reflect.ownKeys)(t).forEach((n=>{h(e,n,t[n])}))}const f=Object.defineProperty;function h(e,t,n,r){f(e,t,u(n&&c(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function d(e){return{from:function(t){return e.prototype=Object.create(t.prototype),h(e.prototype,"constructor",e),{extend:l.bind(null,e.prototype)}}}}const p=Object.getOwnPropertyDescriptor;function m(e,t){let n;return p(e,t)||(n=s(e))&&m(n,t)}const y=[].slice;function v(e,t,n){return y.call(e,t,n)}function b(e,t){return t(e)}function g(e){if(!e)throw new Error("Assertion Failed")}function w(e){r.setImmediate?setImmediate(e):setTimeout(e,0)}function D(e,t){return e.reduce(((e,n,r)=>{var o=t(n,r);return o&&(e[o[0]]=o[1]),e}),{})}function E(e,t){if(c(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,o=t.length;r<o;++r){var i=E(e,t[r]);n.push(i)}return n}var u=t.indexOf(".");if(-1!==u){var s=e[t.substr(0,u)];return void 0===s?void 0:E(s,t.substr(u+1))}}function _(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){g("string"!=typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)_(e,t[r],n[r])}else{var u=t.indexOf(".");if(-1!==u){var s=t.substr(0,u),a=t.substr(u+1);if(""===a)void 0===n?i(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var l=e[s];l&&c(e,s)||(l=e[s]={}),_(l,a,n)}}else void 0===n?i(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function x(e){var t={};for(var n in e)c(e,n)&&(t[n]=e[n]);return t}const A=[].concat;function C(e){return A.apply([],e)}const F="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>r[e])),S=F.map((e=>r[e]));D(F,(e=>[e,!0]));let O=null;function k(e){O="undefined"!=typeof WeakMap&&new WeakMap;const t=B(e);return O=null,t}function B(e){if(!e||"object"!=typeof e)return e;let t=O&&O.get(e);if(t)return t;if(i(e)){t=[],O&&O.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(B(e[n]))}else if(S.indexOf(e.constructor)>=0)t=e;else{const n=s(e);for(var o in t=n===Object.prototype?{}:Object.create(n),O&&O.set(e,t),e)c(e,o)&&(t[o]=B(e[o]))}return t}const{toString:P}={};function j(e){return P.call(e).slice(8,-1)}const I="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",T="symbol"==typeof I?function(e){var t;return null!=e&&(t=e[I])&&t.apply(e)}:function(){return null},R={};function L(e){var t,n,r,o;if(1===arguments.length){if(i(e))return e.slice();if(this===R&&"string"==typeof e)return[e];if(o=T(e)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const M="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var N="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function q(e,t){N=e,K=t}var K=()=>!0;const U=!new Error("").stack;function $(){if(U)try{throw $.arguments,new Error}catch(e){return e}return new Error}function H(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(K).map((e=>"\n"+e)).join("")):""}var G=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],X=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(G),z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function W(e,t){this._e=$(),this.name=e,this.message=t}function V(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function J(e,t,n,r){this._e=$(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=V(e,t)}function Z(e,t){this._e=$(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=V(e,t)}d(W).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+H(this._e,2))}},toString:function(){return this.name+": "+this.message}}),d(J).from(W),d(Z).from(W);var Y=X.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const Q=W;var ee=X.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=$(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=z[t]||n,this.inner=null)}return d(r).from(Q),e[t]=r,e}),{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=G.reduce(((e,t)=>(e[t+"Error"]=ee[t],e)),{}),ne=X.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e)),{});function re(){}function oe(e){return e}function ie(e,t){return null==e||e===oe?t:function(n){return t(e(n))}}function ue(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function se(e,t){return e===re?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ue(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ue(o,this.onerror):o),void 0!==i?i:n}}function ae(e,t){return e===re?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ue(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ue(r,this.onerror):r)}}function ce(e,t){return e===re?t:function(n){var r=e.apply(this,arguments);u(n,r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?ue(o,this.onsuccess):o),i&&(this.onerror=this.onerror?ue(i,this.onerror):i),void 0===r?void 0===s?void 0:s:u(r,s)}}function le(e,t){return e===re?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===re?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return n.then((function(){return t.apply(r,i)}))}return t.apply(this,arguments)}}ne.ModifyError=J,ne.DexieError=W,ne.BulkError=Z;var he={};const de=100,[pe,me,ye]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,s(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,s(t),e]})(),ve=me&&me.then,be=pe&&pe.constructor,ge=!!ye;var we=!1,De=ye?()=>{ye.then(He)}:r.setImmediate?setImmediate.bind(null,He):r.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{He(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(He,0)},Ee=function(e,t){Be.push([e,t]),xe&&(De(),xe=!1)},_e=!0,xe=!0,Ae=[],Ce=[],Fe=null,Se=oe,Oe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:mt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{mt(e[0],e[1])}catch(e){}}))}},ke=Oe,Be=[],Pe=0,je=[];function Ie(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=re,this._lib=!1;var t=this._PSD=ke;if(N&&(this._stackHolder=$(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==he)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Me(this,this._value))}this._state=null,this._value=null,++t.ref,Le(this,e)}const Te={get:function(){var e=ke,t=et;function n(n,r){var o=!e.global&&(e!==ke||t!==et);const i=o&&!ot();var u=new Ie(((t,u)=>{qe(this,new Re(ht(n,e,o,i),ht(r,e,o,i),t,u,e))}));return N&&$e(u,this),u}return n.prototype=he,n},set:function(e){h(this,"then",e&&e.prototype===he?Te:{get:function(){return e},set:Te.set})}};function Re(e,t,n,r,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=o}function Le(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ge();t&&"function"==typeof t.then?Le(e,((e,n)=>{t instanceof Ie?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Ne(e)),n&&Xe()}}),Me.bind(null,e))}catch(t){Me(e,t)}}function Me(e,t){if(Ce.push(t),null===e._state){var n=e._lib&&Ge();t=Se(t),e._state=!1,e._value=t,N&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=m(t,"stack");t._promise=e,h(t,"stack",{get:()=>we?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Ae.some((t=>t._value===e._value))||Ae.push(e)}(e),Ne(e),n&&Xe()}}function Ne(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)qe(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),0===Pe&&(++Pe,Ee((()=>{0==--Pe&&ze()}),[]))}function qe(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Pe,Ee(Ke,[n,e,t])}else e._listeners.push(t)}function Ke(e,t,n){try{Fe=t;var r,o=t._value;t._state?r=e(o):(Ce.length&&(Ce=[]),r=e(o),-1===Ce.indexOf(o)&&function(e){for(var t=Ae.length;t;)if(Ae[--t]._value===e._value)return void Ae.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{Fe=null,0==--Pe&&ze(),--n.psd.ref||n.psd.finalize()}}function Ue(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var o,i,u=e._value;null!=u?(o=u.name||"Error",i=u.message||u,r=H(u,0)):(o=u,i=""),t.push(o+(i?": "+i:"")+r)}return N&&((r=H(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ue(e._prev,t,n)),t}function $e(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function He(){Ge()&&Xe()}function Ge(){var e=_e;return _e=!1,xe=!1,e}function Xe(){var e,t,n;do{for(;Be.length>0;)for(e=Be,Be=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Be.length>0);_e=!0,xe=!0}function ze(){var e=Ae;Ae=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=je.slice(0),n=t.length;n;)t[--n]()}function We(e){return new Ie(he,!1,e)}function Ve(e,t){var n=ke;return function(){var r=Ge(),o=ke;try{return at(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{at(o,!1),r&&Xe()}}}l(Ie.prototype,{then:Te,_then:function(e,t){qe(this,new Re(null,null,e,t,ke))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):We(e))):this.then(null,(e=>e&&e.name===t?n(e):We(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),We(t))))},stack:{get:function(){if(this._stack)return this._stack;try{we=!0;var e=Ue(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{we=!1}}},timeout:function(e,t){return e<1/0?new Ie(((n,r)=>{var o=setTimeout((()=>r(new ee.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&h(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),Oe.env=ct(),l(Ie,{all:function(){var e=L.apply(null,arguments).map(it);return new Ie((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((o,i)=>Ie.resolve(o).then((n=>{e[i]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Ie)return e;if(e&&"function"==typeof e.then)return new Ie(((t,n)=>{e.then(t,n)}));var t=new Ie(he,!0,e);return $e(t,Fe),t},reject:We,race:function(){var e=L.apply(null,arguments).map(it);return new Ie(((t,n)=>{e.map((e=>Ie.resolve(e).then(t,n)))}))},PSD:{get:()=>ke,set:e=>ke=e},totalEchoes:{get:()=>et},newPSD:nt,usePSD:lt,scheduler:{get:()=>Ee,set:e=>{Ee=e}},rejectionMapper:{get:()=>Se,set:e=>{Se=e}},follow:(e,t)=>new Ie(((n,r)=>nt(((t,n)=>{var r=ke;r.unhandleds=[],r.onunhandled=n,r.finalize=ue((function(){!function(e){je.push((function t(){e(),je.splice(je.indexOf(t),1)})),++Pe,Ee((()=>{0==--Pe&&ze()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),be&&(be.allSettled&&h(Ie,"allSettled",(function(){const e=L.apply(null,arguments).map(it);return new Ie((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,o)=>Ie.resolve(e).then((e=>r[o]={status:"fulfilled",value:e}),(e=>r[o]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),be.any&&"undefined"!=typeof AggregateError&&h(Ie,"any",(function(){const e=L.apply(null,arguments).map(it);return new Ie(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const o=new Array(r);e.forEach(((e,i)=>Ie.resolve(e).then((e=>t(e)),(e=>{o[i]=e,--r||n(new AggregateError(o))}))))}))})));const Je={awaits:0,echoes:0,id:0};var Ze=0,Ye=[],Qe=0,et=0,tt=0;function nt(e,t,n,r){var o=ke,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,i.id=++tt;var s=Oe.env;i.env=ge?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject,nthen:dt(s.nthen,i),gthen:dt(s.gthen,i)}:{},t&&u(i,t),++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=lt(i,e,n,r);return 0===i.ref&&i.finalize(),a}function rt(){return Je.id||(Je.id=++Ze),++Je.awaits,Je.echoes+=de,Je.id}function ot(){return!!Je.awaits&&(0==--Je.awaits&&(Je.id=0),Je.echoes=Je.awaits*de,!0)}function it(e){return Je.echoes&&e&&e.constructor===be?(rt(),e.then((e=>(ot(),e)),(e=>(ot(),yt(e))))):e}function ut(e){++et,Je.echoes&&0!=--Je.echoes||(Je.echoes=Je.id=0),Ye.push(ke),at(e,!0)}function st(){var e=Ye[Ye.length-1];Ye.pop(),at(e,!1)}function at(e,t){var n=ke;if((t?!Je.echoes||Qe++&&e===ke:!Qe||--Qe&&e===ke)||ft(t?ut.bind(null,e):st),e!==ke&&(ke=e,n===Oe&&(Oe.env=ct()),ge)){var o=Oe.env.Promise,i=e.env;me.then=i.nthen,o.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(r,"Promise",i.PromiseProp),o.all=i.all,o.race=i.race,o.resolve=i.resolve,o.reject=i.reject,i.allSettled&&(o.allSettled=i.allSettled),i.any&&(o.any=i.any))}}function ct(){var e=r.Promise;return ge?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:me.then,gthen:e.prototype.then}:{}}function lt(e,t,n,r,o){var i=ke;try{return at(e,!0),t(n,r,o)}finally{at(i,!1)}}function ft(e){ve.call(pe,e)}function ht(e,t,n,r){return"function"!=typeof e?e:function(){var o=ke;n&&rt(),at(t,!0);try{return e.apply(this,arguments)}finally{at(o,!1),r&&ft(ot)}}}function dt(e,t){return function(n,r){return e.call(this,ht(n,t),ht(r,t))}}-1===(""+ve).indexOf("[native code]")&&(rt=ot=re);const pt="unhandledrejection";function mt(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var o,i={promise:t,reason:e};if(r.document&&document.createEvent?((o=document.createEvent("Event")).initEvent(pt,!0,!0),u(o,i)):r.CustomEvent&&u(o=new CustomEvent(pt,{detail:i}),i),o&&r.dispatchEvent&&(dispatchEvent(o),!r.PromiseRejectionEvent&&r.onunhandledrejection))try{r.onunhandledrejection(o)}catch(e){}N&&o&&!o.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}var yt=Ie.reject;function vt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||ke.letThrough||e._vip)){var o=e._createTransaction(t,n,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===Y.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>vt(e,t,n,r)))):yt(o)}return o._promise(t,((e,t)=>nt((()=>(ke.trans=o,r(e,t,o)))))).then((e=>o._completion.then((()=>e))))}if(e._state.openComplete)return yt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return yt(new ee.DatabaseClosed);e.open().catch(re)}return e._state.dbReadyPromise.then((()=>vt(e,t,n,r)))}const bt="3.2.4",gt=String.fromCharCode(65535),wt=-1/0,Dt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Et="String expected.",_t=[],xt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),At=xt,Ct=xt,Ft=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),St="__dbnames",Ot="readonly",kt="readwrite";function Bt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Pt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function jt(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=k(t))[e],t)}class It{_trans(e,t,n){const r=this._tx||ke.trans,o=this.name;function i(e,n,r){if(!r.schema[o])throw new ee.NotFound("Table "+o+" not part of transaction");return t(r.idbtrans,r)}const u=Ge();try{return r&&r.db===this.db?r===ke.trans?r._promise(e,i,n):nt((()=>r._promise(e,i,n)),{trans:r,transless:ke.transless||ke}):vt(this.db,e,[this.name],i)}finally{u&&Xe()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(i(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=o(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==gt)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&N&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,u=this.db._deps.indexedDB;function s(e,t){try{return 0===u.cmp(e,t)}catch(e){return!1}}const[a,c]=t.reduce((([t,n],o)=>{const u=r[o],a=e[o];return[t||u,t||!u?Bt(n,u&&u.multi?e=>{const t=E(e,o);return i(t)&&t.some((e=>s(a,e)))}:e=>s(a,E(e,o))):n]}),[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(c):n?this.filter(c):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,i(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if(c(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){u(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=jt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[o]}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{_(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||i(e))return this.where(":id").equals(e).modify(t);{const n=E(e,this.schema.primKey.keyPath);if(void 0===n)return yt(new ee.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?o(t).forEach((n=>{_(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=jt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[o],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{_(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Pt}))).then((e=>e.numFailures?Ie.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,o=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let s=i&&n?e.map(jt(i)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:s,wantResults:o}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return o?t:n;throw new Z(`${this.name}.bulkAdd(): ${e} of ${u} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,o=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let s=i&&n?e.map(jt(i)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:s,wantResults:o}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return o?t:n;throw new Z(`${this.name}.bulkPut(): ${e} of ${u} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new Z(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Tt(e){var t={},n=function(n,r){if(r){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return t[n].subscribe.apply(null,i),e}if("string"==typeof n)return t[n]};n.addEventType=s;for(var r=1,u=arguments.length;r<u;++r)s(arguments[r]);return n;function s(e,r,u){if("object"!=typeof e){var a;r||(r=le),u||(u=re);var c={subscribers:[],fire:u,subscribe:function(e){-1===c.subscribers.indexOf(e)&&(c.subscribers.push(e),c.fire=r(c.fire,e))},unsubscribe:function(e){c.subscribers=c.subscribers.filter((function(t){return t!==e})),c.fire=c.subscribers.reduce(r,u)}};return t[e]=n[e]=c,c}o(a=e).forEach((function(e){var t=a[e];if(i(t))s(e,a[e][0],a[e][1]);else{if("asap"!==t)throw new ee.InvalidArgument("Invalid event config");var n=s(e,oe,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){w((function(){e.apply(null,t)}))}))}))}}))}}function Rt(e,t){return d(t).from({prototype:e}),t}function Lt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Mt(e,t){e.filter=Bt(e.filter,t)}function Nt(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Bt(r(),t()):t,e.justLimit=n&&!r}function qt(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Kt(e,t,n){const r=qt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ut(e,t,n,r){const o=e.replayFilter?Bt(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},u=(e,n,r)=>{if(!o||o(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var u=n.primaryKey,s=""+u;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(u)),c(i,s)||(i[s]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(u,n),$t(Kt(e,r,n),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}return $t(Kt(e,r,n),Bt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function $t(e,t,n,r){var o=Ve(r?(e,t,o)=>n(r(e),t,o):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=re}),(t=>{e.fail(t),n=re}))||o(e.value,e,(e=>n=e)),n()}))}))}function Ht(e,t){try{const n=Gt(e),r=Gt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,o=n<r?n:r;for(let n=0;n<o;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(Xt(e),Xt(t));case"Array":return function(e,t){const n=e.length,r=t.length,o=n<r?n:r;for(let n=0;n<o;++n){const r=Ht(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function Gt(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=j(e);return"ArrayBuffer"===n?"binary":n}function Xt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class zt{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,yt.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,yt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Bt(t.algorithm,e)}_iterate(e,t){return Ut(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&u(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Ut(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Lt(t,!0))return n.count({trans:e,query:{index:qt(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return Ut(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],o=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var u="next"===this._ctx.dir?1:-1;function s(e,t){var n=i(e,o),r=i(t,o);return n<r?-u:n>r?u:0}return this.toArray((function(e){return e.sort(s)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Lt(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=qt(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Ut(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Lt(t)?Nt(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Nt(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Nt(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Mt(this._ctx,(function(n,r,o){return!e(n.value)||(r(o),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Mt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Bt(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Lt(t,!0)&&t.limit>0)return this._read((e=>{var n=qt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Mt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=c(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var i=o(e),u=i.length;r=function(t){for(var n=!1,r=0;r<u;++r){var o=i[r],s=e[o];E(t,o)!==s&&(_(t,o,s),n=!0)}return n}}const s=t.table.core,{outbound:a,extractKey:c}=s.schema.primaryKey,l=this.db._options.modifyChunkSize||200,f=[];let h=0;const d=[],p=(e,t)=>{const{failures:n,numFailures:r}=t;h+=e-r;for(let e of o(n))f.push(n[e])};return this.clone().primaryKeys().then((o=>{const i=u=>{const f=Math.min(l,o.length-u);return s.getMany({trans:n,keys:o.slice(u,u+f),cache:"immutable"}).then((h=>{const d=[],m=[],y=a?[]:null,v=[];for(let e=0;e<f;++e){const t=h[e],n={value:k(t),primKey:o[u+e]};!1!==r.call(n,n.value,n)&&(null==n.value?v.push(o[u+e]):a||0===Ht(c(t),c(n.value))?(m.push(n.value),a&&y.push(o[u+e])):(v.push(o[u+e]),d.push(n.value)))}const b=Lt(t)&&t.limit===1/0&&("function"!=typeof e||e===Wt)&&{index:t.index,range:t.range};return Promise.resolve(d.length>0&&s.mutate({trans:n,type:"add",values:d}).then((e=>{for(let t in e.failures)v.splice(parseInt(t),1);p(d.length,e)}))).then((()=>(m.length>0||b&&"object"==typeof e)&&s.mutate({trans:n,type:"put",keys:y,values:m,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>p(m.length,e))))).then((()=>(v.length>0||b&&e===Wt)&&s.mutate({trans:n,type:"delete",keys:v,criteria:b}).then((e=>p(v.length,e))))).then((()=>o.length>u+f&&i(u+l)))}))};return i(0).then((()=>{if(f.length>0)throw new J("Error modifying one or more objects",f,h,d);return o.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Lt(e)&&(e.isPrimKey&&!Ct||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then((({failures:e,lastResult:n,results:r,numFailures:o})=>{if(o)throw new J("Could not delete some values",Object.keys(e).map((t=>e[t])),t-o);return t-o}))))})):this.modify(Wt)}}const Wt=(e,t)=>t.value=null;function Vt(e,t){return e<t?-1:e===t?0:1}function Jt(e,t){return e>t?-1:e===t?0:1}function Zt(e,t,n){var r=e instanceof rn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Yt(e){return new e.Collection(e,(()=>nn(""))).limit(0)}function Qt(e,t,n,r,o,i){for(var u=Math.min(e.length,r.length),s=-1,a=0;a<u;++a){var c=t[a];if(c!==r[a])return o(e[a],n[a])<0?e.substr(0,a)+n[a]+n.substr(a+1):o(e[a],r[a])<0?e.substr(0,a)+r[a]+n.substr(a+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;o(e[a],c)<0&&(s=a)}return u<r.length&&"next"===i?e+n.substr(e.length):u<e.length&&"prev"===i?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function en(e,t,n,r){var o,i,u,s,a,c,l,f=n.length;if(!n.every((e=>"string"==typeof e)))return Zt(e,Et);function h(e){o=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),i=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),u="next"===e?Vt:Jt;var t=n.map((function(e){return{lower:i(e),upper:o(e)}})).sort((function(e,t){return u(e.lower,t.lower)}));s=t.map((function(e){return e.upper})),a=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}h("next");var d=new e.Collection(e,(()=>tn(s[0],a[f-1]+r)));d._ondirectionchange=function(e){h(e)};var p=0;return d._addAlgorithm((function(e,n,r){var o=e.key;if("string"!=typeof o)return!1;var h=i(o);if(t(h,a,p))return!0;for(var d=null,m=p;m<f;++m){var y=Qt(o,h,s[m],a[m],u,c);null===y&&null===d?p=m+1:(null===d||u(d,y)>0)&&(d=y)}return n(null!==d?function(){e.continue(d+l)}:r),!1})),d}function tn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function nn(e){return{type:1,lower:e,upper:e}}class rn{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Yt(this):new this.Collection(this,(()=>tn(e,t,!n,!r)))}catch(e){return Zt(this,Dt)}}equals(e){return null==e?Zt(this,Dt):new this.Collection(this,(()=>nn(e)))}above(e){return null==e?Zt(this,Dt):new this.Collection(this,(()=>tn(e,void 0,!0)))}aboveOrEqual(e){return null==e?Zt(this,Dt):new this.Collection(this,(()=>tn(e,void 0,!1)))}below(e){return null==e?Zt(this,Dt):new this.Collection(this,(()=>tn(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Zt(this,Dt):new this.Collection(this,(()=>tn(void 0,e)))}startsWith(e){return"string"!=typeof e?Zt(this,Et):this.between(e,e+gt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):en(this,((e,t)=>0===e.indexOf(t[0])),[e],gt)}equalsIgnoreCase(e){return en(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=L.apply(R,arguments);return 0===e.length?Yt(this):en(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=L.apply(R,arguments);return 0===e.length?Yt(this):en(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,gt)}anyOf(){const e=L.apply(R,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Zt(this,Dt)}if(0===e.length)return Yt(this);const n=new this.Collection(this,(()=>tn(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,o,i)=>{const u=n.key;for(;t(u,e[r])>0;)if(++r,r===e.length)return o(i),!1;return 0===t(u,e[r])||(o((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[wt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=L.apply(R,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Zt(this,Dt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[wt,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,o=this._descending,i=this._min,u=this._max;if(0===e.length)return Yt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Zt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);const s=!t||!1!==t.includeLowers,a=t&&!0===t.includeUppers;let c,l=r;function f(e,t){return l(e[0],t[0])}try{c=e.reduce((function(e,t){let r=0,o=e.length;for(;r<o;++r){const o=e[r];if(n(t[0],o[1])<0&&n(t[1],o[0])>0){o[0]=i(o[0],t[0]),o[1]=u(o[1],t[1]);break}}return r===o&&e.push(t),e}),[]),c.sort(f)}catch(e){return Zt(this,Dt)}let h=0;const d=a?e=>r(e,c[h][1])>0:e=>r(e,c[h][1])>=0,p=s?e=>o(e,c[h][0])>0:e=>o(e,c[h][0])>=0;let m=d;const y=new this.Collection(this,(()=>tn(c[0][0],c[c.length-1][1],!s,!a)));return y._ondirectionchange=e=>{"next"===e?(m=d,l=r):(m=p,l=o),c.sort(f)},y._addAlgorithm(((e,t,n)=>{for(var o=e.key;m(o);)if(++h,h===c.length)return t(n),!1;return!!function(e){return!d(e)&&!p(e)}(o)||(0===this._cmp(o,c[h][1])||0===this._cmp(o,c[h][0])||t((()=>{l===r?e.continue(c[h][0]):e.continue(c[h][1])})),!1)})),y}startsWithAnyOf(){const e=L.apply(R,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Yt(this):this.inAnyRange(e.map((e=>[e,e+gt]))):Zt(this,"startsWithAnyOf() only works with strings")}}function on(e){return Ve((function(t){return un(t),e(t.target.error),!1}))}function un(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const sn="storagemutated",an="x-storagemutated-1",cn=Tt(null,sn);class ln{_lock(){return g(!ke.global),++this._reculock,1!==this._reculock||ke.global||(ke.lockOwnerFor=this),this}_unlock(){if(g(!ke.global),0==--this._reculock)for(ke.global||(ke.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{lt(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&ke.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(g(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(n);case"MissingAPIError":throw new ee.MissingAPI(n.message,n);default:throw new ee.OpenFailed(n)}if(!this.active)throw new ee.TransactionInactive;return g(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ve((t=>{un(t),this._reject(e.error)})),e.onabort=Ve((t=>{un(t),this.active&&this._reject(new ee.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Ve((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&cn.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return yt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return yt(new ee.TransactionInactive);if(this._locked())return new Ie(((r,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,o)},ke])}));if(n)return nt((()=>{var e=new Ie(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Ie(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Ie.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var o=t._waitingFor;return new Ie(((e,r)=>{n.then((n=>t._waitingQueue.push(Ve(e.bind(null,n)))),(e=>t._waitingQueue.push(Ve(r.bind(null,e))))).finally((()=>{t._waitingFor===o&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(c(t,e))return t[e];const n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function fn(e,t,n,r,o,i,u){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:i,src:(n&&!u?"&":"")+(r?"*":"")+(o?"++":"")+hn(t)}}function hn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function dn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:D(n,(e=>[e.name,e]))}}let pn=e=>{try{return e.only([[]]),pn=()=>[[]],[[]]}catch(e){return pn=()=>gt,gt}};function mn(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>E(t,e)}(e):t=>E(t,e)}function yn(e){return[].slice.call(e)}let vn=0;function bn(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function gn(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:o,upperOpen:i}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!i):void 0===r?t.lowerBound(n,!!o):t.bound(n,r,!!o,!!i)}const{schema:o,hasGetAll:u}=function(e,t){const n=yn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=i(t),o=null==t,u={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:mn(t)},indexes:yn(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:o}=e,s={name:t,compound:i(o),keyPath:o,unique:n,multiEntry:r,extractKey:mn(o)};return u[bn(o)]=s,s})),getIndexByKeyPath:e=>u[bn(e)]};return u[":id"]=s.primaryKey,null!=t&&(u[bn(t)]=s.primaryKey),s}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),s=o.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:o,values:i,range:u}){return new Promise(((s,a)=>{s=Ve(s);const c=e.objectStore(t),l=null==c.keyPath,f="put"===n||"add"===n;if(!f&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:h}=o||i||{length:1};if(o&&i&&o.length!==i.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return s({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const p=[],m=[];let y=0;const v=e=>{++y,un(e)};if("deleteRange"===n){if(4===u.type)return s({numFailures:y,failures:m,results:[],lastResult:void 0});3===u.type?p.push(d=c.clear()):p.push(d=c.delete(r(u)))}else{const[e,t]=f?l?[i,o]:[i,null]:[o,null];if(f)for(let r=0;r<h;++r)p.push(d=t&&void 0!==t[r]?c[n](e[r],t[r]):c[n](e[r])),d.onerror=v;else for(let t=0;t<h;++t)p.push(d=c[n](e[t])),d.onerror=v}const b=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(m[t]=e.error))),s({numFailures:y,failures:m,results:"delete"===n?o:p.map((e=>e.result)),lastResult:t})};d.onerror=e=>{v(e),b(e)},d.onsuccess=b}))},getMany:({trans:e,keys:n})=>new Promise(((r,o)=>{r=Ve(r);const i=e.objectStore(t),u=n.length,s=new Array(u);let a,c=0,l=0;const f=e=>{const t=e.target;s[t._pos]=t.result,++l===c&&r(s)},h=on(o);for(let e=0;e<u;++e)null!=n[e]&&(a=i.get(n[e]),a._pos=e,a.onsuccess=f,a.onerror=h,++c);0===c&&r(s)})),get:({trans:e,key:n})=>new Promise(((r,o)=>{r=Ve(r);const i=e.objectStore(t).get(n);i.onsuccess=e=>r(e.target.result),i.onerror=on(o)})),query:function(e){return n=>new Promise(((o,i)=>{o=Ve(o);const{trans:u,values:s,limit:a,query:c}=n,l=a===1/0?void 0:a,{index:f,range:h}=c,d=u.objectStore(t),p=f.isPrimaryKey?d:d.index(f.name),m=r(h);if(0===a)return o({result:[]});if(e){const e=s?p.getAll(m,l):p.getAllKeys(m,l);e.onsuccess=e=>o({result:e.target.result}),e.onerror=on(i)}else{let e=0;const t=s||!("openKeyCursor"in p)?p.openCursor(m):p.openKeyCursor(m),n=[];t.onsuccess=r=>{const i=t.result;return i?(n.push(s?i.value:i.primaryKey),++e===a?o({result:n}):void i.continue()):o({result:n})},t.onerror=on(i)}}))}(u),openCursor:function({trans:e,values:n,query:o,reverse:i,unique:u}){return new Promise(((s,a)=>{s=Ve(s);const{index:c,range:l}=o,f=e.objectStore(t),h=c.isPrimaryKey?f:f.index(c.name),d=i?u?"prevunique":"prev":u?"nextunique":"next",p=n||!("openKeyCursor"in h)?h.openCursor(r(l),d):h.openKeyCursor(r(l),d);p.onerror=on(a),p.onsuccess=Ve((t=>{const n=p.result;if(!n)return void s(null);n.___id=++vn,n.done=!1;const r=n.continue.bind(n);let o=n.continuePrimaryKey;o&&(o=o.bind(n));const i=n.advance.bind(n),u=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Ve(a),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=Ve(e),p.onerror=on(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=u,e(t)}})),s=()=>{if(p.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return p.onsuccess=Ve((e=>{p.onsuccess=s,s()})),n.continue=r,n.continuePrimaryKey=o,n.advance=i,s(),t},s(n)}),a)}))},count({query:e,trans:n}){const{index:o,range:i}=e;return new Promise(((e,u)=>{const s=n.objectStore(t),a=o.isPrimaryKey?s:s.index(o.name),c=r(i),l=c?a.count(c):a.count();l.onsuccess=Ve((t=>e(t.target.result))),l.onerror=on(u)}))}}}(e))),a={};return s.forEach((e=>a[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!a[e])throw new Error(`Table '${e}' not found`);return a[e]},MIN_KEY:-1/0,MAX_KEY:pn(t),schema:o}}function wn({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},o){const i=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(gn(t,n,o),e.dbcore);return{dbcore:i}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function Dn({_novip:e},t,n,r){n.forEach((n=>{const o=r[n];t.forEach((t=>{const r=m(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?h(t,n,{get(){return this.table(n)},set(e){f(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,o))}))}))}function En({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function _n(e,t){return e._cfg.version-t._cfg.version}function xn(e,t,n,r){const i=e._dbSchema,u=e._createTransaction("readwrite",e._storeNames,i);u.create(n),u._completion.catch(r);const s=u._reject.bind(u),a=ke.transless||ke;nt((()=>{ke.trans=u,ke.transless=a,0===t?(o(i).forEach((e=>{Cn(n,e,i[e].primKey,i[e].indexes)})),wn(e,n),Ie.follow((()=>e.on.populate.fire(u))).catch(s)):function({_novip:e},t,n,r){const i=[],u=e._versions;let s=e._dbSchema=Sn(0,e.idbdb,r),a=!1;const c=u.filter((e=>e._cfg.version>=t));return c.forEach((u=>{i.push((()=>{const i=s,c=u._cfg.dbschema;On(e,i,r),On(e,c,r),s=e._dbSchema=c;const l=An(i,c);l.add.forEach((e=>{Cn(r,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((e=>{if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>Fn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),Fn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const f=u._cfg.contentUpgrade;if(f&&u._cfg.version>t){wn(e,r),n._memoizedTables={},a=!0;let t=x(c);l.del.forEach((e=>{t[e]=i[e]})),En(e,[e.Transaction.prototype]),Dn(e,[e.Transaction.prototype],o(t),t),n.schema=t;const u=M(f);let s;u&&rt();const h=Ie.follow((()=>{if(s=f(n),s&&u){var e=ot.bind(null,null);s.then(e,e)}}));return s&&"function"==typeof s.then?Ie.resolve(s):h.then((()=>s))}})),i.push((t=>{a&&At||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(u._cfg.dbschema,t),En(e,[e.Transaction.prototype]),Dn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return i.length?Ie.resolve(i.shift()(n.idbtrans)).then(e):Ie.resolve()}().then((()=>{var e,t;t=r,o(e=s).forEach((n=>{t.db.objectStoreNames.contains(n)||Cn(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,u,n).catch(s)}))}function An(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const o=e[r],i=t[r];if(o){const e={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||o.primKey.auto!==i.primKey.auto&&!xt)e.recreate=!0,n.change.push(e);else{const t=o.idxByName,r=i.idxByName;let u;for(u in t)r[u]||e.del.push(u);for(u in r){const n=t[u],o=r[u];n?n.src!==o.src&&e.change.push(o):e.add.push(o)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,i])}return n}function Cn(e,t,n,r){const o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>Fn(o,e))),o}function Fn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Sn(e,t,n){const r={};return v(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let o=t.keyPath;const i=fn(hn(o),o||"",!1,!1,!!t.autoIncrement,o&&"string"!=typeof o,!0),u=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);o=n.keyPath;var s=fn(n.name,o,!!n.unique,!!n.multiEntry,!1,o&&"string"!=typeof o,!1);u.push(s)}r[e]=dn(e,i,u)})),r}function On({_novip:e},t,n){const o=n.db.objectStoreNames;for(let r=0;r<o.length;++r){const i=o[r],u=n.objectStore(i);e._hasGetAll="getAll"in u;for(let e=0;e<u.indexNames.length;++e){const n=u.indexNames[e],r=u.index(n).keyPath,o="string"==typeof r?r:"["+v(r).join("+")+"]";if(t[i]){const e=t[i].idxByName[o];e&&(e.name=n,delete t[i].idxByName[o],t[i].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class kn{_parseStoresSpec(e,t){o(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return fn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),i(r),0===t)})),o=r.shift();if(o.multi)throw new ee.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")})),t[n]=dn(n,o,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,e):e;const n=t._versions,r={};let i={};return n.forEach((e=>{u(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,En(t,[t._allTables,t,t.Transaction.prototype]),Dn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],o(i),i),t._storeNames=o(i),this}upgrade(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||re,e),this}}function Bn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Qn(St,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Pn(e){return e&&"function"==typeof e.databases}function jn(e){return nt((function(){return ke.letThrough=!0,e()}))}function In(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Tn(e){var t=t=>e.next(t),n=o(t),r=o((t=>e.throw(t)));function o(e){return t=>{var o=e(t),u=o.value;return o.done?u:u&&"function"==typeof u.then?u.then(n,r):i(u)?Promise.all(u).then(n,r):n(u)}}return o(t)()}function Rn(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];return n=o.pop(),[e,C(o),n]}function Ln(e,t,n,r,o){return Ie.resolve().then((()=>{const i=ke.transless||ke,u=e._createTransaction(t,n,e._dbSchema,r),s={trans:u,transless:i};if(r)u.idbtrans=r.idbtrans;else try{u.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===Y.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Ln(e,t,n,null,o)))):yt(r)}const a=M(o);let c;a&&rt();const l=Ie.follow((()=>{if(c=o.call(u,u),c)if(a){var e=ot.bind(null,null);c.then(e,e)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=Tn(c))}),s);return(c&&"function"==typeof c.then?Ie.resolve(c).then((e=>u.active?e:yt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>c))).then((e=>(r&&u._resolve(),u._completion.then((()=>e))))).catch((e=>(u._reject(e),yt(e))))}))}function Mn(e,t,n){const r=i(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Nn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,o={},i=[];function u(e,t,n){const r=bn(e),s=o[r]=o[r]||[],a=null==e?0:"string"==typeof e?1:e.length,c=t>0,l={...n,isVirtual:c,keyTail:t,keyLength:a,extractKey:mn(e),unique:!c&&n.unique};return s.push(l),l.isPrimaryKey||i.push(l),a>1&&u(2===a?e[0]:e.slice(0,a-1),t+1,n),s.sort(((e,t)=>e.keyTail-t.keyTail)),l}const s=u(r.primaryKey.keyPath,0,r.primaryKey);o[":id"]=[s];for(const e of r.indexes)u(e.keyPath,0,e);function a(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,o=n.keyTail,{type:1===r.type?2:r.type,lower:Mn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,o),lowerOpen:!0,upper:Mn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,o),upperOpen:!0})}}:t;var r,o}const c={...n,schema:{...r,primaryKey:s,indexes:i,getIndexByKeyPath:function(e){const t=o[bn(e)];return t&&t[0]}},count:e=>n.count(a(e)),query:e=>n.query(a(e)),openCursor(t){const{keyTail:r,isVirtual:o,keyLength:i}=t.query.index;return o?n.openCursor(a(t)).then((n=>n&&function(n){const o=Object.create(n,{continue:{value:function(o){null!=o?n.continue(Mn(o,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,i).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,o){n.continuePrimaryKey(Mn(t,e.MAX_KEY,r),o)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:()=>n.value}});return o}(n))):n.openCursor(t)}};return c}}}};function qn(e,t,n,r){return n=n||{},r=r||"",o(e).forEach((o=>{if(c(t,o)){var i=e[o],u=t[o];if("object"==typeof i&&"object"==typeof u&&i&&u){const e=j(i);e!==j(u)?n[r+o]=t[o]:"Object"===e?qn(i,u,n,r+o+"."):i!==u&&(n[r+o]=t[o])}else i!==u&&(n[r+o]=t[o])}else n[r+o]=void 0})),o(t).forEach((o=>{c(e,o)||(n[r+o]=t[o])})),n}const Kn={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,o={...n,mutate(e){const o=ke.trans,{deleting:i,creating:u,updating:s}=o.table(t).hook;switch(e.type){case"add":if(u.fire===re)break;return o._promise("readwrite",(()=>a(e)),!0);case"put":if(u.fire===re&&s.fire===re)break;return o._promise("readwrite",(()=>a(e)),!0);case"delete":if(i.fire===re)break;return o._promise("readwrite",(()=>a(e)),!0);case"deleteRange":if(i.fire===re)break;return o._promise("readwrite",(()=>function(e){return l(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function a(e){const t=ke.trans,o=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!o)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:o}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,o).then((a=>{const l=o.map(((n,o)=>{const l=a[o],f={onerror:null,onsuccess:null};if("delete"===e.type)i.fire.call(f,n,l,t);else if("add"===e.type||void 0===l){const i=u.fire.call(f,n,e.values[o],t);null==n&&null!=i&&(n=i,e.keys[o]=n,r.outbound||_(e.values[o],r.keyPath,n))}else{const r=qn(l,e.values[o]),i=s.fire.call(f,r,n,l,t);if(i){const t=e.values[o];Object.keys(i).forEach((e=>{c(t,e)?t[e]=i[e]:_(t,e,i[e])}))}}return f}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:i})=>{for(let r=0;r<o.length;++r){const i=n?n[r]:o[r],u=l[r];null==i?u.onerror&&u.onerror(t[r]):u.onsuccess&&u.onsuccess("put"===e.type&&a[r]?e.values[r]:i)}return{failures:t,results:n,numFailures:r,lastResult:i}})).catch((e=>(l.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function l(e,t,o){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:o}).then((({result:n})=>a({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<o?{failures:[],numFailures:0,lastResult:void 0}:l(e,{...t,lower:n[n.length-1],lowerOpen:!0},o)))))}}};return o}})};function Un(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let o=0,i=0;o<t.keys.length&&i<e.length;++o)0===Ht(t.keys[o],e[i])&&(r.push(n?k(t.values[o]):t.values[o]),++i);return r.length===e.length?r:null}catch(e){return null}}const $n={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=Un(e.keys,e.trans._cache,"clone"===e.cache);return t?Ie.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?k(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Hn(e){return!("from"in e)}const Gn=function(e,t){if(!this){const t=new Gn;return e&&"d"in e&&u(t,e),t}u(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Xn(e,t,n){const r=Ht(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Hn(e))return u(e,{from:t,to:n,d:1});const o=e.l,i=e.r;if(Ht(n,e.from)<0)return o?Xn(o,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Jn(e);if(Ht(t,e.to)>0)return i?Xn(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Jn(e);Ht(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),Ht(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const s=!e.r;o&&!e.l&&zn(e,o),i&&s&&zn(e,i)}function zn(e,t){Hn(t)||function e(t,{from:n,to:r,l:o,r:i}){Xn(t,n,r),o&&e(t,o),i&&e(t,i)}(e,t)}function Wn(e,t){const n=Vn(t);let r=n.next();if(r.done)return!1;let o=r.value;const i=Vn(e);let u=i.next(o.from),s=u.value;for(;!r.done&&!u.done;){if(Ht(s.from,o.to)<=0&&Ht(s.to,o.from)>=0)return!0;Ht(o.from,s.from)<0?o=(r=n.next(s.from)).value:s=(u=i.next(o.from)).value}return!1}function Vn(e){let t=Hn(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Ht(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Ht(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Jn(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),o=r>1?"r":r<-1?"l":"";if(o){const t="r"===o?"l":"r",n={...e},r=e[o];e.from=r.from,e.to=r.to,e[o]=r[o],n[o]=r[t],e[t]=n,n.d=Zn(n)}e.d=Zn(e)}function Zn({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}l(Gn.prototype,{add(e){return zn(this,e),this},addKey(e){return Xn(this,e,e),this},addKeys(e){return e.forEach((e=>Xn(this,e,e))),this},[I](){return Vn(this)}});const Yn={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Gn(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const u=e.table(r),{schema:s}=u,{primaryKey:a}=s,{extractKey:c,outbound:l}=a,f={...u,mutate:e=>{const o=e.trans,a=o.mutatedParts||(o.mutatedParts={}),c=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new Gn)},l=c(""),f=c(":dels"),{type:h}=e;let[d,p]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const m=e.trans._cache;return u.mutate(e).then((e=>{if(i(d)){"delete"!==h&&(d=e.results),l.addKeys(d);const t=Un(d,m);t||"add"===h||f.addKeys(d),(t||p)&&function(e,t,n,r){t.indexes.forEach((function(t){const o=e(t.name||"");function u(e){return null!=e?t.extractKey(e):null}const s=e=>t.multiEntry&&i(e)?e.forEach((e=>o.addKey(e))):o.addKey(e);(n||r).forEach(((e,t)=>{const o=n&&u(n[t]),i=r&&u(r[t]);0!==Ht(o,i)&&(null!=o&&s(o),null!=i&&s(i))}))}))}(c,s,t,p)}else if(d){const e={from:d.lower,to:d.upper};f.add(e),l.add(e)}else l.add(n),f.add(n),s.indexes.forEach((e=>c(e.name).add(n)));return e}))}},h=({query:{index:t,range:n}})=>{var r,o;return[t,new Gn(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(o=n.upper)&&void 0!==o?o:e.MAX_KEY)]},d={get:e=>[a,new Gn(e.key)],getMany:e=>[a,(new Gn).addKeys(e.keys)],count:h,query:h,openCursor:h};return o(d).forEach((e=>{f[e]=function(o){const{subscr:i}=ke;if(i){const s=e=>{const n=`idb://${t}/${r}/${e}`;return i[n]||(i[n]=new Gn)},a=s(""),f=s(":dels"),[h,p]=d[e](o);if(s(h.name||"").add(p),!h.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&o.values&&u.query({...o,values:!1});return u[e].apply(this,arguments).then((n=>{if("query"===e){if(l&&o.values)return t.then((({result:e})=>(a.addKeys(e),n)));const e=o.values?n.result.map(c):n.result;o.values?a.addKeys(e):f.addKeys(e)}else if("openCursor"===e){const e=n,t=o.values;return e&&Object.create(e,{key:{get:()=>(f.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return f.addKey(t),t}},value:{get:()=>(t&&a.addKey(e.primaryKey),e.value)}})}return n}))}f.add(n)}}return u[e].apply(this,arguments)}})),f}}}};class Qn{constructor(e,t){this._middlewares={},this.verno=0;const n=Qn.dependencies;this._options=t={addons:Qn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:re,dbReadyPromise:null,cancelOpen:re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var i;o.dbReadyPromise=new Ie((e=>{o.dbReadyResolve=e})),o.openCanceller=new Ie(((e,t)=>{o.cancelOpen=t})),this._state=o,this.name=e,this.on=Tt(this,"populate","blocked","versionchange","close",{ready:[fe,re]}),this.on.ready.subscribe=b(this.on.ready.subscribe,(e=>(t,n)=>{Qn.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Ie.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=(i=this,Rt(zt.prototype,(function(e,t){this.db=i;let n=Pt,r=null;if(t)try{n=t()}catch(e){r=e}const o=e._ctx,u=o.table,s=u.hook.reading.fire;this._ctx={table:u,index:o.index,isPrimKey:!o.index||u.schema.primKey.keyPath&&o.index===u.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:s!==oe?s:null}}))),this.Table=function(e){return Rt(It.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Tt(null,{creating:[se,re],reading:[ie,oe],updating:[ce,re],deleting:[ae,re]})}))}(this),this.Transaction=function(e){return Rt(ln.prototype,(function(t,n,r,o,i){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Tt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),yt(e)}))}))}(this),this.Version=function(e){return Rt(kn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Rt(rn.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const o=e._deps.indexedDB;if(!o)throw new ee.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(e,t)=>o.cmp(t,e),this._max=(e,t)=>o.cmp(e,t)>0?e:t,this._min=(e,t)=>o.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=pn(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),_t.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Nn),this.use(Kn),this.use(Yn),this.use($n),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(_n),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||ke.letThrough||this._vip)?e():new Ie(((e,t)=>{if(this._state.openComplete)return t(new ee.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new ee.DatabaseClosed);this.open().catch(re)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:t,level:null==n?10:n,name:r}),o.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?yt(t.dbOpenError):e));N&&(t.openCanceller._stackHolder=$()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new ee.DatabaseClosed("db.open() was cancelled")}let u=t.dbReadyResolve,s=null,a=!1;return Ie.race([r,("undefined"==typeof navigator?Ie.resolve():In()).then((()=>new Ie(((r,u)=>{if(i(),!n)throw new ee.MissingAPI;const c=e.name,l=t.autoSchema?n.open(c):n.open(c,Math.round(10*e.verno));if(!l)throw new ee.MissingAPI;l.onerror=on(u),l.onblocked=Ve(e._fireOnBlocked),l.onupgradeneeded=Ve((r=>{if(s=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=un,s.abort(),l.result.close();const e=n.deleteDatabase(c);e.onsuccess=e.onerror=Ve((()=>{u(new ee.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{s.onerror=on(u);var o=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=o<1,e._novip.idbdb=l.result,xn(e,o/10,s,u)}}),u),l.onsuccess=Ve((()=>{s=null;const n=e._novip.idbdb=l.result,i=v(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(u=i).length?u[0]:u,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=Sn(0,t,n);e._storeNames=v(t.objectStoreNames,0),Dn(e,[e._allTables],o(r),r)}(e,n,r):(On(e,e._dbSchema,r),function(e,t){const n=An(Sn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),wn(e,r)}catch(e){}var u;_t.push(e),n.onversionchange=Ve((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=Ve((t=>{e.on("close").fire(t)})),a&&function({indexedDB:e,IDBKeyRange:t},n){!Pn(e)&&n!==St&&Bn(e,t).put({name:n}).catch(re)}(e._deps,c),r()}),u)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Ie.resolve(jn((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(fe,re);return t.onReadyBeingFired=[],Ie.resolve(jn((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{s&&s.abort()}catch(e){}return r===t.openCanceller&&e._close(),yt(n)})).finally((()=>{t.openComplete=!0,u()}))}(this)}_close(){const e=this._state,t=_t.indexOf(this);if(t>=0&&_t.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ie((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ie(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new ee.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ie(((n,r)=>{const o=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Ve((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!Pn(e)&&n!==St&&Bn(e,t).delete(n).catch(re)}(this._deps,this.name),n()})),e.onerror=on(r),e.onblocked=this._fireOnBlocked};if(e)throw new ee.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(o):o()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return o(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Rn.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=ke.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const o=-1!==e.indexOf("?");let i,u;e=e.replace("!","").replace("?","");try{if(u=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Ot)i=Ot;else{if("rw"!=e&&e!=kt)throw new ee.InvalidArgument("Invalid transaction mode: "+e);i=kt}if(r){if(r.mode===Ot&&i===kt){if(!o)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&u.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!o)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),o&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):yt(e)}const s=Ln.bind(null,this,i,u,r,n);return r?r._promise(i,s,"lock"):ke.trans?lt(ke.transless,(()=>this._whenReady(s))):this._whenReady(s)}table(e){if(!c(this._allTables,e))throw new ee.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const er="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class tr{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[er](){return this}}function nr(e,t){return o(t).forEach((n=>{zn(e[n]||(e[n]=new Gn),t[n])})),e}function rr(e){let t,n=!1;const r=new tr((r=>{const i=M(e);let u=!1,s={},a={};const c={get closed(){return u},unsubscribe:()=>{u=!0,cn.storagemutated.unsubscribe(d)}};r.start&&r.start(c);let l=!1,f=!1;function h(){return o(a).some((e=>s[e]&&Wn(s[e],a[e])))}const d=e=>{nr(s,e),h()&&p()},p=()=>{if(l||u)return;s={};const o={},m=function(t){i&&rt();const n=()=>nt(e,{subscr:t,trans:null}),r=ke.trans?lt(ke.transless,n):n();return i&&r.then(ot,ot),r}(o);f||(cn(sn,d),f=!0),l=!0,Promise.resolve(m).then((e=>{n=!0,t=e,l=!1,u||(h()?p():(s={},a=o,r.next&&r.next(e)))}),(e=>{l=!1,n=!1,r.error&&r.error(e),c.unsubscribe()}))};return p(),c}));return r.hasValue=()=>n,r.getValue=()=>t,r}let or;try{or={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch(r){or={indexedDB:null,IDBKeyRange:null}}const ir=Qn;function ur(e){let t=sr;try{sr=!0,cn.storagemutated.fire(e)}finally{sr=t}}l(ir,{...ne,delete:e=>new ir(e,{addons:[]}).delete(),exists:e=>new ir(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Pn(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>e!==St)))):Bn(e,t).toCollection().primaryKeys()}(ir.dependencies).then(e)}catch(e){return yt(new ee.MissingAPI)}},defineClass:()=>function(e){u(this,e)},ignoreTransaction:e=>ke.trans?lt(ke.transless,e):e(),vip:jn,async:function(e){return function(){try{var t=Tn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ie.resolve(t)}catch(e){return yt(e)}}},spawn:function(e,t,n){try{var r=Tn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ie.resolve(r)}catch(e){return yt(e)}},currentTransaction:{get:()=>ke.trans||null},waitFor:function(e,t){const n=Ie.resolve("function"==typeof e?ir.ignoreTransaction(e):e).timeout(t||6e4);return ke.trans?ke.trans.waitFor(n):n},Promise:Ie,debug:{get:()=>N,set:e=>{q(e,"dexie"===e?()=>!0:Ft)}},derive:d,extend:u,props:l,override:b,Events:Tt,on:cn,liveQuery:rr,extendObservabilitySet:nr,getByKeyPath:E,setByKeyPath:_,delByKeyPath:function(e,t){"string"==typeof t?_(e,t,void 0):"length"in t&&[].map.call(t,(function(t){_(e,t,void 0)}))},shallowClone:x,deepClone:k,getObjectDiff:qn,cmp:Ht,asap:w,minKey:wt,addons:[],connections:_t,errnames:Y,dependencies:or,semVer:bt,version:bt.split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),ir.maxKey=pn(ir.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(cn(sn,(e=>{if(!sr){let t;xt?(t=document.createEvent("CustomEvent"),t.initCustomEvent(an,!0,!0,e)):t=new CustomEvent(an,{detail:e}),sr=!0,dispatchEvent(t),sr=!1}})),addEventListener(an,(({detail:e})=>{sr||ur(e)})));let sr=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel(an);"function"==typeof e.unref&&e.unref(),cn(sn,(t=>{sr||e.postMessage(t)})),e.onmessage=e=>{e.data&&ur(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){cn(sn,(e=>{try{sr||("undefined"!=typeof localStorage&&localStorage.setItem(an,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:an,changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if(e.key===an){const t=JSON.parse(e.newValue);t&&ur(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&e.type===an&&ur(e.changedParts)}))}Ie.rejectionMapper=function(e,t){if(!e||e instanceof W||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&h(n,"stack",{get:function(){return this.inner.stack}}),n},q(N,Ft)},55658:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});class r{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}},29987:(e,t,n)=>{"use strict";n.d(t,{$B:()=>r.$B,Ct:()=>r.Ct,Pz:()=>r.Pz,QQ:()=>r.QQ,Rz:()=>r.Rz,Uw:()=>r.Uw,he:()=>r.he,pF:()=>r.pF,us:()=>r.us});var r=n(37244),o=n(70035);r.pF||r.YR(o.O(),{auto:!0})},37244:(e,t,n)=>{"use strict";n.d(t,{$B:()=>u,Ct:()=>i,Pz:()=>s,QQ:()=>f,Rz:()=>l,Uw:()=>a,YR:()=>v,he:()=>o,pF:()=>r,us:()=>c});let r,o,i,u,s,a,c,l,f,h=!1,d=null,p=null,m=null,y=null;function v(e,t={auto:!1}){if(h)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(r)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${r}'\``);h=t.auto,r=e.kind,o=e.fetch,d=e.Request,p=e.Response,m=e.Headers,i=e.FormData,y=e.Blob,u=e.File,s=e.ReadableStream,a=e.getMultipartRequestOptions,c=e.getDefaultAgent,l=e.fileFromPath,f=e.isFsReadStream}},70035:(e,t,n)=>{"use strict";n.d(t,{O:()=>o});var r=n(55658);function o({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,o,i,u;try{n=fetch,o=Request,i=Response,u=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:o,Response:i,Headers:u,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new r.I(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}},2475:(e,t,n)=>{"use strict";n.d(t,{FO:()=>h,Fb:()=>B,WB:()=>F,_v:()=>x,a1:()=>C,lP:()=>f,my:()=>y});var r,o=n(33817),i=n(46409),u=n(59775),s=n(29987),a=n(35993);async function c(e){const{response:t}=e;if(e.options.stream)return O("response",t.status,t.url,t.headers,t.body),i.F.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")){const e=await t.json();return O("response",t.status,t.url,t.headers,e),e}const r=await t.text();return O("response",t.status,t.url,t.headers,r),r}class l extends Promise{constructor(e,t=c){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new l(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class f{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:o}){this.baseURL=e,this.maxRetries=A("maxRetries",t),this.timeout=A("timeout",n),this.httpAgent=r,this.fetch=o??s.he}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...w(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${k()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((n=>({method:e,path:t,...n}))))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}return null}buildRequest(e){const{method:t,path:n,query:r,headers:o={}}=e,i=(0,a.YT)(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(i),c=this.buildURL(n,r);"timeout"in e&&A("timeout",e.timeout);const l=e.timeout??this.timeout,f=e.httpAgent??this.httpAgent??(0,s.us)(c),h=l+1e3;"number"==typeof f?.options?.timeout&&h>(f.options.timeout??0)&&(f.options.timeout=h),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const d={...u&&{"Content-Length":u},...this.defaultHeaders(e),...o};(0,a.YT)(e.body)&&"node"!==s.pF&&delete d["Content-Type"],Object.keys(d).forEach((e=>null===d[e]&&delete d[e]));const p={method:t,...i&&{body:i},headers:d,...f&&{agent:f},signal:e.signal??null};return this.validateHeaders(d,o),{req:p,url:c,timeout:l}}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return u.APIError.generate(e,t,n,r)}request(e,t=null){return new l(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e;null==t&&(t=n.maxRetries??this.maxRetries);const{req:r,url:o,timeout:i}=this.buildRequest(n);if(await this.prepareRequest(r,{url:o,options:n}),O("request",o,n,r.headers),n.signal?.aborted)throw new u.APIUserAbortError;const s=new AbortController,a=await this.fetchWithTimeout(o,r,i,s).catch(C);if(a instanceof Error){if(n.signal?.aborted)throw new u.APIUserAbortError;if(t)return this.retryRequest(n,t);if("AbortError"===a.name)throw new u.APIConnectionTimeoutError;throw new u.APIConnectionError({cause:a})}const c=p(a.headers);if(!a.ok){if(t&&this.shouldRetry(a))return this.retryRequest(n,t,c);const e=await a.text().catch((e=>C(e).message)),r=D(e),i=r?void 0:e;throw O("response",a.status,o,c,i),this.makeStatusError(a.status,r,i,c)}return{response:a,options:n,controller:s}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new d(this,n,e)}buildURL(e,t){const n=_(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return S(r)||(t={...r,...t}),t&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new u.OpenAIError(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:o,...i}=t||{};o&&o.addEventListener("abort",(()=>r.abort()));const u=setTimeout((()=>r.abort()),n);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...i}).finally((()=>{clearTimeout(u)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,n){let r;const o=n?.["retry-after"];if(o){const e=parseInt(o);r=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!r||!Number.isInteger(r)||r<=0||r>6e4){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await x(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${o.q}`}}class h{constructor(e,t,n,o){r.set(this,void 0),function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?o.call(e,n):o?o.value=n:t.set(e,n)}(this,r,e,"f"),this.options=o,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new u.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,r,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(r=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class d extends l{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await c(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const p=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),m={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0},y=e=>"object"==typeof e&&null!==e&&!S(e)&&Object.keys(e).every((e=>function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(m,e))),v=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",b=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let g;const w=()=>g??(g=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.q,"X-Stainless-OS":b(Deno.build.os),"X-Stainless-Arch":v(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.q,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.q,"X-Stainless-OS":b(process.platform),"X-Stainless-Arch":v(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.q,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.q,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),D=e=>{try{return JSON.parse(e)}catch(e){return}},E=new RegExp("^(?:[a-z]+:)?//","i"),_=e=>E.test(e),x=e=>new Promise((t=>setTimeout(t,e))),A=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new u.OpenAIError(`${e} must be an integer`);if(t<0)throw new u.OpenAIError(`${e} must be a positive integer`);return t},C=e=>e instanceof Error?e:new Error(e),F=e=>"undefined"!=typeof process?process.env?.[e]??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e):void 0;function S(e){if(!e)return!0;for(const t in e)return!1;return!0}function O(e,...t){"undefined"!=typeof process&&"true"===process.env.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}const k=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),B=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator},59775:(e,t,n)=>{"use strict";n.d(t,{APIConnectionError:()=>s,APIConnectionTimeoutError:()=>a,APIError:()=>i,APIUserAbortError:()=>u,AuthenticationError:()=>l,BadRequestError:()=>c,ConflictError:()=>d,InternalServerError:()=>y,NotFoundError:()=>h,OpenAIError:()=>o,PermissionDeniedError:()=>f,RateLimitError:()=>m,UnprocessableEntityError:()=>p});var r=n(2475);class o extends Error{}class i extends o{constructor(e,t,n,r){super(`${i.makeMessage(e,t,n)}`),this.status=e,this.headers=r;const o=t;this.error=o,this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,o){if(!e)return new s({cause:(0,r.a1)(t)});const u=t?.error;return 400===e?new c(e,u,n,o):401===e?new l(e,u,n,o):403===e?new f(e,u,n,o):404===e?new h(e,u,n,o):409===e?new d(e,u,n,o):422===e?new p(e,u,n,o):429===e?new m(e,u,n,o):e>=500?new y(e,u,n,o):new i(e,u,n,o)}}class u extends i{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class s extends i{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class a extends s{constructor({message:e}={}){super({message:e??"Request timed out."})}}class c extends i{constructor(){super(...arguments),this.status=400}}class l extends i{constructor(){super(...arguments),this.status=401}}class f extends i{constructor(){super(...arguments),this.status=403}}class h extends i{constructor(){super(...arguments),this.status=404}}class d extends i{constructor(){super(...arguments),this.status=409}}class p extends i{constructor(){super(...arguments),this.status=422}}class m extends i{constructor(){super(...arguments),this.status=429}}class y extends i{}},45468:(e,t,n)=>{"use strict";n.d(t,{Pp:()=>D});var r,o=n(2475),i=n(31120),u=n(59775),s=n(35993),a=n(29987),c=n(93102),l=n(34084),f=n(52953),h=n(69682),d=n(57883),p=n(20993),m=n(93958),y=n(61628),v=n(15520),b=n(2662),g=n(99337),w=n(94973);class D extends o.lP{constructor({baseURL:e=o.WB("OPENAI_BASE_URL"),apiKey:t=o.WB("OPENAI_API_KEY"),organization:n=o.WB("OPENAI_ORG_ID")??null,...r}={}){if(void 0===t)throw new u.OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,...r,baseURL:e??"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&o.Fb())throw new u.OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new c.c(this),this.chat=new l.e(this),this.edits=new f.I(this),this.embeddings=new h.J(this),this.files=new d.h(this),this.images=new p.r(this),this.audio=new m.B(this),this.moderations=new y.k(this),this.models=new v.k(this),this.fineTuning=new b._(this),this.fineTunes=new g.y(this),this.beta=new w.c(this),this._options=i,this.apiKey=t,this.organization=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}r=D,D.OpenAI=r,D.OpenAIError=u.OpenAIError,D.APIError=u.APIError,D.APIConnectionError=u.APIConnectionError,D.APIConnectionTimeoutError=u.APIConnectionTimeoutError,D.APIUserAbortError=u.APIUserAbortError,D.NotFoundError=u.NotFoundError,D.ConflictError=u.ConflictError,D.RateLimitError=u.RateLimitError,D.BadRequestError=u.BadRequestError,D.AuthenticationError=u.AuthenticationError,D.InternalServerError=u.InternalServerError,D.PermissionDeniedError=u.PermissionDeniedError,D.UnprocessableEntityError=u.UnprocessableEntityError;const{OpenAIError:E,APIError:_,APIConnectionError:x,APIConnectionTimeoutError:A,APIUserAbortError:C,NotFoundError:F,ConflictError:S,RateLimitError:O,BadRequestError:k,AuthenticationError:B,InternalServerError:P,PermissionDeniedError:j,UnprocessableEntityError:I}=u;s.Vw,a.Rz,function(e){e.toFile=s.Vw,e.fileFromPath=a.Rz,e.Page=i.T,e.CursorPage=i.j,e.Completions=c.c,e.Chat=l.e,e.Edits=f.I,e.Embeddings=h.J,e.Files=d.h,e.FileObjectsPage=d.q,e.Images=p.r,e.Audio=m.B,e.Moderations=y.k,e.Models=v.k,e.ModelsPage=v.i,e.FineTuning=b._,e.FineTunes=g.y,e.FineTunesPage=g.Y,e.Beta=w.c}(D||(D={}))},84458:(e,t,n)=>{"use strict";n.d(t,{K:()=>O});var r,o,i,u,s,a,c,l,f,h,d,p,m,y,v,b,g,w,D,E,_=n(59775),x=n(93961),A=n(53413),C=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},F=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const S=10;class O{constructor(){r.add(this),this.controller=new AbortController,o.set(this,void 0),i.set(this,(()=>{})),u.set(this,(()=>{})),s.set(this,void 0),a.set(this,(()=>{})),c.set(this,(()=>{})),l.set(this,{}),this._chatCompletions=[],this.messages=[],f.set(this,!1),h.set(this,!1),d.set(this,!1),p.set(this,!1),w.set(this,(e=>{if(C(this,h,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new _.APIUserAbortError),e instanceof _.APIUserAbortError)return C(this,d,!0,"f"),this._emit("abort",e);if(e instanceof _.OpenAIError)return this._emit("error",e);if(e instanceof Error){const t=new _.OpenAIError(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new _.OpenAIError(String(e)))})),C(this,o,new Promise(((e,t)=>{C(this,i,e,"f"),C(this,u,t,"f")})),"f"),C(this,s,new Promise(((e,t)=>{C(this,a,e,"f"),C(this,c,t,"f")})),"f"),F(this,o,"f").catch((()=>{})),F(this,s,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),F(this,w,"f"))}),0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),((0,A.ng)(e)||(0,A.Rf)(e))&&e.content)this._emit("functionCallResult",e.content);else if((0,A.Gn)(e)&&e.function_call)this._emit("functionCall",e.function_call);else if((0,A.Gn)(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}_connected(){this.ended||(F(this,i,"f").call(this),this._emit("connect"))}get ended(){return F(this,f,"f")}get errored(){return F(this,h,"f")}get aborted(){return F(this,d,"f")}abort(){this.controller.abort()}on(e,t){return(F(this,l,"f")[e]||(F(this,l,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=F(this,l,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(F(this,l,"f")[e]||(F(this,l,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{C(this,p,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){C(this,p,!0,"f"),await F(this,s,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new _.OpenAIError("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),F(this,r,"m",m).call(this)}async finalMessage(){return await this.done(),F(this,r,"m",y).call(this)}async finalFunctionCall(){return await this.done(),F(this,r,"m",v).call(this)}async finalFunctionCallResult(){return await this.done(),F(this,r,"m",b).call(this)}async totalUsage(){return await this.done(),F(this,r,"m",g).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(F(this,f,"f"))return;"end"===e&&(C(this,f,!0,"f"),F(this,a,"f").call(this));const n=F(this,l,"f")[e];if(n&&(F(this,l,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return F(this,p,"f")||n?.length||Promise.reject(e),F(this,u,"f").call(this,e),F(this,c,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];F(this,p,"f")||n?.length||Promise.reject(e),F(this,u,"f").call(this,e),F(this,c,"f").call(this,e),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=F(this,r,"m",y).call(this);t&&this._emit("finalMessage",t);const n=F(this,r,"m",m).call(this);n&&this._emit("finalContent",n);const o=F(this,r,"m",v).call(this);o&&this._emit("finalFunctionCall",o);const i=F(this,r,"m",b).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",F(this,r,"m",g).call(this))}async _createChatCompletion(e,t,n){const o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort()))),F(this,r,"m",D).call(this,t);const i=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const o="function",{function_call:i="auto",stream:u,...s}=t,a="string"!=typeof i&&i?.name,{maxChatCompletions:c=S}=n||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const f=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...s,function_call:i,functions:f,messages:[...this.messages]},n),u=t.choices[0]?.message;if(!u)throw new _.OpenAIError("missing message in ChatCompletion response");if(!u.function_call)return;const{name:c,arguments:h}=u.function_call,d=l[c];if(!d){const e=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${f.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:o,name:c,content:e});continue}if(a&&a!==c){const e=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:o,name:c,content:e});continue}let p;try{p=(0,x.Li)(d)?await d.parse(h):h}catch(e){this._addMessage({role:o,name:c,content:e instanceof Error?e.message:String(e)});continue}const m=await d.function(p,this),y=F(this,r,"m",E).call(this,m);if(this._addMessage({role:o,name:c,content:y}),a)return}}async _runTools(e,t,n){const o="tool",{tool_choice:i="auto",stream:u,...s}=t,a="string"!=typeof i&&i?.function?.name,{maxChatCompletions:c=S}=n||{},l={};for(const e of t.tools)"function"===e.type&&(l[e.function.name||e.function.function.name]=e.function);const f="tools"in t?t.tools.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...s,tool_choice:i,tools:f,messages:[...this.messages]},n),u=t.choices[0]?.message;if(!u)throw new _.OpenAIError("missing message in ChatCompletion response");if(!u.tool_calls)return;for(const e of u.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:i}=e.function,u=l[n];if(!u){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${f.map((e=>JSON.stringify(e.function.name))).join(", ")}. Please try again`;this._addMessage({role:o,tool_call_id:t,content:e});continue}if(a&&a!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:o,tool_call_id:t,content:e});continue}let s;try{s=(0,x.Li)(u)?await u.parse(i):i}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:o,tool_call_id:t,content:n});continue}const c=await u.function(s,this),h=F(this,r,"m",E).call(this,c);if(this._addMessage({role:o,tool_call_id:t,content:h}),a)return}}}}o=new WeakMap,i=new WeakMap,u=new WeakMap,s=new WeakMap,a=new WeakMap,c=new WeakMap,l=new WeakMap,f=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,w=new WeakMap,r=new WeakSet,m=function(){return F(this,r,"m",y).call(this).content??null},y=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if((0,A.Gn)(t))return{...t,content:t.content??null}}throw new _.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},v=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,A.Gn)(t)&&t?.function_call)return t.function_call;if((0,A.Gn)(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},b=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,A.ng)(t)&&null!=t.content)return t.content;if((0,A.Rf)(t)&&null!=t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},g=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},D=function(e){if(null!=e.n&&e.n>1)throw new _.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},E=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)}},96630:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var r=n(84458),o=n(53413);class i extends r.K{static runFunctions(e,t,n){const r=new i,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new i,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}_addMessage(e){super._addMessage(e),(0,o.Gn)(e)&&e.content&&this._emit("content",e.content)}}},5775:(e,t,n)=>{"use strict";n.d(t,{L:()=>p});var r,o,i,u,s,a,c=n(59775),l=n(84458),f=n(46409),h=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},d=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n};class p extends l.K{constructor(){super(...arguments),r.add(this),o.set(this,void 0)}get currentChatCompletionSnapshot(){return h(this,o,"f")}static fromReadableStream(e){const t=new p;return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new p;return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){const o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort()))),h(this,r,"m",i).call(this);const a=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of a)h(this,r,"m",u).call(this,e);if(a.controller.signal?.aborted)throw new c.APIUserAbortError;return this._addChatCompletion(h(this,r,"m",s).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),h(this,r,"m",i).call(this),this._connected();const o=f.F.fromReadableStream(e,this.controller);let a;for await(const e of o)a&&a!==e.id&&this._addChatCompletion(h(this,r,"m",s).call(this)),h(this,r,"m",u).call(this,e),a=e.id;if(o.controller.signal?.aborted)throw new c.APIUserAbortError;return this._addChatCompletion(h(this,r,"m",s).call(this))}[(o=new WeakMap,r=new WeakSet,i=function(){this.ended||d(this,o,void 0,"f")},u=function(e){if(this.ended)return;const t=h(this,r,"m",a).call(this,e);this._emit("chunk",e,t);const n=e.choices[0]?.delta?.content,o=t.choices[0]?.message;null!=n&&"assistant"===o?.role&&o?.content&&this._emit("content",n,o.content)},s=function(){if(this.ended)throw new c.OpenAIError("stream has ended, this shouldn't happen");const e=h(this,o,"f");if(!e)throw new c.OpenAIError("request ended without sending any chunks");return d(this,o,void 0,"f"),function(e){const{id:t,choices:n,created:r,model:o}=e;return{id:t,choices:n.map((({message:t,finish_reason:n,index:r,logprobs:o})=>{if(!n)throw new c.OpenAIError(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:u,tool_calls:s}=t,a=t.role;if(!a)throw new c.OpenAIError(`missing role for choice ${r}`);if(u){const{arguments:e,name:t}=u;if(null==e)throw new c.OpenAIError(`missing function_call.arguments for choice ${r}`);if(!t)throw new c.OpenAIError(`missing function_call.name for choice ${r}`);return{message:{content:i,function_call:{arguments:e,name:t},role:a},finish_reason:n,index:r,logprobs:o}}return s?{index:r,finish_reason:n,logprobs:o,message:{role:a,content:i,tool_calls:s.map(((t,n)=>{const{function:o,type:i,id:u}=t,{arguments:s,name:a}=o||{};if(null==u)throw new c.OpenAIError(`missing choices[${r}].tool_calls[${n}].id\n${m(e)}`);if(null==i)throw new c.OpenAIError(`missing choices[${r}].tool_calls[${n}].type\n${m(e)}`);if(null==a)throw new c.OpenAIError(`missing choices[${r}].tool_calls[${n}].function.name\n${m(e)}`);if(null==s)throw new c.OpenAIError(`missing choices[${r}].tool_calls[${n}].function.arguments\n${m(e)}`);return{id:u,type:i,function:{name:a,arguments:s}}}))}}:{message:{content:i,role:a},finish_reason:n,index:r,logprobs:o}})),created:r,model:o,object:"chat.completion"}}(e)},a=function(e){var t,n,r;let i=h(this,o,"f");const{choices:u,...s}=e;i?Object.assign(i,s):i=d(this,o,{...s,choices:[]},"f");for(const{delta:o,finish_reason:u,index:s,logprobs:a=null,...c}of e.choices){let e=i.choices[s];if(!e){i.choices[s]={finish_reason:u,index:s,message:o,logprobs:a,...c};continue}if(a&&(e.logprobs?a.content&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...a.content)):e.logprobs=a),u&&(e.finish_reason=u),Object.assign(e,c),!o)continue;const{content:l,function_call:f,role:h,tool_calls:d}=o;if(l&&(e.message.content=(e.message.content||"")+l),h&&(e.message.role=h),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),d){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:o,function:i}of d){const u=(r=e.message.tool_calls)[t]??(r[t]={});n&&(u.id=n),o&&(u.type=o),i&&(u.function??(u.function={arguments:""})),i?.name&&(u.function.name=i.name),i?.arguments&&(u.function.arguments+=i.arguments)}}}return i},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e(void 0);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e=>t.push(e))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}))}}toReadableStream(){return new f.F(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function m(e){return JSON.stringify(e)}},83067:(e,t,n)=>{"use strict";n.d(t,{F:()=>o});var r=n(5775);class o extends r.L{static fromReadableStream(e){const t=new o;return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new o,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,i))),r}static runTools(e,t,n){const r=new o,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,i))),r}}},93961:(e,t,n)=>{"use strict";function r(e){return"function"==typeof e.parse}n.d(t,{Li:()=>r})},53413:(e,t,n)=>{"use strict";n.d(t,{Gn:()=>r,Rf:()=>i,ng:()=>o});const r=e=>"assistant"===e?.role,o=e=>"function"===e?.role,i=e=>"tool"===e?.role},31120:(e,t,n)=>{"use strict";n.d(t,{T:()=>o,j:()=>i});var r=n(2475);class o extends r.FO{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class i extends r.FO{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}},18083:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});class r{constructor(e){this._client=e}}},93958:(e,t,n)=>{"use strict";n.d(t,{B:()=>s});var r=n(18083),o=n(95648),i=n(67932),u=n(75380);class s extends r.T{constructor(){super(...arguments),this.transcriptions=new i.W(this._client),this.translations=new u.Z(this._client),this.speech=new o.U(this._client)}}!function(e){e.Transcriptions=i.W,e.Translations=u.Z,e.Speech=o.U}(s||(s={}))},95648:(e,t,n)=>{"use strict";n.d(t,{U:()=>o});var r=n(18083);class o extends r.T{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}o||(o={})},67932:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});var r=n(18083),o=n(35993);class i extends r.T{create(e,t){return this._client.post("/audio/transcriptions",(0,o.md)({body:e,...t}))}}i||(i={})},75380:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(18083),o=n(35993);class i extends r.T{create(e,t){return this._client.post("/audio/translations",(0,o.md)({body:e,...t}))}}i||(i={})},24722:(e,t,n)=>{"use strict";n.d(t,{I:()=>c,m:()=>a});var r=n(18083),o=n(2475),i=n(24722),u=n(40889),s=n(31120);class a extends r.T{constructor(){super(...arguments),this.files=new u.h(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e={},t){return(0,o.my)(e)?this.list({},e):this._client.getAPIList("/assistants",c,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}class c extends s.j{}!function(e){e.AssistantsPage=i.I,e.Files=u.h,e.AssistantFilesPage=u.S}(a||(a={}))},40889:(e,t,n)=>{"use strict";n.d(t,{S:()=>a,h:()=>s});var r=n(18083),o=n(2475),i=n(40889),u=n(31120);class s extends r.T{create(e,t,n){return this._client.post(`/assistants/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e,t={},n){return(0,o.my)(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,a,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}del(e,t,n){return this._client.delete(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class a extends u.j{}!function(e){e.AssistantFilesPage=i.S}(s||(s={}))},94973:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var r=n(18083),o=n(24722),i=n(65050),u=n(21018);class s extends r.T{constructor(){super(...arguments),this.chat=new i.e(this._client),this.assistants=new o.m(this._client),this.threads=new u.U(this._client)}}!function(e){e.Chat=i.e,e.Assistants=o.m,e.AssistantsPage=o.I,e.Threads=u.U}(s||(s={}))},65050:(e,t,n)=>{"use strict";n.d(t,{e:()=>i});var r=n(18083),o=n(52089);class i extends r.T{constructor(){super(...arguments),this.completions=new o.cX(this._client)}}!function(e){e.Completions=o.cX}(i||(i={}))},52089:(e,t,n)=>{"use strict";n.d(t,{cX:()=>s});var r=n(18083),o=n(96630),i=n(83067),u=n(5775);class s extends r.T{runFunctions(e,t){return e.stream?i.F.runFunctions(this._client.chat.completions,e,t):o.P.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?i.F.runTools(this._client.chat.completions,e,t):o.P.runTools(this._client.chat.completions,e,t)}stream(e,t){return u.L.createChatCompletion(this._client.chat.completions,e,t)}}},91639:(e,t,n)=>{"use strict";n.d(t,{E:()=>a,h:()=>s});var r=n(18083),o=n(2475),i=n(91639),u=n(31120);class s extends r.T{retrieve(e,t,n,r){return this._client.get(`/threads/${e}/messages/${t}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t,n={},r){return(0,o.my)(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,a,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class a extends u.j{}!function(e){e.MessageFilesPage=i.E}(s||(s={}))},68649:(e,t,n)=>{"use strict";n.d(t,{S:()=>c,V:()=>a});var r=n(18083),o=n(2475),i=n(68649),u=n(91639),s=n(31120);class a extends r.T{constructor(){super(...arguments),this.files=new u.h(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t={},n){return(0,o.my)(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,c,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class c extends s.j{}!function(e){e.ThreadMessagesPage=i.S,e.Files=u.h,e.MessageFilesPage=u.E}(a||(a={}))},62941:(e,t,n)=>{"use strict";n.d(t,{D:()=>c,E:()=>a});var r=n(18083),o=n(2475),i=n(62941),u=n(64344),s=n(31120);class a extends r.T{constructor(){super(...arguments),this.steps=new u.R(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t={},n){return(0,o.my)(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,c,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class c extends s.j{}!function(e){e.RunsPage=i.D,e.Steps=u.R,e.RunStepsPage=u.Z}(a||(a={}))},64344:(e,t,n)=>{"use strict";n.d(t,{R:()=>s,Z:()=>a});var r=n(18083),o=n(2475),i=n(64344),u=n(31120);class s extends r.T{retrieve(e,t,n,r){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t,n={},r){return(0,o.my)(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,a,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class a extends u.j{}!function(e){e.RunStepsPage=i.Z}(s||(s={}))},21018:(e,t,n)=>{"use strict";n.d(t,{U:()=>s});var r=n(18083),o=n(2475),i=n(68649),u=n(62941);class s extends r.T{constructor(){super(...arguments),this.runs=new u.E(this._client),this.messages=new i.V(this._client)}create(e={},t){return(0,o.my)(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}!function(e){e.Runs=u.E,e.RunsPage=u.D,e.Messages=i.V,e.ThreadMessagesPage=i.S}(s||(s={}))},34084:(e,t,n)=>{"use strict";n.d(t,{e:()=>i});var r=n(18083),o=n(12729);class i extends r.T{constructor(){super(...arguments),this.completions=new o.c(this._client)}}!function(e){e.Completions=o.c}(i||(i={}))},12729:(e,t,n)=>{"use strict";n.d(t,{c:()=>o});var r=n(18083);class o extends r.T{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}o||(o={})},93102:(e,t,n)=>{"use strict";n.d(t,{c:()=>o});var r=n(18083);class o extends r.T{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}o||(o={})},52953:(e,t,n)=>{"use strict";n.d(t,{I:()=>o});var r=n(18083);class o extends r.T{create(e,t){return this._client.post("/edits",{body:e,...t})}}o||(o={})},69682:(e,t,n)=>{"use strict";n.d(t,{J:()=>o});var r=n(18083);class o extends r.T{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}o||(o={})},57883:(e,t,n)=>{"use strict";n.d(t,{h:()=>c,q:()=>l});var r=n(18083),o=n(2475),i=n(59775),u=n(57883),s=n(35993),a=n(31120);class c extends r.T{create(e,t){return this._client.post("/files",(0,s.md)({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return(0,o.my)(e)?this.list({},e):this._client.getAPIList("/files",l,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),u=Date.now();let s=await this.retrieve(e);for(;!s.status||!r.has(s.status);)if(await(0,o._v)(t),s=await this.retrieve(e),Date.now()-u>n)throw new i.APIConnectionTimeoutError({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return s}}class l extends a.T{}!function(e){e.FileObjectsPage=u.q}(c||(c={}))},99337:(e,t,n)=>{"use strict";n.d(t,{Y:()=>s,y:()=>u});var r=n(18083),o=n(99337),i=n(31120);class u extends r.T{create(e,t){return this._client.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine-tunes/${e}`,t)}list(e){return this._client.getAPIList("/fine-tunes",s,e)}cancel(e,t){return this._client.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,n){return this._client.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...n,stream:t?.stream??!1})}}class s extends i.T{}!function(e){e.FineTunesPage=o.Y}(u||(u={}))},2662:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(18083),o=n(23314);class i extends r.T{constructor(){super(...arguments),this.jobs=new o.pe(this._client)}}!function(e){e.Jobs=o.pe,e.FineTuningJobsPage=o.I8,e.FineTuningJobEventsPage=o.sM}(i||(i={}))},23314:(e,t,n)=>{"use strict";n.d(t,{I8:()=>a,pe:()=>s,sM:()=>c});var r=n(18083),o=n(2475),i=n(23314),u=n(31120);class s extends r.T{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return(0,o.my)(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",a,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return(0,o.my)(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,c,{query:t,...n})}}class a extends u.j{}class c extends u.j{}!function(e){e.FineTuningJobsPage=i.I8,e.FineTuningJobEventsPage=i.sM}(s||(s={}))},20993:(e,t,n)=>{"use strict";n.d(t,{r:()=>i});var r=n(18083),o=n(35993);class i extends r.T{createVariation(e,t){return this._client.post("/images/variations",(0,o.md)({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",(0,o.md)({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}i||(i={})},15520:(e,t,n)=>{"use strict";n.d(t,{i:()=>s,k:()=>u});var r=n(18083),o=n(15520),i=n(31120);class u extends r.T{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",s,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class s extends i.T{}!function(e){e.ModelsPage=o.i}(u||(u={}))},61628:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var r=n(18083);class o extends r.T{create(e,t){return this._client.post("/moderations",{body:e,...t})}}o||(o={})},46409:(e,t,n)=>{"use strict";n.d(t,{F:()=>i});var r=n(29987),o=n(59775);class i{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;const r=new u;return new i((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const n of async function*(){if(!e.body)throw t.abort(),new o.OpenAIError("Attempted to iterate over a response with no body");const n=new s,i=a(e.body);for await(const e of i)for(const t of n.decode(e)){const e=r.decode(t);e&&(yield e)}for(const e of n.flush()){const t=r.decode(e);t&&(yield t)}}())if(!i)if(n.data.startsWith("[DONE]"))i=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new o.APIError(void 0,e.error,void 0,void 0);yield e}i=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{i||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new i((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new s,n=a(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new i((()=>r(e)),this.controller),new i((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new r.Pz({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:o}=await t.next();if(o)return e.close();const i=n.encode(JSON.stringify(r)+"\n");e.enqueue(i)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class u{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(":");return-1!==n?[e.substring(0,n),":",e.substring(n+1)]:[e,"",""]}(e);return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}class s{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=s.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(s.NEWLINE_REGEXP);return 1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new o.OpenAIError(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new o.OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new o.OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function a(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}s.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","","","","","\u2028","\u2029"]),s.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g},35993:(e,t,n)=>{"use strict";n.d(t,{Vw:()=>u,YT:()=>c,md:()=>l});var r=n(29987);const o=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,i=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function u(e,t,n={}){if(e=await e,o(e)){const o=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new r.$B([o],t,n)}const u=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(i(e))t.push(await e.arrayBuffer());else{if(!a(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return s(e.name)||s(e.filename)||s(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n.type){const e=u[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new r.$B(u,t,n)}const s=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,a=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],c=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],l=async e=>{const t=await f(e.body);return(0,r.Uw)(t,e)},f=async e=>{const t=new r.Ct;return await Promise.all(Object.entries(e||{}).map((([e,n])=>h(t,e,n)))),t},h=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((e=>(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&i(e))(e)||o(e)||(0,r.QQ)(e))(n)){const r=await u(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>h(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>h(e,`${t}[${n}]`,r))))}}}},33817:(e,t,n)=>{"use strict";n.d(t,{q:()=>r});const r="4.24.1"},97582:(e,t,n)=>{"use strict";n.d(t,{CR:()=>a,FC:()=>f,Jh:()=>u,KL:()=>h,XA:()=>s,ZT:()=>o,ev:()=>c,mG:()=>i,qq:()=>l});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function s(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}a((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return u.label++,{value:s[1],done:!1};case 5:u.label++,r=s[1],s=[0];continue;case 7:s=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){u=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){u.label=s[1];break}if(6===s[0]&&u.label<o[1]){u.label=o[1],o=s;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(s);break}o[2]&&u.ops.pop(),u.trys.pop();continue}s=t.call(e,u)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u}function c(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function l(e){return this instanceof l?(this.v=e,this):new l(e)}function f(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},u("next"),u("throw"),u("return"),r[Symbol.asyncIterator]=function(){return this},r;function u(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof l?Promise.resolve(n.value.v).then(a,c):f(i[0][2],n)}catch(e){f(i[0][3],e)}var n}function a(e){s("next",e)}function c(e){s("throw",e)}function f(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function h(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=s(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var rxjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9141),rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1545),rxjs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(32817),rxjs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(40052),rxjs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(80230),rxjs__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(72107),_chat_conversationDb__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4671),_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23229);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,u=Object.create(i.prototype),s=new k(r||[]);return o(u,"_invoke",{value:C(e,n,s)}),u}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",m="completed",y={};function v(){}function b(){}function g(){}var w={};c(w,u,(function(){return this}));var D=Object.getPrototypeOf,E=D&&D(D(B([])));E&&E!==n&&r.call(E,u)&&(w=E);var _=g.prototype=v.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(o,i,u,s){var a=f(e[o],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==_typeof(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,u,s)}),(function(e){n("throw",e,u,s)})):t.resolve(l).then((function(e){c.value=e,u(c)}),(function(e){return n("throw",e,u,s)}))}s(a.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,n,r){var o=h;return function(i,u){if(o===p)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw u;return{value:e,done:!0}}for(r.method=i,r.arg=u;;){var s=r.delegate;if(s){var a=F(s,r);if(a){if(a===y)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=p;var c=f(t,n,r);if("normal"===c.type){if(o=r.done?m:d,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function F(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,F(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var u=i.arg;return u?u.done?(n[t.resultName]=u.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function B(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(_typeof(t)+" is not iterable")}return b.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=c(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},x(A.prototype),c(A.prototype,s,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new A(l(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},x(_),c(_,a,"Generator"),c(_,u,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=B,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],s=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var a=r.call(u,"catchLoc"),c=r.call(u,"finallyLoc");if(a&&c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=e,u.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:B(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,o,i,u){try{var s=e[i](u),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){asyncGeneratorStep(i,r,o,u,s,"next",e)}function s(e){asyncGeneratorStep(i,r,o,u,s,"throw",e)}u(void 0)}))}}var db=new _chat_conversationDb__WEBPACK_IMPORTED_MODULE_0__.Au;function coerceInputOrReturn(e){return(0,rxjs__WEBPACK_IMPORTED_MODULE_2__.b)(e)?e:void 0===e?rxjs__WEBPACK_IMPORTED_MODULE_3__.E:"string"==typeof e?(0,rxjs__WEBPACK_IMPORTED_MODULE_4__.of)(e):(0,rxjs__WEBPACK_IMPORTED_MODULE_5__.D)(e)}function buildFunction(e,t){return _buildFunction.apply(this,arguments)}function _buildFunction(){return(_buildFunction=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,o,i,u,s,a,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,db.getMessageByHash(t);case 2:if(r=e.sent){e.next=5;break}throw new Error('Function message with hash "'.concat(t,'" not found.'));case 5:if((0,_chat_conversationDb__WEBPACK_IMPORTED_MODULE_0__.Ud)(r)){e.next=7;break}throw new Error('Message with hash "'.concat(t,'" is not a function message.'));case 7:if(o=(0,_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__.TZ)(r.content)){e.next=10;break}throw new Error("Invalid function message content");case 10:if((0,_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__.MM)(o)){e.next=12;break}throw new Error("Function message must be an invocation of generate_dynamic_function or compose_dynamic_functions.");case 12:return e.next=14,db.getFunctionDependenciesByHash(r.hash);case 14:return i=e.sent,u=i.filter((function(e){return!n.includes(e.dependencyName)})),e.next=18,Promise.all(u.map((function(e){return buildFunction(e.dependencyName,n).then((function(t){return'"'.concat(e.dependencyName,'": (').concat(t,")(utils),")}))})));case 18:return s=e.sent,a="{\n".concat(s.join("\n"),"\n}"),c="generate_dynamic_function"===o.name?o.parameters.functionBody:(0,_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__.r$)(o.parameters.functionHashes),e.abrupt("return","\n    (utils) => (input) => {\n      const { RxJS } = utils;\n      utils = { RxJS, allStaticDependencies: utils.allStaticDependencies };\n\n      const dependencies = {...utils.allStaticDependencies, ...".concat(a,"};\n      input = coerceInputOrReturn(input);\n      {\n        const utils = undefined;\n        const returnVal = (() => {\n          ").concat(c,"\n        })();\n        const coercedReturn = coerceInputOrReturn(returnVal);\n        return coercedReturn;\n      }\n    }\n  "));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function customJsonpRunner(e,t){if("string"!=typeof t)throw new Error("URL must be a string");return new Promise((function(e,n){var r="jsonp_callback_"+Math.round(1e5*Math.random());self[r]=function(t){delete self[r];var n=JSON.stringify(t.data);e(n)};var o=t+(t.indexOf("?")>=0?"&":"?")+"callback="+r;importScripts(o)}))}self.addEventListener("message",function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(event){var data,functionHash,input,allowedFunctionSpecs,allStaticDependencies,allStaticDependenciesNames,builtFunctionString,builtFunction,results;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!event.data.SET_API_KEY){_context.next=3;break}return self.localStorage={getItem:function(){return event.data.SET_API_KEY}},_context.abrupt("return");case 3:return data=event.data,functionHash=data.functionHash,input=data.input,allowedFunctionSpecs=_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__.YT.filter((function(e){return!_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__.ck.includes(e.name)})),allStaticDependencies=allowedFunctionSpecs.reduce((function(e,t){var n=t.parameters.filter((function(e){return e.required})).length,r=t.parameters.length;return e[t.name]=function(e){return new rxjs__WEBPACK_IMPORTED_MODULE_6__.y((function(o){var i;try{i=(0,_chat_functionCalling__WEBPACK_IMPORTED_MODULE_1__.hp)(e,t)}catch(e){return void o.error(e)}if(i.length<n)o.error("Function ".concat(t.name," requires at least ").concat(n," parameters."));else{if(!(i.length>r)){var u=coerceInputOrReturn(("jsonp_data_retrevial"===t.name?customJsonpRunner:t.implementation).apply(void 0,[{db}].concat(_toConsumableArray(i)))).subscribe({next:function(e){o.next(e)},error:function(e){return o.error(e)},complete:function(){return o.complete()}});return function(){return u.unsubscribe()}}o.error("Function ".concat(t.name," accepts at most ").concat(r," parameters."))}}))},e}),{}),allStaticDependenciesNames=Object.keys(allStaticDependencies),_context.prev=8,_context.next=11,buildFunction(functionHash,allStaticDependenciesNames);case 11:builtFunctionString=_context.sent,builtFunction=eval(builtFunctionString),results=builtFunction({RxJS:rxjs__WEBPACK_IMPORTED_MODULE_7__,allStaticDependencies})(input),results.subscribe({next:function(e){var t={status:"incomplete",content:e};self.postMessage(t)},complete:function(){self.postMessage({status:"complete"})}}),_context.next=20;break;case 17:_context.prev=17,_context.t0=_context.catch(8),_context.t0 instanceof Error?(console.error("Error caught in dynamicFunctions.worker!",_context.t0),self.postMessage({status:"error",error:"An error occurred while invoking the function. The function likely has a coding error and needs to be regenerated: "+_context.t0.message})):self.postMessage({status:"error",error:"An unknown error occurred: "+JSON.stringify(_context.t0)});case 20:return _context.abrupt("return",[]);case 21:case"end":return _context.stop()}}),_callee,null,[[8,17]])})));return function(e){return _ref.apply(this,arguments)}}())})()})();